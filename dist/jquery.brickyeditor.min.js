var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,o=Object(this),i=o.length>>>0,n=arguments[1],r=0;r<i;r++)if(e=o[r],t.call(n,e,r,o))return e});var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){var t="",e=document;return window.getSelection?t=window.getSelection().toString():e.selection&&"Control"!=e.selection.type&&(t=e.selection.createRange().text),t},t.propsEach=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];e(o,i)}},t.propsFilterKeys=function(e,o,i){var n=[];return t.propsEach(e,function(t,e){o(t,e)&&n.push(t)}),i&&n.push(i),n},t}();t.Common=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,o){var i=this;this.$editor=e,this.options=o,this.blocks=[],this.compactTools=null,e.addClass("bre-editor"),t.Fields.BaseField.registerCommonFields(),this.options=new t.EditorOptions(o),this.ui=new t.UI(this),this.ui.toggleToolsLoader(!0),t.Services.TemplateService.loadTemplatesAsync(this).done(function(t){i.ui.toggleToolsLoader(!1),i.ui.setTemplates(t),i.options.blocks&&i.options.blocks.length&&i.loadBlocks(i.options.blocks),i.options.onload&&i.options.onload(i)})}return Object.defineProperty(e.prototype,"selectedBlockIndex",{get:function(){return this.selectedBlock?this.blocks.indexOf(this.selectedBlock):-1},enumerable:!0,configurable:!0}),e.prototype.getData=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getData())}),t},e.prototype.getHtml=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getHtml(!0))}),t.join("\n")},e.prototype.loadBlocks=function(e){var o=this;e&&e.length&&e.forEach(function(e){var i=t.Services.TemplateService.getTemplate(e.template);i?o.addBlock(i,e.fields,null,!1):console.log("Template "+e.template+" not found.")})},e.prototype.selectBlock=function(t){this.selectedBlock!==t&&(this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=t)},e.prototype.deselectBlock=function(t){this.selectedBlock=null},e.prototype.addBlock=function(e,o,i,n){void 0===n&&(n=!0);var r=new t.Block(this,e,o);r.insert(i),n&&(r.select(),r.scrollTo())},e.prototype.deleteBlock=function(t){var e=this.blocks.indexOf(t);this.blocks.splice(e,1),t=null,e<this.blocks.length?this.blocks[e].select():this.blocks.length>0?this.blocks[e-1].select():this.selectedBlock=null},e.prototype.moveBlock=function(t,e){var o=this.blocks.indexOf(t),i=o+e;if(!(i>=this.blocks.length||i<0)){var n=this.blocks[i].ui.$editor;e>0?n.after(t.ui.$editor):e<0&&n.before(t.ui.$editor),this.blocks.splice(o,1),this.blocks.splice(i,0,t),t.scrollTo()}},e.prototype.copyBlock=function(t){var e=this.blocks.indexOf(t)+1;this.addBlock(t.template,t.getData().fields,e,!0)},e}();t.Editor=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t){this.templatesUrl="templates/bootstrap4.html",this.compactTools=null,this.compactToolsWidth=768,this.ignoreHtml=null,this.templatesUrl=t.templatesUrl||this.templatesUrl,this.onload=t.onload,this.blocks=t.blocks,this.compactTools=t.compactTools,this.ignoreHtml=t.ignoreHtml||!1}return t}();t.EditorOptions=e}(BrickyEditor||(BrickyEditor={})),function(t){t.fn.brickyeditor=function(e){return new BrickyEditor.Editor(t(this),e)}}(jQuery);var BrickyEditor;!function(t){var e=function(){function e(e){var o=$(e),i=o.data();if(this.name=i.name,this.category=i.cactegory||[],this.$html=o.contents().not(".bre-template-preview"),this.$preview=$(".bre-template-preview",o).contents(),!this.$preview.length){var n=new t.Block(null,this),r=n.getHtml(!0);this.$preview=$(r)}}return e.prototype.getPreview=function(){var t=$("<div class='bre-template'></div>");return t.append(this.$preview),t},e}();t.Template=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,o,i){this.editor=e,this.template=o,this.fields=[];var n=o.$html.clone();this.ui=new t.BlockUI(this,n,i)}return e.prototype.delete=function(){this.ui.delete(),this.editor.deleteBlock(this)},e.prototype.move=function(t){this.editor.moveBlock(this,t)},e.prototype.copy=function(){this.editor.copyBlock(this)},e.prototype.insert=function(t){var e=this.editor;t=t||e.blocks.length,e.selectedBlock&&(t=e.selectedBlockIndex+1),e.blocks.splice(t,0,this),0==t?e.$editor.append(this.ui.$editor):e.blocks[t-1].ui.$editor.after(this.ui.$editor)},e.prototype.getData=function(){var t=[];this.fields.forEach(function(e){t.push(e.data)});var e={template:this.template.name,fields:t};return this.editor.options.ignoreHtml||(e.html=this.getHtml(!0)),e},e.prototype.getHtml=function(t,e){void 0===e&&(e=!1);var o=this.ui.$block.clone(!1,!1).wrap("<div></div>").parent();return["contenteditable","data-bre-field"].forEach(function(t){$("["+t+"]",o).each(function(e,o){o.removeAttribute(t)})}),t?o.html().breTotalTrim():o.html()},e.prototype.select=function(){this.ui.$editor.addClass("bre-selected"),this.editor.selectBlock(this)},e.prototype.deselect=function(){this.ui.$editor.removeClass("bre-selected"),t.UI.toggleBtnDeck(this.ui.$tools,!0),this.editor.deselectBlock(this)},e.prototype.scrollTo=function(){var t=this.ui.$editor.offset().top-100;t=t>0?t:0,$("html, body").animate({scrollTop:t},"fast")},e}();t.Block=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e,o){this.icon=t,this.action=e,this.title=o}return t}();t.BlockAction=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,o){this.block=t,this.$block=e,this.block.editor&&this.buildEditorUI(),this.bindFields(o)}return e.prototype.delete=function(){this.$editor.remove()},e.prototype.buildEditorUI=function(){var o=this;this.$tools=$('<div class="bre-block-tools bre-btn-deck"></div>'),e.actions.forEach(function(t){var e=o.buildButton(t);o.$tools.append(e)}),t.UI.initBtnDeck(this.$tools),this.$editor=$('<div class="bre-block-wrapper"></div>'),this.$editor.append(this.$tools),this.$editor.append(this.$block),this.$editor.hover(function(){o.$editor.addClass("bre-active")},function(){o.$editor.removeClass("bre-active")}),this.$block.on("click",function(){return o.block.select()})},e.prototype.buildButton=function(t){var e=this,o=$('<button class="bre-btn"><i class="fa fa-'+t.icon+'"></i></button>');return t.action&&o.on("click",function(){return t.action(e.block)}),o},e.prototype.bindFields=function(e){var o=this;this.$block.find(t.Selectors.selectorField).addBack(t.Selectors.selectorField).each(function(i,n){var r=$(n),l=t.Fields.BaseField.createField(o.block,r,e);o.block.fields.push(l)})},e.actions=[{icon:"ellipsis-h"},{icon:"trash-o",action:function(t){return t.delete()}},{icon:"copy",action:function(t){return t.copy()}},{icon:"angle-up",action:function(t){return t.move(-1)}},{icon:"angle-down",action:function(t){return t.move(1)}}],e}();t.BlockUI=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function e(t,e,o){this.$field=e,this.block=t,this.data=o,this.bind()}return Object.defineProperty(e,"type",{get:function(){var t=this.name;return t=t.replace("Field",""),t=t.substring(0,1).toLowerCase()+t.substring(1)},enumerable:!0,configurable:!0}),e.prototype.getSettingsEl=function(){return null},e.registerCommonFields=function(){t.HtmlField.registerField(),t.ImageField.registerField(),t.EmbedField.registerField()},e.registerField=function(){this._fields.hasOwnProperty(this.type)&&delete this._fields[this.type],this._fields[this.type]=this},e.createField=function(t,e,o){var i=e.data().breField;if(!i)throw"There is no any data in field "+e.html()+" of block "+t.name;if("string"==typeof i&&(i=JSON.parse(i.replace(/'/g,'"'))),!i.name)throw"There is no name in data of field "+e.html()+" of block "+t.name;if(o){for(var n={},r=0;r<o.length;r++){var l=o[r];if(l.name.toLowerCase()===i.name.toLowerCase()){n=l;break}}n&&(i=$.extend(i,n))}var s=i.type;if(null!=s){if(this._fields.hasOwnProperty(s)){return new(0,this._fields[s])(t,e,i)}throw s+" field not found"}throw"Field type not defined in data-bre-field attribute"},e.prototype.bind=function(){},e.prototype.selectBlock=function(){this.block.select()},e._fields={},e}();t.BaseField=e}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.getSettingsEl=function(){var t=$('<div style="position: absolute;width: 100%; height: 100px;;text-align: center;font-weight: bold;vertical-align: middle;background: #333;opacity: 0.2;">Change embed element link</div>');return this.$field.before(t),t},Object.defineProperty(o.prototype,"settings",{get:function(){return function(t){t.data.url=prompt("Link to embed media","http://instagr.am/p/BO9VX2Vj4fF/"),t.loadMedia()}},enumerable:!0,configurable:!0}),o.prototype.bind=function(){var t=this;this.$field.on("click",function(){t.data.url=prompt("Link to embed media","http://instagr.am/p/BO9VX2Vj4fF/"),t.loadMedia()}),t.loadMedia()},o.prototype.loadMedia=function(){var e=this;e.data&&e.data.url&&t.Services.EmbedService.getEmbedAsync(e.data.url).done(function(o){e.data.embed=o;var i=$(o.html),n=i.filter("script");if(n.length>0){n.remove();var r=n.attr("src");r.breStartsWith("//")&&(r="https:"+r,$.getScript(r).done(function(e){t.Services.EmbedService.processEmbed(o.provider_name)}).fail(function(t){}))}e.$field.empty(),e.$field.removeAttr("class"),e.$field.removeAttr("style"),e.$field.append(i),e.selectBlock()})},o}(e.BaseField);e.EmbedField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this,i=this.$field;i.is("[contenteditable]")||i.attr("contenteditable","true");var n=this.data.html||this.$field.html()||this.block.template.name;this.setHtml(n),i.html(this.data.html),t.SelectionUtils.bindTextSelection(i,function(t){e.block.editor.ui.htmlTools.show(t)}),i.on("blur keyup paste input",function(){e.setHtml(i.html())}).on("paste",function(t){t.preventDefault();var e=t.originalEvent,o=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,o)}).on("click",function(t){return o.selectBlock(),t.stopPropagation(),!1})},o.prototype.setHtml=function(t){this.data.html=t.trim(),this.$field.html()!==t&&this.$field.html(t)},o}(e.BaseField);e.HtmlField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var t=this,e=this.$field,o=(this.data,t.block.editor);this.setSrc(this.data.src),e.on("click",function(){o.ui.modal.promptAsync(t.getPromptParams()).done(function(e){var o=e.getValue("file"),i=e.getValue("src");o?(t.setFile(o),t.setSrc(null)):i&&(t.setSrc(i),t.setFile(null));var n=e.getValue("alt");t.setAlt(n)}),t.selectBlock()})},o.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("src","Image Link",this.data.url,"image url"),new t.Prompt.PromptParameterImage("file","or Upload file",this.data.file,"select file"),new t.Prompt.PromptParameter("alt","Alt",this.data.alt,"alt attribute value ")]},o.prototype.setSrc=function(t){this.data.src=t,t&&(this.isImg?this.$field.attr("src",this.data.src):this.$field.css("background-image","url("+this.data.src))},o.prototype.setAlt=function(t){this.data.alt=t,this.$field.attr(this.isImg?"alt":"title",this.data.alt)},o.prototype.setFile=function(t){this.data.file=t,t&&(this.isImg?this.$field.attr("src",this.data.file.fileContent):this.$field.css("background-image","url("+this.data.file.fileContent+")"))},Object.defineProperty(o.prototype,"isImg",{get:function(){return this._isImg=this._isImg||"img"===this.$field.prop("tagName").toLowerCase()},enumerable:!0,configurable:!0}),o}(e.BaseField);e.ImageField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t.getEmbedAsync=function(t){var e=$.Deferred(),t="https://noembed.com/embed?url="+t;return $.ajax({url:t,type:"get",dataType:"jsonp"}).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e},t.processEmbed=function(e){switch(e){case t.Instagram:instgrm&&instgrm.Embeds.process()}},t.Instagram="Instagram",t}();t.EmbedService=e}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function e(){}return e.loadTemplatesAsync=function(e){var o=this,i=$.Deferred();return $.get(e.options.templatesUrl).done(function(n){o.templates=[];var r=$(n).filter("style");r&&r.length>0&&e.$editor.prepend(r),$(n).filter(".bre-template").each(function(e,i){var n=new t.Template(i);o.templates.push(n)}),i.resolve(o.templates)}).fail(function(t){console.log("Templates file not found."),i.fail(t)}),i},e.getTemplate=function(t){for(var e=0;e<this.templates.length;e++){var o=this.templates[e];if(o.name.toLowerCase()===t.toLowerCase())return o}return null},e}();e.TemplateService=o}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o,i){this.key=t,this.title=e,this.placeholder=i||"",this.value=o}return t.prototype.parseValue=function(){this.value=this.$input.val(),this.$control=null,delete this._$control},Object.defineProperty(t.prototype,"$control",{get:function(){return this._$control||(this._$control=$('<div class="bre-prompt-field">\n                            <label class="bre-label" for="'+this.key+'">'+(this.title?this.title:"Select file...")+"</label>\n                        </div>"),this.$input=this.getEditor(),this._$control.append(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),t.prototype.getEditor=function(){this.value;return $('<input type="text" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+'" value="'+(this.value?this.value:"")+'">')},t}();t.PromptParameter=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function o(t,o,i,n){var r=e.call(this,t,o,i,n)||this;return i&&(r._value=i),r}return __extends(o,e),o.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},o.prototype.getEditor=function(){var e=this,o=this.value&&this.value.fileContent?this.value.fileContent:"",i=$("\n                <div class='bre-image-input'>\n                    <label for=\""+this.key+'">\n                        Select file...\n                    </label>                        \n                    <img src="'+o+'"/>                    \n                    <input type="file" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='bre-image-input-filename'></small>"),n=$("input",i),r=$("img",i),l=$(".bre-image-input-filename",i),s=this.value;return s&&(r.attr("src",s.fileContent),r.addClass("bre-loaded"),l.text(s.fileInfo.name)),n.change(function(){var o=this;if(o.files&&o.files[0]){var i=new FileReader;i.onload=function(i){var n=i.target;e._value=new t.PromptParameterImageResult,e._value.fileContent=n.result,e._value.fileInfo=new t.PromptParameterImageResultFile(o.files[0]),r.attr("src",e._value.fileContent),r.addClass("bre-loaded"),l.text(e._value.fileInfo.name)},i.readAsDataURL(o.files[0])}}),i},o}(t.PromptParameter);t.PromptParameterImage=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t}();t.PromptParameterImageResult=e;var o=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}();t.PromptParameterImageResultFile=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t){this.params=t}return t.prototype.getValue=function(t){var e=this.params.find(function(e){return e.key===t});return e?e.value:null},t}();t.PromptParameterList=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o){void 0===o&&(o=!1),this.title=t,this.value=e,this.selected=o}return t}();t.PromptParameterOption=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function o(o,i,n,r,l){var s=e.call(this,o,i,r,l)||this;return s.options=[],n.forEach(function(e){s.options.push(new t.PromptParameterOption(e[0],e[1],e[1]==r))}),s}return __extends(o,e),o.prototype.getEditor=function(){var t=this.options.map(function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return $('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+t+"</select>")},o}(t.PromptParameter);t.PromptParameterOptions=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t){this.editor=t,this.buttons=[{icon:"bold",command:"Bold",range:!0},{icon:"italic",command:"Italic",range:!0},{icon:"link",command:"CreateLink",range:!0},{icon:"list-ul",command:"insertUnorderedList",range:!0},{icon:"list-ol",command:"insertOrderedList",range:!0},{icon:"undo",command:"Undo",range:!1},{icon:"repeat",command:"Redo",range:!1}],this.setControl()}return e.prototype.setControl=function(){var t=this,e=$('<div class="bre-html-tools-panel"></div>');this.buttons.forEach(function(o){var i=t.getButtonElement(o.icon,o.command,o.range);e.append(i)}),this.$control=$('<div class="bre-html-tools bre-btn-group"></div>'),this.$control.append(e).hide(),this.editor.$editor.append(this.$control)},e.prototype.getButtonElement=function(t,e,o){var i=this;void 0===o&&(o=!0);var n=$('<button class="bre-btn"><i class="fa fa-'+t+'"></i></button>');return n.on("click",function(){var t=window.getSelection(),n=t.rangeCount>0?t.getRangeAt(0):null;if(!o||n)return"CreateLink"==e?i.editor.ui.modal.promptAsync(i.getLinkPromptParams(t)).done(function(o){var i=o.getValue("href");if(i){document.execCommand(e,!1,i);var n=o.getValue("target");n&&t.anchorNode.parentElement.setAttribute("target",n);var r=o.getValue("title");r&&t.anchorNode.parentElement.setAttribute("title",r)}}):document.execCommand(e),!1}),n},e.prototype.show=function(t){if(t&&t.width>1){var e=this.editor.$editor.offset(),o=this.editor.$editor.width(),i=t.top-e.top+$(window).scrollTop()+t.height,n=this.$control.width(),r=t.left-e.left+t.width/2-n/2;r<0?r=0:r+n>o&&(r=o-n),this.$control.css({top:i+"px",left:r+"px"}),this.$control.show()}else this.$control.hide()},e.prototype.getLinkPromptParams=function(e){var o="",i="",n="";if(e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var r=$(e.anchorNode.parentNode);o=r.attr("href"),i=r.attr("title"),n=r.attr("target")}return[new t.Prompt.PromptParameter("href","Url",o,"Url"),new t.Prompt.PromptParameter("title","Title",i,"Title"),new t.Prompt.PromptParameterOptions("target","Target",[["",""],["Blank","_blank"],["Self","_self"],["Parent","_parent"],["Top","_top"]],n)]},e}();t.HtmlTools=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,o,i,n,r){this.$control=t,this.$closeBtn=e,this.$form=o,this.$btns=i,this.$okBtn=n,this.$cancelBtn=r;var l=this;e.on("click",function(){l.hideModal()})}return e.prototype.hideModal=function(){this.restoreSelection(),this.$control.fadeOut()},e.prototype.showModal=function(t,e){void 0===e&&(e=!0),this.saveSelection(),this.$btns.toggle(e),t&&(this.$form.append(t),t.is(":visible")||t.show()),this.$control.fadeIn()},e.prototype.promptAsync=function(e){var o=this,i=$.Deferred(),n=this;return this.$form.children().not(this.$btns).remove(),e.forEach(function(t){o.$btns.before(t.$control)}),this.$okBtn.on("click",function(){e.forEach(function(t){return t.parseValue()}),n.hideModal(),i.resolve(new t.Prompt.PromptParameterList(e))}),this.$cancelBtn.on("click",function(){n.hideModal(),i.reject(e)}),n.showModal(),i},e.prototype.saveSelection=function(){var t=window.getSelection();this.selectionRanges=[];for(var e=0;e<t.rangeCount;e++)this.selectionRanges.push(t.getRangeAt(e))},e.prototype.restoreSelection=function(){if(this.selectionRanges&&0!=this.selectionRanges.length){var t=window.getSelection();t.removeAllRanges(),this.selectionRanges.forEach(function(e){return t.addRange(e)})}},e}();t.Modal=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,o;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(o=e.getRangeAt(0),o.deleteContents(),o.insertNode(document.createTextNode(t))))},t}();t.SelectionHelper=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.bindTextSelection=function(t,e){var o=this;t.is("[contenteditable]")&&(t.on("mouseup",function(){setTimeout(function(){var t=o.getSelectionRect();e(t)},0)}),t.on("keyup",function(t){var i=o.getSelectionRect();e(i)}))},t.getSelectionRect=function(){var t=window.getSelection(),e=t.getRangeAt(0);if(e){var o=e.getBoundingClientRect();if(o)return o}return null},t}();t.SelectionUtils=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.attr=function(t){return"["+t+"]"},t.field="data-bre-field",t.selectorField="["+t.field+"]",t.classMobile="brickyeditor-tools-mobile",t.htmlToolsCommand="data-bre-doc-command",t.htmlToolsCommandRange="data-bre-doc-command-range",t.selectorHtmlToolsCommand=t.attr(t.htmlToolsCommand),t.selectorHtmlToolsCommandRange=t.attr(t.htmlToolsCommandRange),t}();t.Selectors=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e){this.editor=e,this.setTools(),this.setModal(),this.htmlTools=new t.HtmlTools(this.editor)}return Object.defineProperty(e.prototype,"isCompactTools",{get:function(){var t=this.editor.options.compactTools;return null==t?window.innerWidth<this.editor.options.compactToolsWidth:t.valueOf()},enumerable:!0,configurable:!0}),e.prototype.setTools=function(){var t=this;this.$tools=$('<div class="bre bre-tools" data-bricky-tools></div>'),this.$toolsTemplates=$('<div class="bre-tools-templates"></div>'),this.$toolsLoader=$('<div class="bre-tools-loader"><b>Loading...</b></div>'),this.$toolsHideBtn=$('<button class="bre-tools-toggle"><div>►</div></button>'),this.$tools.append([this.$toolsHideBtn,this.$toolsLoader,this.$toolsTemplates]),this.$toolsHideBtn.on("click",function(){return t.toggleTools()}),this.editor.$editor.append(this.$tools),this.isCompactTools&&(this.$tools.addClass("bre-tools-templates-compact"),this.toggleTools())},e.prototype.toggleTools=function(){this.$tools.toggleClass("bre-tools-collapsed",!this.$toolsHideBtn.hasClass("bre-tools-toggle-collapsed")),this.$toolsHideBtn.toggleClass("bre-tools-toggle-collapsed")},e.prototype.setModal=function(){var e=$('<div class="bre bre-modal"><div class="bre-modal-placeholder"></div></div>'),o=$('<div class="bre-modal-close"><a href="#">close ✖</a></div>'),i=$('<div class="bre-modal-content"></div>'),n=$("<form></form>"),r=$('<div class="bre-btns"></div>'),l=$('<button type="button" class="bre-btn bre-btn-primary">Ok</button>'),s=$('<button type="button" class="bre-btn">Cancel</button>');r.append(l),r.append(s),n.append(r),i.append(n);var a=$(".bre-modal-placeholder",e);a.append(o),a.append(i),this.modal=new t.Modal(e,o,n,r,l,s),this.editor.$editor.append(e)},e.prototype.toggleToolsLoader=function(t){this.$toolsLoader.toggle(t)},e.prototype.setTemplates=function(t){var e=this,o=this.editor;t.forEach(function(t){var i=t.getPreview();i.on("click",function(){o.addBlock(t)}),e.$toolsTemplates.append(i)})},e.initBtnDeck=function(t){$(".bre-btn",t).eq(0).on("click",function(){e.toggleBtnDeck(t)})},e.toggleBtnDeck=function(t,e){var o=$(".bre-btn",t);if(o&&0!=o.length){var i=o.eq(0);e=e||t.data().isOn||!1,e?(t.css({height:0,width:0}),o.not(":first").css({opacity:0,top:0,left:0})):(o.not(":first").each(function(t,e){$(e).css({opacity:1,left:(t+1)*(32+32/6)})}),t.css({height:32,width:(32+32/6)*o.length-32/6})),i.toggleClass("bre-btn-active",!e),t.data("isOn",!e)}},e}();t.UI=e}(BrickyEditor||(BrickyEditor={}));