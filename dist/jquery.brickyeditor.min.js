var __awaiter=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function l(t){try{a(i.next(t))}catch(t){r(t)}}function s(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(l,s)}a((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(l=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(l=l.call(r,o[1])).done)return l;switch(r=0,l&&(o=[0,l.value]),o[0]){case 0:case 1:l=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(l=a.trys,!(l=l.length>0&&l[l.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){a.label=o[1];break}if(6===o[0]&&a.label<l[1]){a.label=l[1],l=o;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(o);break}l[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,r,l,s,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),BrickyEditor;!function(t){var e=function(){function e(t,e,o,i,n,r,l,s,a){void 0===a&&(a=!1),this.$element=t,this.onAddBlock=e,this.onDeleteBlock=o,this.onSelectBlock=i,this.onDeselectBlock=n,this.onMoveBlock=r,this.onUpdateBlock=l,this.onUpload=s,this.usePlaceholder=a,this.blocks=[],this.isContainer=!0,this.togglePlaceholderIfNeed()}return e.prototype.getData=function(t){var e=[];return this.blocks.forEach(function(o){e.push(o.getData(t))}),e},e.prototype.getHtml=function(){var e=[];this.blocks.forEach(function(t){e.push(t.getHtml(!0))});var o=t.$dom.clone(this.$element);return o.innerHTML=e.join("\n"),o.outerHTML},e.prototype.addBlock=function(e,o,i,n){var r=this;void 0===n&&(n=!0);var l=new t.Block(e,!1,o,function(t){return r.deleteBlock(t)},function(t){return r.selectBlock(t)},function(t){return r.deselectBlock(t)},function(t){return r.copyBlock(t)},function(t,e){return r.moveBlock(t,e)},this.onUpdateBlock,this.onUpload);this.insertBlock(l,i),n&&(l.select(),l.scrollTo())},e.prototype.insertBlock=function(e,o){o=o||this.blocks.length,this.selectedBlock&&(o=this.blocks.indexOf(this.selectedBlock)+1),this.blocks.splice(o,0,e),0==o?this.$element.appendChild(e.ui.$editor):t.$dom.after(this.blocks[o-1].ui.$editor,e.ui.$editor),this.onAddBlock(e,o),e.select(null),this.togglePlaceholderIfNeed()},e.prototype.deleteBlock=function(t){var e=this.blocks.indexOf(t);this.blocks.splice(e,1),t=null,e<this.blocks.length?this.blocks[e].select():this.blocks.length>0?this.blocks[e-1].select():this.selectedBlock=null,this.onDeleteBlock(t,e),this.togglePlaceholderIfNeed()},e.prototype.moveBlock=function(e,o){var i=this.blocks.indexOf(e),n=i+o;if(!(n>=this.blocks.length||n<0)){var r=this.blocks[n].ui.$editor;o>0?t.$dom.after(r,e.ui.$editor):o<0&&t.$dom.before(r,e.ui.$editor),this.blocks.splice(i,1),this.blocks.splice(n,0,e),this.onMoveBlock(e,i,n),e.scrollTo()}},e.prototype.copyBlock=function(t){var e=this.blocks.indexOf(t)+1;this.addBlock(t.template,t.getData().fields,e,!0)},e.prototype.selectBlock=function(t){this.selectedBlock!==t&&(this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=t,this.onSelectBlock(t))},e.prototype.deselectBlock=function(t){this.selectedBlock=null,this.onDeselectBlock(t)},e.prototype.togglePlaceholderIfNeed=function(){this.usePlaceholder&&(0===this.blocks.length?this.$placeholder||(this.$placeholder=t.$dom.el('<i data-bre-placeholder="true">Click here to select this container...</i>'),this.$element.appendChild(this.$placeholder)):this.$placeholder&&(this.$placeholder.remove(),this.$placeholder=null))},e}();t.BlocksContainer=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(o,i){var n=this;this.onError=function(t,e){return void 0===e&&(e=0),n.options.onError({message:t,code:e})},t.Fields.BaseField.registerCommonFields(),this.$editor=o,this.$editor.classList.add(t.Selectors.classEditor),this.options=new t.EditorOptions(i),this.container=this.createContainer(),e.UI=new t.UI(this),this.tryBindFormSubmit()}return e.prototype.createContainer=function(){var e=this,o=function(o,i){e.isLoaded&&(e.trigger(t.Events.onBlockAdd,{block:o,idx:i}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()}))},i=function(o,i){e.trigger(t.Events.onBlockDelete,{block:o,idx:i}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()})},n=function(o,i,n,r){e.trigger(t.Events.onBlockUpdate,{block:o,property:i,oldValue:n,newValue:r}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()})};return new t.BlocksContainer(this.$editor,o,i,function(o){e.trigger(t.Events.onBlockSelect,{block:o})},function(o){e.trigger(t.Events.onBlockDeselect,{block:o})},function(o,i,n){e.trigger(t.Events.onBlockMove,{block:o,from:i,to:n}),e.trigger(t.Events.onChange,{blocks:e.getData(),html:e.getHtml()})},n,this.options.onUpload)},e.prototype.initAsync=function(){return __awaiter(this,void 0,void 0,function(){var o,i,n;return __generator(this,function(r){switch(r.label){case 0:return o=this,e.UI.toggleToolsLoader(!0),[4,t.Services.TemplateService.loadTemplatesAsync(o.options.templatesUrl,o.$editor,o.onError)];case 1:return i=r.sent(),e.UI.toggleToolsLoader(!1),e.UI.setTemplates(i),[4,this.tryLoadInitialBlocksAsync()];case 2:return n=r.sent(),this.loadBlocks(n),this.isLoaded=!0,this.trigger(t.Events.onLoad,this),[2]}})})},e.prototype.tryLoadInitialBlocksAsync=function(){return __awaiter(this,void 0,void 0,function(){var e,o,i=this;return __generator(this,function(n){return e=this.options.blocksUrl,o=this,[2,new Promise(function(n,r){return __awaiter(i,void 0,void 0,function(){var i,l;return __generator(this,function(s){switch(s.label){case 0:if(!e)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,t.$ajax.get(e)];case 2:return i=s.sent(),n(i),[3,4];case 3:return l=s.sent(),o.onError(t.EditorStrings.errorBlocksFileNotFound(e)),r(l),[3,4];case 4:return[3,6];case 5:n(this.options.blocks?this.options.blocks:null),s.label=6;case 6:return[2]}})})})]})})},e.prototype.tryBindFormSubmit=function(){var e=this,o=this.options.formSelector?t.$dom.find(this.options.formSelector):null,i=this.options.inputSelector?t.$dom.find(this.options.inputSelector):null;o&&i&&i instanceof HTMLInputElement&&t.$dom.on(o,"submit",function(){return i.value=JSON.stringify(e.getData()),!0})},e.prototype.getData=function(){return this.container.getData(this.options.ignoreHtml)},e.prototype.getHtml=function(){return this.container.getHtml()},e.prototype.loadBlocks=function(e){var o=this;e&&e.length&&e.forEach(function(e){var i=t.Services.TemplateService.getTemplate(e.template);if(i)o.container.addBlock(i,e.fields,null,!1);else{var n=t.EditorStrings.errorBlockTemplateNotFound(e.template);o.onError(n)}})},e.prototype.addBlock=function(t){this.getContainer(this.container).addBlock(t,null,null,!0)},e.prototype.getContainer=function(t){if(t.selectedBlock&&t.selectedBlock.isContainer()){var e=t.selectedBlock.selectedField;if(e)return this.getContainer(e.container)}return t},e.prototype.trigger=function(e,o){var i=this;t.$dom.trigger(this.$editor,"bre."+e,o),t.Common.propsEach(i.options,function(t,i){t.breEqualsInvariant(e)&&i&&i(o)})},e}();t.Editor=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t){this.templatesUrl="templates/bootstrap4.html",this.onError=function(t){console.log(t.message)},this.compactTools=null,this.compactToolsWidth=768,this.ignoreHtml=null,this.htmlToolsButtons=null,this.templatesUrl=t.templatesUrl||this.templatesUrl,this.onLoad=t.onLoad||t.onload,this.onChange=t.onChange,this.onBlockAdd=t.onBlockAdd,this.onBlockDelete=t.onBlockDelete,this.onBlockMove=t.onBlockMove,this.onBlockSelect=t.onBlockSelect,this.onBlockDeselect=t.onBlockDeselect,this.onBlockUpdate=t.onBlockUpdate,this.onError=t.onError||this.onError,this.onUpload=t.onUpload||null,this.blocksUrl=t.blocksUrl||null,this.blocks=t.blocks||null,this.compactTools=t.compactTools,this.ignoreHtml=t.ignoreHtml||!1,this.htmlToolsButtons=t.htmlToolsButtons||null,this.formSelector=t.formSelector||null,this.inputSelector=t.inputSelector||null}return t}();t.EditorOptions=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.errorBlocksFileNotFound=function(t){return"Blocks file not found. Requested file: "+t+"."},t.errorTemplatesFileNotFound=function(t){return"Templates file not found. Requested file: "+t+"."},t.errorBlockTemplateNotFound=function(t){return'Template "'+t+'" not found.'},t.errorTemplateParsing=function(t){return"Template parsing error: "+t+"."},t.embedFieldLinkTitle="Link to embed media",t.embedFieldLinkPlaceholder="Link to instagram, youtube and etc.",t.imageFieldLinkTitle="Image link",t.imageFieldLinkPlaceholder="http://url-to-image.png",t.imageFieldUploadTitle="or Upload a file",t.imageFieldUploadButton="Select file",t.imageFieldAltTitle="Alt",t.imageFieldAltPlaceholder="Image 'alt' attribute value",t.imageFieldUrlSubtitle="Link to open on image click",t.htmlEditorLinkUrlTitle="Url",t.htmlEditorLinkUrlPlaceholder="http://put-your-link.here",t.htmlEditorLinkTitleTitle="Title",t.htmlEditorLinkTitlePlaceholder="Title attribute for link",t.htmlEditorLinkTargetTitle="Target",t.htmlEditorLinkTargetBlank="Blank",t.htmlEditorLinkTargetSelf="Self",t.htmlEditorLinkTargetParent="Parent",t.htmlEditorLinkTargetTop="Top",t.buttonClose="close",t.buttonOk="Ok",t.buttonCancel="Cancel",t.defaultTemplatesGroupName="Other templates",t}();t.EditorStrings=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.onLoad="onLoad",t.onChange="onChange",t.onBlockAdd="onBlockAdd",t.onBlockDelete="onBlockDelete",t.onBlockMove="onBlockMove",t.onBlockSelect="onBlockSelect",t.onBlockDeselect="onBlockDeselect",t.onBlockUpdate="onBlockUpdate",t}();t.Events=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,o){void 0===t&&(t=""),void 0===e&&(e=""),void 0===o&&(o=""),this.href=t,this.title=e,this.target=o}return e.prototype.getLinkPromptParams=function(){return[new t.Prompt.PromptParameter("href",t.EditorStrings.htmlEditorLinkUrlTitle,this.href,t.EditorStrings.htmlEditorLinkUrlPlaceholder),new t.Prompt.PromptParameter("title",t.EditorStrings.htmlEditorLinkTitleTitle,this.title,t.EditorStrings.htmlEditorLinkTitlePlaceholder),new t.Prompt.PromptParameterOptions("target",t.EditorStrings.htmlEditorLinkTargetTitle,[["",""],[t.EditorStrings.htmlEditorLinkTargetBlank,"_blank"],[t.EditorStrings.htmlEditorLinkTargetSelf,"_self"],[t.EditorStrings.htmlEditorLinkTargetParent,"_parent"],[t.EditorStrings.htmlEditorLinkTargetTop,"_top"]],this.target)]},e.getLinkFromParams=function(t){return new e(t.getValue("href"),t.getValue("title"),t.getValue("target"))},e}();t.HtmlLinkParams=e}(BrickyEditor||(BrickyEditor={})),function(t){t.fn.brickyeditor=function(e){var o=new BrickyEditor.Editor(t(this)[0],e);return o.initAsync(),o}}(jQuery);var BrickyEditor;!function(t){var e=function(){function t(){}return t.get=function(t){return new Promise(function(e,o){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var t=null;try{t=JSON.parse(this.responseText)}catch(e){t=this.responseText}try{e(t)}catch(t){o(t)}}else o()},i.send(),i=null})},t.getScript=function(t){return new Promise(function(e,o){var i=document.createElement("script"),n=!1,r=function(){n||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState?o():(n=!0,e())};i.onload=r,i.onreadystatechange=r,i.src=t,document.getElementsByTagName("head")[0].appendChild(i)})},t.jsonp=function(t){return new Promise(function(e,o){var i="_"+Math.round(1e4*Math.random()),n="jsonp_callback_"+i;window[n]=function(t){delete window[n];var o=document.getElementById(i);o.parentNode.removeChild(o),e(t)};var r=t+"&callback="+n,l=document.createElement("script");l.src=r,l.id=i,l.addEventListener("error",o),(document.getElementsByTagName("head")[0]||document.body||document.documentElement).appendChild(l)})},t}();t.$ajax=e}(BrickyEditor||(BrickyEditor={})),String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,o=Object(this),i=o.length>>>0,n=arguments[1],r=0;r<i;r++)if(e=o[r],t.call(n,e,r,o))return e});var BrickyEditor;!function(t){var e=function(){function t(){}return t.extend=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];t=t||{};for(var i=1;i<e.length;i++)if(e[i])for(var n in e[i])e[i].hasOwnProperty(n)&&(t[n]=e[i][n]);return t},t.getSelectedText=function(){var t="",e=document;return window.getSelection?t=window.getSelection().toString():e.selection&&"Control"!=e.selection.type&&(t=e.selection.createRange().text),t},t.propsEach=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];e(o,i)}},t.propsFilterKeys=function(e,o,i){var n=[];return t.propsEach(e,function(t,e){o(t,e)&&n.push(t)}),i&&n.push(i),n},t}();t.Common=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.el=function(t){var e=document.createElement("div");e.innerHTML=t;var o=e.firstElementChild;return e.innerHTML=null,o},t.ons=function(t,e,o){var i=this;e.split(" ").forEach(function(e){i.on(t,e,o)})},t.on=function(t,e,o){return t.attachEvent?t.attachEvent("on"+e,o):t.addEventListener(e,o,!1)},t.offset=function(t){var e=t.getBoundingClientRect(),o=document.body;return{top:e.top+o.scrollTop,left:e.left+o.scrollLeft}},t.wrap=function(t,e){t.parentElement.insertBefore(e,t),e.appendChild(t)},t.unwrap=function(t){if(t.parentElement){var e=t.parentElement.parentElement;e?e.replaceChild(t,t.parentElement):t.parentElement.innerHTML=t.innerHTML}},t.hide=function(t){t.style.display="none"},t.show=function(t){t.style.display="block"},t.isHidden=function(t){return"none"===window.getComputedStyle(t).display},t.toggle=function(t,e){(e?e.valueOf():this.isHidden(t))?this.show(t):this.hide(t)},t.before=function(t,e){var o=this;e instanceof HTMLElement?t.parentNode.insertBefore(e,t):e.forEach(function(e){return o.before(t,e)})},t.after=function(t,e){t.nextSibling?t.parentNode.insertBefore(e,t):t.parentNode.appendChild(e)},t.hasClass=function(t,e){t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},t.addClass=function(t,e){this.hasClass(t,e)||(t.classList?t.classList.add(e):t.className+=" "+e)},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},t.toggleClass=function(t,e,o){if(o)return void(o.valueOf()?this.addClass(t,e):this.removeClass(t,e));if(t.classList)t.classList.toggle(e);else{for(var i=t.className.split(" "),n=-1,r=i.length;r--;)i[r]===e&&(n=r);n>=0?i.splice(n,1):i.push(e),t.className=i.join(" ")}},t.windowScrollTop=function(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop},t.replaceWith=function(t,e){var o=t.parentElement;o&&o.replaceChild(e,t)},t.select=function(e,o,i){void 0===i&&(i=!1);var n=e.querySelectorAll(o),r=Array.prototype.slice.call(n);return i&&i.valueOf()&&t.matches(e,o)&&r.push(e),r},t.find=function(t){return document.querySelector(t)},t.first=function(t,e){return t.querySelector(e)},t.clone=function(t){return t.cloneNode(!0)},t.trigger=function(t,e,o){if(window.CustomEvent)var i=new CustomEvent(e,{detail:o});else{var i=document.createEvent("CustomEvent");i.initCustomEvent(e,!0,!0,o)}t.dispatchEvent(i)},t.matches=function(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)},t.data=function(t,e){var o=t.dataset[e],i=null;try{i=JSON.parse(o)}catch(t){if(t instanceof SyntaxError){o=o.replace(/'/g,'"');try{i=JSON.parse(o)}catch(t){}}}return i},t}();t.$dom=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,o,i,n,r,l,s,a,c,d){var u=this;this.template=e,this.onDelete=n,this.onSelect=r,this.onDeselect=l,this.onCopy=s,this.onMove=a,this.onUpdate=c,this.onUpload=d,this.fields=[];var h=t.$dom.el(e.$html.innerHTML);this.bindFields(h,i);var p=this.getActions();this.ui=new t.BlockUI(h,o,p,function(){return u.select()})}return e.prototype.isContainer=function(){return!!this.selectedField&&this.selectedField instanceof t.Fields.ContainerField},e.prototype.bindFields=function(e,o){var i=this;t.$dom.select(e,t.Selectors.selectorField,!0).forEach(function(e){var n=function(t,e,o){i.onUpdate&&i.onUpdate(i,t,e,o)},r=function(t){i.select(t)},l=t.Fields.BaseField.createField(e,o,r,n,i.onUpload);i.fields.push(l)})},e.prototype.getActions=function(){var e=this;return[new t.BlockUIAction("ellipsis-h"),new t.BlockUIAction("trash-o",function(){return e.delete()}),new t.BlockUIAction("copy",function(){return e.clone()}),new t.BlockUIAction("angle-up",function(){return e.move(-1)}),new t.BlockUIAction("angle-down",function(){return e.move(1)})]},e.prototype.delete=function(){this.ui.delete(),this.onDelete(this)},e.prototype.move=function(t){this.onMove(this,t)},e.prototype.clone=function(){this.onCopy(this)},e.prototype.select=function(t){t!==this.selectedField&&(null===t&&(t=this.fields[0]),this.selectedField&&this.selectedField.deselect(),this.selectedField=t,this.ui.toggleSelection(!0),this.onSelect(this))},e.prototype.deselect=function(){this.selectedField=null,this.fields.forEach(function(t){t.deselect()}),this.ui.toggleSelection(!1),this.onDeselect(this)},e.prototype.scrollTo=function(){var e=t.$dom.offset(this.ui.$editor).top-100;e=e>0?e:0},e.prototype.getData=function(t){var e=[];this.fields.forEach(function(t){e.push(t.data)});var o={template:this.template.name,fields:e};return t||(o.html=this.getHtml(!0)),o},e.prototype.getHtml=function(e){var o=t.$dom.el(this.template.$html.innerHTML),i={};this.fields.forEach(function(t){var e=t.name||t.data.name;i[e]=t.getEl()}),t.$dom.select(o,t.Selectors.selectorField,!0).forEach(function(e){var o=t.$dom.data(e,"breField"),n=o.name,r=i[n];t.$dom.replaceWith(e,r)});var n=o.outerHTML;return n?e?n.breTotalTrim():n:null},e}();t.Block=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e,o){this.icon=t,this.action=e,this.title=o}return t}();t.BlockAction=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,o,i){this.$block=t,this.onSelect=i,e||this.buildEditorUI(o)}return e.prototype.delete=function(){this.$editor.remove()},e.prototype.toggleSelection=function(t){this.$editor.classList.toggle("bre-selected",t)},e.prototype.buildEditorUI=function(e){var o=this;this.$tools=t.$dom.el('<div class="bre-block-tools bre-btn-deck"></div>'),e.forEach(function(t){var e=o.buildButton(t);o.$tools.appendChild(e)}),t.UI.initBtnDeck(this.$tools),this.$editor=t.$dom.el('<div class="bre-block-wrapper"></div>'),this.$editor.appendChild(this.$tools),this.$editor.appendChild(this.$block),t.$dom.on(this.$editor,"mouseover",function(){o.$editor.classList.add("bre-active")}),t.$dom.on(this.$editor,"mouseout",function(){o.$editor.classList.remove("bre-active")}),t.$dom.on(this.$editor,"click",function(){o.onSelect()})},e.prototype.buildButton=function(e){var o=t.$dom.el('<button type="button" class="bre-btn"><i class="fa fa-'+e.icon+'"></i></button>');return e.action&&(o.onclick=function(t){return e.action(),t.stopPropagation(),!1}),o},e}();t.BlockUI=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e,o){this.icon=t,this.action=e,this.title=o}return t}();t.BlockUIAction=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function o(t,e,o,i,n){this.$field=t,this.data=e,this.onSelect=o,this.onUpdate=i,this.onUpload=n,this.bind()}return Object.defineProperty(o,"type",{get:function(){var t=this.name;return t=t.replace("Field",""),t=t.substring(0,1).toLowerCase()+t.substring(1)},enumerable:!0,configurable:!0}),o.prototype.getSettingsEl=function(){return null},o.registerCommonFields=function(){e.HtmlField.registerField(),e.ImageField.registerField(),e.EmbedField.registerField(),e.ContainerField.registerField()},o.registerField=function(){this._fields.hasOwnProperty(this.type)&&delete this._fields[this.type],this._fields[this.type]=this},o.createField=function(e,o,i,n,r){var l=t.$dom.data(e,"breField");if(!l||!l.name)throw"There is no data or data doesn't contains 'name' in field "+e.innerHTML;if(o){for(var s={},a=0;a<o.length;a++){var c=o[a];if(c.name.toLowerCase()===l.name.toLowerCase()){s=c;break}}s&&(l=t.Common.extend(l,s))}var d=l.type;if(null!=d){if(this._fields.hasOwnProperty(d)){var c=this._fields[d];return new c(e,l,i,n,r)}throw d+" field not found"}throw"Field type not defined in data-bre-field attribute"},o.prototype.bind=function(){},o.prototype.select=function(){this.$field.classList.add(t.Selectors.selectorFieldSelected),this.onSelect(this)},o.prototype.deselect=function(){this.$field.classList.remove(t.Selectors.selectorFieldSelected)},o.prototype.getEl=function(){var e=this.$field.cloneNode(!0);return e.attributes.removeNamedItem(t.Selectors.attrField),e},o.prototype.updateProperty=function(t,e,o){void 0===o&&(o=!0);var i=this.data[t];i!==e&&(this.data[t]=e,o&&this.onUpdate(t,i,e))},o._fields={},o}();e.BaseField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this,i=this.$field;this.container=new t.BlocksContainer(i,function(t){o.updateBlocks()},function(t){o.updateBlocks()},function(t){e.select()},function(t){},function(t){o.updateBlocks()},function(t){o.updateBlocks()},o.onUpload,!0),t.$dom.addClass(i,t.Selectors.selectorFieldContainer),t.$dom.on(i,"click",function(t){return o.select(),t.stopPropagation(),!1})},o.prototype.updateBlocks=function(){this.updateProperty("blocks",this.container.getData(!0),!0),this.updateProperty("html",this.container.getHtml(),!0)},o.prototype.deselect=function(){this.container.blocks.forEach(function(t){return t.deselect()}),this.$field.classList.remove(t.Selectors.selectorFieldSelected)},o.prototype.getEl=function(){var e=this.container.getHtml();return t.$dom.el(e)},o}(e.BaseField);e.ContainerField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.getSettingsEl=function(){var e=t.$dom.el('<div style="position: absolute;width: 100%; height: 100px;;text-align: center;font-weight: bold;vertical-align: middle;background: #333;opacity: 0.2;">Change embed element link</div>');return t.$dom.before(this.$field,e),e},Object.defineProperty(o.prototype,"settings",{get:function(){var t=this;return function(e){t.showEmbedLoaderAsync(e)}},enumerable:!0,configurable:!0}),o.prototype.bind=function(){var e=this,o=this,i=this.$field;t.$dom.on(i,"click",function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(t){return this.showEmbedLoaderAsync(o),[2]})})}),o.loadMedia(!1)},o.prototype.showEmbedLoaderAsync=function(e){return __awaiter(this,void 0,void 0,function(){var o,i;return __generator(this,function(n){switch(n.label){case 0:return[4,t.Editor.UI.modal.promptAsync(e.getPromptParams())];case 1:return null==(o=n.sent())?[3,3]:(i=o.getValue("url"))?(e.setUrl(i),[4,e.loadMedia(!0)]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},o.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("url",t.EditorStrings.embedFieldLinkTitle,this.data.url||"http://instagr.am/p/BO9VX2Vj4fF/",t.EditorStrings.embedFieldLinkPlaceholder)]},o.prototype.loadMedia=function(e){return __awaiter(this,void 0,void 0,function(){var o,i,n,r,l;return __generator(this,function(s){switch(s.label){case 0:return o=this,o.data&&o.data.url?[4,t.Services.EmbedService.getEmbedAsync(o.data.url)]:[2];case 1:return i=s.sent(),o.setEmbed(i,e),n=t.$dom.el(i.html),r=t.$dom.first(n,"script"),r&&(r.remove(),l=r.src,l.breStartsWith("//")&&(l="https:"+l,t.$ajax.getScript(l).then(function(){t.Services.EmbedService.processEmbed(i.provider_name)}))),o.$field.innerHTML="",o.$field.removeAttribute("class"),o.$field.removeAttribute("style"),o.$field.appendChild(n),o.select(),[2]}})})},o.prototype.setEmbed=function(t,e){void 0===e&&(e=!0),this.updateProperty("embed",t,e)},o.prototype.setUrl=function(t){this.updateProperty("url",t)},o}(e.BaseField);e.EmbedField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this,i=this.$field;t.$dom.matches(i,t.Selectors.selectorContentEditable)||i.setAttribute(t.Selectors.attrContentEditable,"true");var n=this.data.html||this.$field.innerHTML;this.setHtml(n,!1),i.innerHTML=this.data.html,t.SelectionUtils.bindTextSelection(i,function(e){t.Editor.UI.htmlTools.show(e)}),t.$dom.ons(i,"blur keyup paste input",function(t){e.setHtml(i.innerHTML)}),t.$dom.on(i,"paste",function(t){t.preventDefault();var e=t.originalEvent,o=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,o)}),t.$dom.on(i,"click",function(t){return o.select(),t.stopPropagation(),!1})},o.prototype.setHtml=function(t,e){void 0===e&&(e=!0),t=t.trim(),this.$field.innerHTML!==t&&(this.$field.innerHTML=t),this.updateProperty("html",t,e)},o.prototype.getEl=function(){var o=e.prototype.getEl.call(this);return o.removeAttribute(t.Selectors.attrContentEditable),o},o}(e.BaseField);e.HtmlField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this;this.data;this.setSrc(this.data.src,!1),t.$dom.on(this.$field,"click",function(){return __awaiter(e,void 0,void 0,function(){var e,i,n,r,l;return __generator(this,function(s){switch(s.label){case 0:return[4,t.Editor.UI.modal.promptAsync(o.getPromptParams())];case 1:return e=s.sent(),null!=e&&(i=e.getValue("file"),n=e.getValue("src"),i?o.onUpload?o.onUpload(i,function(t){o.setSrc(t),o.setFile(null)}):(o.setFile(i),o.setSrc(null)):n&&(o.setSrc(n),o.setFile(null)),r=e.getValue("alt"),o.setAlt(r),l=t.HtmlLinkParams.getLinkFromParams(e),this.setLink(l)),o.select(),[2]}})})})},o.prototype.getPromptParams=function(){var e=[new t.Prompt.PromptParameter("src",t.EditorStrings.imageFieldLinkTitle,this.data.url,t.EditorStrings.imageFieldLinkPlaceholder),new t.Prompt.PromptParameterImage("file",t.EditorStrings.imageFieldUploadTitle,this.data.file,t.EditorStrings.imageFieldUploadButton),new t.Prompt.PromptParameter("alt",t.EditorStrings.imageFieldAltTitle,this.data.alt,t.EditorStrings.imageFieldAltPlaceholder),new t.Prompt.PromptParameter(null,t.EditorStrings.imageFieldUrlSubtitle,null,null)],o=this.data.link?this.data.link:new t.HtmlLinkParams,i=o.getLinkPromptParams();return e.concat(i)},o.prototype.setSrc=function(t,e){void 0===e&&(e=!0),t&&(this.isImg?this.$field.setAttribute("src",t):this.$field.style.backgroundImage="url("+t),this.updateProperty("src",t,e)},o.prototype.setAlt=function(t){this.$field.setAttribute(this.isImg?"alt":"title",t),this.updateProperty("alt",t)},o.prototype.setFile=function(t){t&&(this.isImg?this.$field.setAttribute("src",t.fileContent):this.$field.style.backgroundImage="url("+t.fileContent+")"),this.updateProperty("file",t)},o.prototype.setLink=function(e){e&&e.href?this.$link?this.$link.href=e.href:(this.$link=t.$dom.el("<a href='"+e.href+"' title='"+e.title+"' target='"+e.target+"'></a>"),t.$dom.on(this.$link,"click",function(t){return t.stopPropagation(),!1}),t.$dom.wrap(this.$field,this.$link)):this.$link&&(t.$dom.unwrap(this.$field),this.$link=null,delete this.$link),this.updateProperty("link",e)},Object.defineProperty(o.prototype,"isImg",{get:function(){return this._isImg=this._isImg||"img"===this.$field.tagName.toLowerCase()},enumerable:!0,configurable:!0}),o.prototype.getEl=function(){var o=e.prototype.getEl.call(this),i=this.data.link;if(i&&i.href){var n=t.$dom.el("<a href='"+i.href+"' title='"+i.title+"' target='"+i.target+"'></a>");return n.appendChild(o),n}return o},o}(e.BaseField);e.ImageField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function e(t,e,o,i){this.key=t,this.title=e,this.placeholder=i||"",this.value=o}return e.prototype.parseValue=function(){this.$input&&(this.value=this.$input.value),this.$control=null,delete this._$control},Object.defineProperty(e.prototype,"$control",{get:function(){return this._$control||(this._$control=t.$dom.el("<div class="+(this.key?"bre-prompt-field":"bre-prompt-subtitle")+'>\n                            <label class="bre-label" for="'+this.key+'">'+(this.title?this.title:"Select file...")+"</label>\n                        </div>"),this.$input=this.key?this.getEditor():null,null!=this.$input&&this._$control.appendChild(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),e.prototype.getEditor=function(){var t=document.createElement("input");return t.id=this.key,t.className="bre-input",t.setAttribute("type","text"),t.setAttribute("placeholder",this.placeholder),t.value=this.value||"",t},e}();e.PromptParameter=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(o){function i(t,e,i,n){var r=o.call(this,t,e,i,n)||this;return i&&(r._value=i),r}return __extends(i,o),i.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},i.prototype.getEditor=function(){var o=this,i=this.value&&this.value.fileContent?this.value.fileContent:"",n=t.$dom.el("\n                <div class='bre-image-input'>\n                    <label for=\""+this.key+'">\n                        '+this.placeholder+'\n                    </label>                        \n                    <img src="'+i+'"/>                    \n                    <input type="file" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='bre-image-input-filename'></small>"),r=n.querySelector("input"),l=n.querySelector("img"),s=n.querySelector(".bre-image-input-filename");this.value;return o.updatePreview(l,s,this.value),r.onchange=function(){if(r.files&&r.files[0]){var t=new FileReader;t.onload=function(t){var i=t.target
;o._value=new e.PromptParameterImageResult,o._value.fileContent=i.result,o._value.fileInfo=new e.PromptParameterImageResultFile(r.files[0]),o.updatePreview(l,s,o._value)},t.readAsDataURL(r.files[0])}},n},i.prototype.updatePreview=function(t,e,o){o&&(t.src=o.fileContent,t.classList.add("bre-loaded"),e.innerText=o.fileInfo.name)},i}(e.PromptParameter);e.PromptParameterImage=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t}();t.PromptParameterImageResult=e;var o=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}();t.PromptParameterImageResultFile=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t){this.params=t}return t.prototype.getValue=function(t){var e=this.params.find(function(e){return e.key===t});return e?e.value:null},t}();t.PromptParameterList=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o){void 0===o&&(o=!1),this.title=t,this.value=e,this.selected=o}return t}();t.PromptParameterOption=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(o){function i(t,i,n,r,l){var s=o.call(this,t,i,r,l)||this;return s.options=[],n.forEach(function(t){s.options.push(new e.PromptParameterOption(t[0],t[1],t[1]==r))}),s}return __extends(i,o),i.prototype.getEditor=function(){var e=this.options.map(function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return t.$dom.el('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+e+"</select>")},i}(e.PromptParameter);e.PromptParameterOptions=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function e(){}return e.getEmbedAsync=function(e){var o=this,i="https://noembed.com/embed?url="+e;return new Promise(function(e,n){return __awaiter(o,void 0,void 0,function(){var o,r;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,t.$ajax.jsonp(i)];case 1:return o=l.sent(),e(o),[3,3];case 2:return r=l.sent(),n(r),[3,3];case 3:return[2]}})})})},e.processEmbed=function(t){switch(t){case e.Instagram:instgrm&&instgrm.Embeds.process()}},e.Instagram="Instagram",e}();e.EmbedService=o}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function e(){}return e.loadTemplatesAsync=function(e,o,i){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(l){return this.templates=[],n=this.templates,[2,new Promise(function(n,l){return __awaiter(r,void 0,void 0,function(){var r,s,a,c,d,u,h,p,f=this;return __generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),[4,t.$ajax.get(e)];case 1:return r=m.sent(),s=t.$dom.el("<div>"+r+"</div>"),a=t.$dom.select(s,"style",!1),a.length>0&&t.$dom.before(o,a),c=t.$dom.select(s,t.Selectors.selectorTemplateGroup),c.forEach(function(e){var o=e.getAttribute("title"),n=f.getTemplates(e,i);f.templates.push(new t.TemplateGroup(o,n)),e.remove()}),d=this.getTemplates(s,i),u=this.templates.length>0?t.EditorStrings.defaultTemplatesGroupName:"",h=new t.TemplateGroup(u,d),this.templates.push(h),n(this.templates),[3,3];case 2:return p=m.sent(),i(t.EditorStrings.errorTemplatesFileNotFound(e)),l(p),[3,3];case 3:return[2]}})})})]})})},e.getTemplates=function(e,o){var i=[];return t.$dom.select(e,t.Selectors.selectorTemplate).forEach(function(e){var n=new t.Template(e);n.loaded?i.push(n):o(t.EditorStrings.errorTemplateParsing(n.name))}),i},e.getTemplate=function(t){for(var e=0;e<this.templates.length;e++)for(var o=this.templates[e],i=0;i<o.templates.length;i++){var n=o.templates[i];if(n.name.breEqualsInvariant(t))return n}return null},e}();e.TemplateService=o}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e){if(this.loaded=!0,this.name=e.dataset.name,this.$preview=t.$dom.first(e,t.Selectors.selectorTemplatePreview),this.$preview&&e.removeChild(this.$preview),this.$html=e,!this.$preview){var o=new t.Block(this,!0),i=o.getHtml(!0);null===i?this.loaded=!1:this.$preview=t.$dom.el(i)}}return e.prototype.getPreview=function(){var e=t.$dom.el("<div class='"+t.Selectors.classTemplate+"'></div>");return e.appendChild(this.$preview),e},e}();t.Template=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e){this.name=t,this.templates=e}return t}();t.TemplateGroup=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t){this.editor=t,this.buttons=[{icon:"bold",command:"Bold",range:!0,aValueArgument:null},{icon:"italic",command:"Italic",range:!0,aValueArgument:null},{icon:"link",command:"CreateLink",range:!0,aValueArgument:null},{icon:"list-ul",command:"insertUnorderedList",range:!0,aValueArgument:null},{icon:"list-ol",command:"insertOrderedList",range:!0,aValueArgument:null},{icon:"undo",command:"Undo",range:!1,aValueArgument:null},{icon:"repeat",command:"Redo",range:!1,aValueArgument:null}],t.options.htmlToolsButtons&&(this.buttons=t.options.htmlToolsButtons),this.setControl()}return e.prototype.setControl=function(){var e=this,o=t.$dom.el('<div class="bre-html-tools-panel"></div>');this.buttons.forEach(function(t){var i=e.getButtonElement(t.icon,t.command,t.range,t.aValueArgument);o.appendChild(i)}),this.$control=t.$dom.el('<div class="bre-html-tools bre-btn-group"></div>'),this.$control.appendChild(o),t.$dom.hide(this.$control),this.editor.$editor.appendChild(this.$control)},e.prototype.getButtonElement=function(e,o,i,n){var r=this;void 0===i&&(i=!0),void 0===n&&(n=null);var l=t.$dom.el('<button type="button" class="bre-btn"><i class="fa fa-'+e+'"></i></button>');return l.onclick=function(){return __awaiter(r,void 0,void 0,function(){var e,r,l,s,a,c;return __generator(this,function(d){switch(d.label){case 0:return e=window.getSelection(),(r=e.rangeCount>0?e.getRangeAt(0):null,i&&!r)?[2]:"CreateLink"!=o?[3,2]:(l=this.getLinkPromptParamsInternal(e),[4,t.Editor.UI.modal.promptAsync(l)]);case 1:return s=d.sent(),a=t.HtmlLinkParams.getLinkFromParams(s),a.href&&(document.execCommand(o,!1,a.href),a.target&&e.anchorNode.parentElement.setAttribute("target",a.target),a.title&&e.anchorNode.parentElement.setAttribute("title",a.title)),[3,3];case 2:"string"==typeof n&&(c=n.replace("%%SELECTION%%",e.toString()));try{document.execCommand(o,!1,c)}catch(t){this.wrapSelectionToContainer(e),document.execCommand(o,!1,c)}d.label=3;case 3:return[2,!1]}})})},l},e.prototype.wrapSelectionToContainer=function(e){var o=e.anchorNode.parentElement,i=t.$dom.el('<div class="bre-temp-container" contenteditable="true">'+o.innerHTML+"</div>");o.innerHTML="",o.removeAttribute(t.Selectors.attrContentEditable),o.appendChild(i);var n=document.createRange();n.selectNodeContents(i),e.removeAllRanges(),e.addRange(n)},e.prototype.show=function(e){if(e&&e.width>1){var o=this.editor.$editor,i=t.$dom.offset(o),n=o.clientWidth,r=e.top-i.top+t.$dom.windowScrollTop()+e.height,l=this.$control.clientWidth,s=e.left-i.left+e.width/2-l/2;s<0?s=0:s+l>n&&(s=n-l),this.$control.style.top=r+"px",this.$control.style.left=s+"px",t.$dom.show(this.$control)}else t.$dom.hide(this.$control)},e.prototype.getLinkPromptParamsInternal=function(e){var o;if(e&&e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var i=e.anchorNode.parentNode;o=new t.HtmlLinkParams(i.getAttribute("href"),i.getAttribute("title"),i.getAttribute("target"))}else o=new t.HtmlLinkParams;return o.getLinkPromptParams()},e}();t.HtmlTools=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,o,i,n,r,l){this.$control=e,this.$closeBtn=o,this.$form=i,this.$btns=n,this.$okBtn=r,this.$cancelBtn=l;var s=this;t.$dom.on(o,"click",function(){s.hideModal()})}return e.prototype.hideModal=function(){this.restoreSelection(),t.$dom.hide(this.$control)},e.prototype.showModal=function(e,o){void 0===o&&(o=!0),this.saveSelection(),t.$dom.toggle(this.$btns,o),e&&(this.$form.appendChild(e),t.$dom.isHidden(e)&&t.$dom.show(e)),t.$dom.show(this.$control)},e.prototype.promptAsync=function(e){var o=this,i=this;return new Promise(function(n,r){for(var l=0;l<i.$form.children.length;l++){var s=i.$form.children[l];s!=o.$btns&&i.$form.removeChild(s)}e.forEach(function(e){t.$dom.before(o.$btns,e.$control)}),t.$dom.on(i.$okBtn,"click",function(){e.forEach(function(t){return t.parseValue()}),i.hideModal();var o=new t.Prompt.PromptParameterList(e);n(o)}),t.$dom.on(i.$cancelBtn,"click",function(){i.hideModal(),n(null)}),i.showModal()})},e.prototype.saveSelection=function(){var t=window.getSelection();this.selectionRanges=[];for(var e=0;e<t.rangeCount;e++)this.selectionRanges.push(t.getRangeAt(e))},e.prototype.restoreSelection=function(){if(this.selectionRanges&&0!=this.selectionRanges.length){var t=window.getSelection();t.removeAllRanges(),this.selectionRanges.forEach(function(e){return t.addRange(e)})}},e}();t.Modal=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,o;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(o=e.getRangeAt(0),o.deleteContents(),o.insertNode(document.createTextNode(t))))},t}();t.SelectionHelper=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(){}return e.bindTextSelection=function(e,o){var i=this;t.$dom.matches(e,"[contenteditable]")&&(t.$dom.on(e,"mouseup",function(){setTimeout(function(){var t=i.getSelectionRect();o(t)},0)}),t.$dom.on(e,"keyup",function(t){var e=i.getSelectionRect();o(e)}))},e.getSelectionRect=function(){var t=window.getSelection(),e=t.getRangeAt(0);if(e){var o=e.getBoundingClientRect();if(o)return o}return null},e}();t.SelectionUtils=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.attr=function(t){return"["+t+"]"},t.attrContentEditable="contenteditable",t.selectorContentEditable="contenteditable",t.attrField="data-bre-field",t.selectorField="["+t.attrField+"]",t.classEditor="bre-editor",t.classTemplate="bre-template",t.selectorTemplate="."+t.classTemplate,t.classTemplateGroup="bre-template-group",t.selectorTemplateGroup="."+t.classTemplateGroup,t.selectorTemplatePreview=".bre-template-preview",t.classMobile="brickyeditor-tools-mobile",t.htmlToolsCommand="data-bre-doc-command",t.htmlToolsCommandRange="data-bre-doc-command-range",t.selectorFieldSelected="bre-field-selected",t.selectorFieldContainer="bre-field-container",t.selectorHtmlToolsCommand=t.attr(t.htmlToolsCommand),t.selectorHtmlToolsCommandRange=t.attr(t.htmlToolsCommandRange),t}();t.Selectors=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e){this.editor=e,this.editor=e,this.setTools(),this.setModal(),this.htmlTools=new t.HtmlTools(this.editor)}return Object.defineProperty(e.prototype,"isCompactTools",{get:function(){var t=this.editor.options.compactTools;return null==t?window.innerWidth<this.editor.options.compactToolsWidth:t.valueOf()},enumerable:!0,configurable:!0}),e.prototype.setTools=function(){var e=this;this.$tools=t.$dom.el('<div class="bre bre-tools" data-bricky-tools></div>'),this.$toolsTemplates=t.$dom.el('<div class="bre-tools-templates"></div>'),this.$toolsLoader=t.$dom.el('<div class="bre-tools-loader"><b>Loading...</b></div>'),this.$toolsHideBtn=t.$dom.el('<button type="button" class="bre-tools-toggle"><div>►</div></button>'),this.$tools.appendChild(this.$toolsHideBtn),this.$tools.appendChild(this.$toolsLoader),this.$tools.appendChild(this.$toolsTemplates),this.$toolsHideBtn.onclick=function(t){return e.toggleTools()},this.editor.$editor.appendChild(this.$tools),this.isCompactTools&&(t.$dom.addClass(this.$tools,"bre-tools-templates-compact"),this.toggleTools())},e.prototype.toggleTools=function(){t.$dom.toggleClass(this.$tools,"bre-tools-collapsed",!t.$dom.hasClass(this.$toolsHideBtn,"bre-tools-toggle-collapsed")),t.$dom.toggleClass(this.$toolsHideBtn,"bre-tools-toggle-collapsed")},e.prototype.setModal=function(){var e=t.$dom.el('<div class="bre bre-modal"><div class="bre-modal-placeholder"></div></div>'),o=t.$dom.el('<div class="bre-modal-close"><a href="#">'+t.EditorStrings.buttonClose+" ✖</a></div>"),i=t.$dom.el('<div class="bre-modal-content"></div>'),n=t.$dom.el("<form></form>"),r=t.$dom.el('<div class="bre-btns"></div>'),l=t.$dom.el('<button type="button" class="bre-btn bre-btn-primary">'+t.EditorStrings.buttonOk+"</button>"),s=t.$dom.el('<button type="button" class="bre-btn">'+t.EditorStrings.buttonCancel+"</button>");r.appendChild(l),r.appendChild(s),n.appendChild(r),i.appendChild(n);var a=t.$dom.first(e,".bre-modal-placeholder");a.appendChild(o),a.appendChild(i),this.modal=new t.Modal(e,o,n,r,l,s),this.editor.$editor.appendChild(e)},e.prototype.toggleToolsLoader=function(e){t.$dom.toggle(this.$toolsLoader,e)},e.prototype.setTemplates=function(e){var o=this,i=this.editor;e.forEach(function(e){if(0!==e.templates.length){var n=t.$dom.el("<div class='"+t.Selectors.classTemplateGroup+"'>"+e.name+"</div>");o.$toolsTemplates.appendChild(n);var r=t.$dom.el("<div></div>");e.templates.forEach(function(t){var e=t.getPreview();e.setAttribute("title",t.name),e.onclick=function(e){return i.addBlock(t),e.stopPropagation(),!1},r.appendChild(e)}),t.$dom.on(n,"click",function(){t.$dom.toggle(r)}),o.$toolsTemplates.appendChild(r)}})},e.initBtnDeck=function(o){var i=t.$dom.select(o,".bre-btn"),n=i[0];t.$dom.on(n,"click",function(t){return e.toggleBtnDeck(o),t.stopPropagation(),!1})},e.toggleBtnDeck=function(e,o){var i=t.$dom.select(e,".bre-btn");if(i&&0!=i.length){var n=i[0];o=o||e.dataset.isOn||!1,o?(e.style.height="0",e.style.width="0",i.forEach(function(t,e){0!==e&&(t.style.opacity="0",t.style.top="0",t.style.left="0")})):(i.forEach(function(t,e){0!==e&&(t.style.opacity="1",t.style.left=(e+1)*(32+32/6)+"px")}),e.style.height="32px",e.style.width=(32+32/6)*i.length-32/6+"px"),t.$dom.toggleClass(n,"bre-btn-active",!o),e.dataset.isOn=String(!o)}},e}();t.UI=e}(BrickyEditor||(BrickyEditor={}));