var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(i,r){function l(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(l,s)}a((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function o(e){return function(t){return n([e,t])}}function n(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(l=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(l=l.call(r,o[1])).done)return l;switch(r=0,l&&(o=[0,l.value]),o[0]){case 0:case 1:l=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(l=a.trys,!(l=l.length>0&&l[l.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){a.label=o[1];break}if(6===o[0]&&a.label<l[1]){a.label=l[1],l=o;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(o);break}l[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{i=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,r,l,s,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("Common/DOMHelpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.el=function(e){var t=document.createElement("div");t.innerHTML=e;var o=t.firstElementChild;return t.innerHTML=null,o},e.ons=function(e,t,o){var n=this;t.split(" ").forEach(function(t){n.on(e,t,o)})},e.on=function(e,t,o){return e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o,!1)},e.offset=function(e){var t=e.getBoundingClientRect(),o=document.body;return{top:t.top+o.scrollTop,left:t.left+o.scrollLeft}},e.wrap=function(e,t){e.parentElement.insertBefore(t,e),t.appendChild(e)},e.unwrap=function(e){if(e.parentElement){var t=e.parentElement.parentElement;t?t.replaceChild(e,e.parentElement):e.parentElement.innerHTML=e.innerHTML}},e.hide=function(e){e.style.display="none"},e.show=function(e){e.style.display="block"},e.isHidden=function(e){return"none"===window.getComputedStyle(e).display},e.toggle=function(e,t){(t?t.valueOf():this.isHidden(e))?this.show(e):this.hide(e)},e.before=function(e,t){var o=this;t instanceof HTMLElement?e.parentNode.insertBefore(t,e):t.forEach(function(t){return o.before(e,t)})},e.after=function(e,t){e.nextSibling?e.parentNode.insertBefore(t,e):e.parentNode.appendChild(t)},e.hasClass=function(e,t){e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},e.addClass=function(e,t){this.hasClass(e,t)||(e.classList?e.classList.add(t):e.className+=" "+t)},e.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},e.toggleClass=function(e,t,o){if(o)return void(o.valueOf()?this.addClass(e,t):this.removeClass(e,t));if(e.classList)e.classList.toggle(t);else{for(var n=e.className.split(" "),i=-1,r=n.length;r--;)n[r]===t&&(i=r);i>=0?n.splice(i,1):n.push(t),e.className=n.join(" ")}},e.windowScrollTop=function(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop},e.replaceWith=function(e,t){var o=e.parentElement;o&&o.replaceChild(t,e)},e.select=function(t,o,n){void 0===n&&(n=!1);var i=t.querySelectorAll(o),r=Array.prototype.slice.call(i);return n&&n.valueOf()&&e.matches(t,o)&&r.push(t),r},e.find=function(e){return document.querySelector(e)},e.first=function(e,t){return e.querySelector(t)},e.clone=function(e){return e.cloneNode(!0)},e.trigger=function(e,t,o){if(window.CustomEvent)var n=new CustomEvent(t,{detail:o});else{var n=document.createEvent("CustomEvent");n.initCustomEvent(t,!0,!0,o)}e.dispatchEvent(n)},e.matches=function(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)},e.data=function(e,t){var o=e.dataset[t],n=null;try{n=JSON.parse(o)}catch(e){if(e instanceof SyntaxError){o=o.replace(/'/g,'"');try{n=JSON.parse(o)}catch(e){}}}return n},e}();t.$dom=o}),define("UI/Selectors",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.attr=function(e){return"["+e+"]"},e.attrContentEditable="contenteditable",e.selectorContentEditable="contenteditable",e.attrField="data-bre-field",e.selectorField="["+e.attrField+"]",e.classEditor="bre-editor",e.classTemplate="bre-template",e.selectorTemplate="."+e.classTemplate,e.classTemplateGroup="bre-template-group",e.selectorTemplateGroup="."+e.classTemplateGroup,e.selectorTemplatePreview=".bre-template-preview",e.classMobile="brickyeditor-tools-mobile",e.htmlToolsCommand="data-bre-doc-command",e.htmlToolsCommandRange="data-bre-doc-command-range",e.selectorFieldSelected="bre-field-selected",e.selectorFieldContainer="bre-field-container",e.selectorHtmlToolsCommand=e.attr(e.htmlToolsCommand),e.selectorHtmlToolsCommandRange=e.attr(e.htmlToolsCommandRange),e}();t.Selectors=o}),define("Templates/Template",["require","exports","Common/DOMHelpers","UI/Selectors","Block/Block"],function(e,t,o,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){if(this.loaded=!0,this.name=e.dataset.name,this.$preview=o.$dom.first(e,n.Selectors.selectorTemplatePreview),this.$preview&&e.removeChild(this.$preview),this.$html=e,!this.$preview){var t=new i.Block(this,!0),r=t.getHtml(!0);null===r?this.loaded=!1:this.$preview=o.$dom.el(r)}}return e.prototype.getPreview=function(){var e=o.$dom.el("<div class='"+n.Selectors.classTemplate+"'></div>");return e.appendChild(this.$preview),e},e}();t.Template=r}),define("Block/BlockUIAction",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,o){this.icon=e,this.action=t,this.title=o}return e}();t.BlockUIAction=o}),define("Common/Common",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),String.prototype.breContains=function(e){return this.indexOf(e)>=0},String.prototype.breStartsWith=function(e){return 0==this.indexOf(e)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(e){return this.toLowerCase()===e.toLowerCase()},Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,o=Object(this),n=o.length>>>0,i=arguments[1],r=0;r<n;r++)if(t=o[r],e.call(i,t,r,o))return t});var o=function(){function e(){}return e.extend=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];e=e||{};for(var n=1;n<t.length;n++)if(t[n])for(var i in t[n])t[n].hasOwnProperty(i)&&(e[i]=t[n][i]);return e},e.getSelectedText=function(){var e="",t=document;return window.getSelection?e=window.getSelection().toString():t.selection&&"Control"!=t.selection.type&&(e=t.selection.createRange().text),e},e.propsEach=function(e,t){for(var o in e)if(e.hasOwnProperty(o)){var n=e[o];t(o,n)}},e.propsFilterKeys=function(t,o,n){var i=[];return e.propsEach(t,function(e,t){o(e,t)&&i.push(e)}),n&&i.push(n),i},e}();t.Common=o}),define("Fields/BaseField",["require","exports","Common/DOMHelpers","Fields/Fields","Common/Common","UI/Selectors"],function(e,t,o,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t,o,n,i){this.$field=e,this.data=t,this.onSelect=o,this.onUpdate=n,this.onUpload=i,this.bind()}return Object.defineProperty(e,"type",{get:function(){var e=this.name;return e=e.replace("Field",""),e=e.substring(0,1).toLowerCase()+e.substring(1)},enumerable:!0,configurable:!0}),e.prototype.getSettingsEl=function(){return null},e.registerCommonFields=function(){n.HtmlField.registerField(),n.ImageField.registerField(),n.EmbedField.registerField(),n.ContainerField.registerField()},e.registerField=function(){this._fields.hasOwnProperty(this.type)&&delete this._fields[this.type],this._fields[this.type]=this},e.createField=function(e,t,n,r,l){var s=o.$dom.data(e,"breField");if(!s||!s.name)throw"There is no data or data doesn't contains 'name' in field "+e.innerHTML;if(t){for(var a={},c=0;c<t.length;c++){var d=t[c];if(d.name.toLowerCase()===s.name.toLowerCase()){a=d;break}}a&&(s=i.Common.extend(s,a))}var u=s.type;if(null!=u){if(this._fields.hasOwnProperty(u)){var d=this._fields[u];return new d(e,s,n,r,l)}throw u+" field not found"}throw"Field type not defined in data-bre-field attribute"},e.prototype.bind=function(){},e.prototype.select=function(){this.$field.classList.add(r.Selectors.selectorFieldSelected),this.onSelect(this)},e.prototype.deselect=function(){this.$field.classList.remove(r.Selectors.selectorFieldSelected)},e.prototype.getEl=function(){var e=this.$field.cloneNode(!0);return e.attributes.removeNamedItem(r.Selectors.attrField),e},e.prototype.updateProperty=function(e,t,o){void 0===o&&(o=!0);var n=this.data[e];n!==t&&(this.data[e]=t,o&&this.onUpdate(e,n,t))},e._fields={},e}();t.BaseField=l}),define("Fields/ContainerField",["require","exports","Common/DOMHelpers","UI/Selectors","BlocksContainer","Fields/BaseField"],function(e,t,o,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.bind=function(){var e=this,t=this,r=this.$field;this.container=new i.BlocksContainer(r,function(e){t.updateBlocks()},function(e){t.updateBlocks()},function(t){e.select()},function(e){},function(e){t.updateBlocks()},function(e){t.updateBlocks()},t.onUpload,!0),o.$dom.addClass(r,n.Selectors.selectorFieldContainer),o.$dom.on(r,"click",function(e){return t.select(),e.stopPropagation(),!1})},t.prototype.updateBlocks=function(){this.updateProperty("blocks",this.container.getData(!0),!0),this.updateProperty("html",this.container.getHtml(),!0)},t.prototype.deselect=function(){this.container.blocks.forEach(function(e){return e.deselect()}),this.$field.classList.remove(n.Selectors.selectorFieldSelected)},t.prototype.getEl=function(){var e=this.container.getHtml();return o.$dom.el(e)},t}(r.BaseField);t.ContainerField=l}),define("Common/AJAXHelper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.get=function(e){return new Promise(function(t,o){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var e=null;try{e=JSON.parse(this.responseText)}catch(t){e=this.responseText}try{t(e)}catch(e){o(e)}}else o()},n.send(),n=null})},e.getScript=function(e){return new Promise(function(t,o){var n=document.createElement("script"),i=!1,r=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState?o():(i=!0,t())};n.onload=r,n.onreadystatechange=r,n.src=e,document.getElementsByTagName("head")[0].appendChild(n)})},e.jsonp=function(e){return new Promise(function(t,o){var n="_"+Math.round(1e4*Math.random()),i="jsonp_callback_"+n;window[i]=function(e){delete window[i];var o=document.getElementById(n);o.parentNode.removeChild(o),t(e)};var r=e+"&callback="+i,l=document.createElement("script");l.src=r,l.id=n,l.addEventListener("error",o),(document.getElementsByTagName("head")[0]||document.body||document.documentElement).appendChild(l)})},e}();t.$ajax=o}),define("EditorStrings",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.errorBlocksFileNotFound=function(e){return"Blocks file not found. Requested file: "+e+"."},e.errorTemplatesFileNotFound=function(e){return"Templates file not found. Requested file: "+e+"."},e.errorBlockTemplateNotFound=function(e){return'Template "'+e+'" not found.'},e.errorTemplateParsing=function(e){return"Template parsing error: "+e+"."},e.embedFieldLinkTitle="Link to embed media",e.embedFieldLinkPlaceholder="Link to instagram, youtube and etc.",e.imageFieldLinkTitle="Image link",e.imageFieldLinkPlaceholder="http://url-to-image.png",e.imageFieldUploadTitle="or Upload a file",e.imageFieldUploadButton="Select file",e.imageFieldAltTitle="Alt",e.imageFieldAltPlaceholder="Image 'alt' attribute value",e.imageFieldUrlSubtitle="Link to open on image click",e.htmlEditorLinkUrlTitle="Url",e.htmlEditorLinkUrlPlaceholder="http://put-your-link.here",e.htmlEditorLinkTitleTitle="Title",e.htmlEditorLinkTitlePlaceholder="Title attribute for link",e.htmlEditorLinkTargetTitle="Target",e.htmlEditorLinkTargetBlank="Blank",e.htmlEditorLinkTargetSelf="Self",e.htmlEditorLinkTargetParent="Parent",e.htmlEditorLinkTargetTop="Top",e.buttonClose="close",e.buttonOk="Ok",e.buttonCancel="Cancel",e.defaultTemplatesGroupName="Other templates",e}();t.EditorStrings=o}),define("Services/EmbedService",["require","exports","Common/AJAXHelper"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.getEmbedAsync=function(e){var t=this,n="https://noembed.com/embed?url="+e;return new Promise(function(e,i){return __awaiter(t,void 0,void 0,function(){var t,r;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,o.$ajax.jsonp(n)];case 1:return t=l.sent(),e(t),[3,3];case 2:return r=l.sent(),i(r),[3,3];case 3:return[2]}})})})},e.processEmbed=function(t){switch(t){case e.Instagram:instgrm&&instgrm.Embeds.process()}},e.Instagram="Instagram",e}();t.EmbedService=n}),define("Templates/TemplateGroup",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.name=e,this.templates=t}return e}();t.TemplateGroup=o}),define("Services/TemplateService",["require","exports","EditorStrings","Templates/Template","Common/DOMHelpers","Common/AJAXHelper","UI/Selectors","Templates/TemplateGroup"],function(e,t,o,n,i,r,l,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.loadTemplatesAsync=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var a,c=this;return __generator(this,function(d){return this.templates=[],a=this.templates,[2,new Promise(function(a,d){return __awaiter(c,void 0,void 0,function(){var c,u,p,h,m,f,g,v,b=this;return __generator(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),[4,r.$ajax.get(e)];case 1:return c=y.sent(),u=i.$dom.el("<div>"+c+"</div>"),p=i.$dom.select(u,"style",!1),p.length>0&&i.$dom.before(t,p),h=i.$dom.select(u,l.Selectors.selectorTemplateGroup),h.forEach(function(e){var t=e.getAttribute("title"),o=b.getTemplates(e,n);b.templates.push(new s.TemplateGroup(t,o)),e.remove()}),m=this.getTemplates(u,n),f=this.templates.length>0?o.EditorStrings.defaultTemplatesGroupName:"",g=new s.TemplateGroup(f,m),this.templates.push(g),a(this.templates),[3,3];case 2:return v=y.sent(),n(o.EditorStrings.errorTemplatesFileNotFound(e)),d(v),[3,3];case 3:return[2]}})})})]})})},e.getTemplates=function(e,t){var r=[];return i.$dom.select(e,l.Selectors.selectorTemplate).forEach(function(e){var i=new n.Template(e);i.loaded?r.push(i):t(o.EditorStrings.errorTemplateParsing(i.name))}),r},e.getTemplate=function(e){for(var t=0;t<this.templates.length;t++)for(var o=this.templates[t],n=0;n<o.templates.length;n++){var i=o.templates[n];if(i.name.breEqualsInvariant(e))return i}return null},e}();t.TemplateService=a}),define("Services/Services",["require","exports","Services/EmbedService","Services/TemplateService"],function(e,t,o,n){"use strict";function i(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),i(o),i(n)}),define("Events",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.onLoad="onLoad",e.onChange="onChange",e.onBlockAdd="onBlockAdd",e.onBlockDelete="onBlockDelete",e.onBlockMove="onBlockMove",e.onBlockSelect="onBlockSelect",e.onBlockDeselect="onBlockDeselect",e.onBlockUpdate="onBlockUpdate",e}();t.Events=o}),define("Prompt/PromptParameter",["require","exports","Common/DOMHelpers"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,o,n){this.key=e,this.title=t,this.placeholder=n||"",this.value=o}return e.prototype.parseValue=function(){this.$input&&(this.value=this.$input.value),this.$control=null,delete this._$control},Object.defineProperty(e.prototype,"$control",{get:function(){return this._$control||(this._$control=o.$dom.el("<div class="+(this.key?"bre-prompt-field":"bre-prompt-subtitle")+'>\n                            <label class="bre-label" for="'+this.key+'">'+(this.title?this.title:"Select file...")+"</label>\n                        </div>"),this.$input=this.key?this.getEditor():null,null!=this.$input&&this._$control.appendChild(this.$input)),this._$control},set:function(e){this._$control=e},enumerable:!0,configurable:!0}),e.prototype.getEditor=function(){var e=document.createElement("input");return e.id=this.key,e.className="bre-input",e.setAttribute("type","text"),e.setAttribute("placeholder",this.placeholder),e.value=this.value||"",e},e}();t.PromptParameter=n}),define("Prompt/PromptParameterImage",["require","exports","Prompt/Prompt","Common/DOMHelpers"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,o,n,i){var r=e.call(this,t,o,n,i)||this;return n&&(r._value=n),r}return __extends(t,e),t.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},t.prototype.getEditor=function(){var e=this,t=this.value&&this.value.fileContent?this.value.fileContent:"",i=n.$dom.el("\n                <div class='bre-image-input'>\n                    <label for=\""+this.key+'">\n                        '+this.placeholder+'\n                    </label>                        \n                    <img src="'+t+'"/>                    \n                    <input type="file" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='bre-image-input-filename'></small>"),r=i.querySelector("input"),l=i.querySelector("img"),s=i.querySelector(".bre-image-input-filename");this.value;return e.updatePreview(l,s,this.value),r.onchange=function(){if(r.files&&r.files[0]){var t=new FileReader;t.onload=function(t){var n=t.target;e._value=new o.PromptParameterImageResult,e._value.fileContent=n.result,e._value.fileInfo=new o.PromptParameterImageResultFile(r.files[0]),e.updatePreview(l,s,e._value)},t.readAsDataURL(r.files[0])}},i},t.prototype.updatePreview=function(e,t,o){o&&(e.src=o.fileContent,e.classList.add("bre-loaded"),t.innerText=o.fileInfo.name)},t}(o.PromptParameter);t.PromptParameterImage=i}),define("Prompt/PromptParameterImageResult",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e}();t.PromptParameterImageResult=o;var n=function(){function e(e){this.name=e.name,this.size=e.size,this.type=e.type,this.lastModified=e.lastModified,this.lastModifiedDate=e.lastModifiedDate}return e}();t.PromptParameterImageResultFile=n}),define("Prompt/PromptParameterList",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.params=e}return e.prototype.getValue=function(e){var t=this.params.find(function(t){return t.key===e});return t?t.value:null},e}();t.PromptParameterList=o}),define("Prompt/PromptParameterOption",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,o){void 0===o&&(o=!1),this.title=e,this.value=t,this.selected=o}return e}();t.PromptParameterOption=o}),define("Prompt/PromptParameterOptions",["require","exports","Common/DOMHelpers","Prompt/Prompt"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,o,i,r,l){var s=e.call(this,t,o,r,l)||this;return s.options=[],i.forEach(function(e){s.options.push(new n.PromptParameterOption(e[0],e[1],e[1]==r))}),s}return __extends(t,e),t.prototype.getEditor=function(){var e=this.options.map(function(e){return'<option value="'+e.value+'" '+(e.selected?"selected":"")+">"+(e.title?e.title:e.value)+"</option>"});return o.$dom.el('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+e+"</select>")},t}(n.PromptParameter);t.PromptParameterOptions=i}),define("Prompt/Prompt",["require","exports","Prompt/PromptParameter","Prompt/PromptParameterImage","Prompt/PromptParameterImageResult","Prompt/PromptParameterList","Prompt/PromptParameterOption","Prompt/PromptParameterOptions"],function(e,t,o,n,i,r,l,s){"use strict";function a(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),a(o),a(n),a(i),a(r),a(l),a(s)}),define("HtmlLinkParams",["require","exports","Prompt/Prompt","EditorStrings"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,o){void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=""),this.href=e,this.title=t,this.target=o}return e.prototype.getLinkPromptParams=function(){return[new o.PromptParameter("href",n.EditorStrings.htmlEditorLinkUrlTitle,this.href,n.EditorStrings.htmlEditorLinkUrlPlaceholder),new o.PromptParameter("title",n.EditorStrings.htmlEditorLinkTitleTitle,this.title,n.EditorStrings.htmlEditorLinkTitlePlaceholder),new o.PromptParameterOptions("target",n.EditorStrings.htmlEditorLinkTargetTitle,[["",""],[n.EditorStrings.htmlEditorLinkTargetBlank,"_blank"],[n.EditorStrings.htmlEditorLinkTargetSelf,"_self"],[n.EditorStrings.htmlEditorLinkTargetParent,"_parent"],[n.EditorStrings.htmlEditorLinkTargetTop,"_top"]],this.target)]},e.getLinkFromParams=function(t){return new e(t.getValue("href"),t.getValue("title"),t.getValue("target"))},e}();t.HtmlLinkParams=i}),define("UI/HtmlTools",["require","exports","Common/DOMHelpers","Editor","HtmlLinkParams","UI/Selectors"],function(e,t,o,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e){this.editor=e,this.buttons=[{icon:"bold",command:"Bold",range:!0,aValueArgument:null},{icon:"italic",command:"Italic",range:!0,aValueArgument:null},{icon:"link",command:"CreateLink",range:!0,aValueArgument:null},{icon:"list-ul",command:"insertUnorderedList",range:!0,aValueArgument:null},{icon:"list-ol",command:"insertOrderedList",range:!0,aValueArgument:null},{icon:"undo",command:"Undo",range:!1,aValueArgument:null},{icon:"repeat",command:"Redo",range:!1,aValueArgument:null}],e.options.htmlToolsButtons&&(this.buttons=e.options.htmlToolsButtons),this.setControl()}return e.prototype.setControl=function(){var e=this,t=o.$dom.el('<div class="bre-html-tools-panel"></div>');this.buttons.forEach(function(o){var n=e.getButtonElement(o.icon,o.command,o.range,o.aValueArgument);t.appendChild(n)}),this.$control=o.$dom.el('<div class="bre-html-tools bre-btn-group"></div>'),this.$control.appendChild(t),o.$dom.hide(this.$control),this.editor.$editor.appendChild(this.$control)},e.prototype.getButtonElement=function(e,t,r,l){var s=this;void 0===r&&(r=!0),void 0===l&&(l=null);var a=o.$dom.el('<button type="button" class="bre-btn"><i class="fa fa-'+e+'"></i></button>');return a.onclick=function(){return __awaiter(s,void 0,void 0,function(){var e,o,s,a,c,d;return __generator(this,function(u){switch(u.label){case 0:return e=window.getSelection(),(o=e.rangeCount>0?e.getRangeAt(0):null,r&&!o)?[2]:"CreateLink"!=t?[3,2]:(s=this.getLinkPromptParamsInternal(e),[4,n.Editor.UI.modal.promptAsync(s)]);case 1:return a=u.sent(),c=i.HtmlLinkParams.getLinkFromParams(a),c.href&&(document.execCommand(t,!1,c.href),c.target&&e.anchorNode.parentElement.setAttribute("target",c.target),c.title&&e.anchorNode.parentElement.setAttribute("title",c.title)),[3,3];case 2:"string"==typeof l&&(d=l.replace("%%SELECTION%%",e.toString()));try{document.execCommand(t,!1,d)}catch(o){this.wrapSelectionToContainer(e),document.execCommand(t,!1,d)}u.label=3;case 3:return[2,!1]}})})},a},e.prototype.wrapSelectionToContainer=function(e){var t=e.anchorNode.parentElement,n=o.$dom.el('<div class="bre-temp-container" contenteditable="true">'+t.innerHTML+"</div>");t.innerHTML="",t.removeAttribute(r.Selectors.attrContentEditable),t.appendChild(n);var i=document.createRange();i.selectNodeContents(n),e.removeAllRanges(),e.addRange(i)},e.prototype.show=function(e){if(e&&e.width>1){var t=this.editor.$editor,n=o.$dom.offset(t),i=t.clientWidth,r=e.top-n.top+o.$dom.windowScrollTop()+e.height,l=this.$control.clientWidth,s=e.left-n.left+e.width/2-l/2;s<0?s=0:s+l>i&&(s=i-l),this.$control.style.top=r+"px",this.$control.style.left=s+"px",o.$dom.show(this.$control)}else o.$dom.hide(this.$control)},e.prototype.getLinkPromptParamsInternal=function(e){var t;if(e&&e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var o=e.anchorNode.parentNode;t=new i.HtmlLinkParams(o.getAttribute("href"),o.getAttribute("title"),o.getAttribute("target"))}else t=new i.HtmlLinkParams;return t.getLinkPromptParams()},e}();t.HtmlTools=l}),define("UI/Modal",["require","exports","Common/DOMHelpers","Prompt/Prompt"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i,r,l){this.$control=e,this.$closeBtn=t,this.$form=n,this.$btns=i,this.$okBtn=r,this.$cancelBtn=l;var s=this;o.$dom.on(t,"click",function(){s.hideModal()})}return e.prototype.hideModal=function(){this.restoreSelection(),o.$dom.hide(this.$control)},e.prototype.showModal=function(e,t){void 0===t&&(t=!0),this.saveSelection(),o.$dom.toggle(this.$btns,t),e&&(this.$form.appendChild(e),o.$dom.isHidden(e)&&o.$dom.show(e)),o.$dom.show(this.$control)},e.prototype.promptAsync=function(e){var t=this,i=this;return new Promise(function(r,l){for(var s=0;s<i.$form.children.length;s++){var a=i.$form.children[s];a!=t.$btns&&i.$form.removeChild(a)}e.forEach(function(e){o.$dom.before(t.$btns,e.$control)}),o.$dom.on(i.$okBtn,"click",function(){e.forEach(function(e){return e.parseValue()}),i.hideModal();var t=new n.PromptParameterList(e);r(t)}),o.$dom.on(i.$cancelBtn,"click",function(){i.hideModal(),r(null)}),i.showModal()})},e.prototype.saveSelection=function(){var e=window.getSelection();this.selectionRanges=[];for(var t=0;t<e.rangeCount;t++)this.selectionRanges.push(e.getRangeAt(t))},e.prototype.restoreSelection=function(){if(this.selectionRanges&&0!=this.selectionRanges.length){var e=window.getSelection();e.removeAllRanges(),this.selectionRanges.forEach(function(t){return e.addRange(t)})}},e}();t.Modal=i}),define("UI/UI",["require","exports","Common/DOMHelpers","UI/Selectors","EditorStrings","UI/HtmlTools","UI/Modal"],function(e,t,o,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.editor=e,this.editor=e,this.setTools(),this.setModal(),this.htmlTools=new r.HtmlTools(this.editor)}return Object.defineProperty(e.prototype,"isCompactTools",{get:function(){var e=this.editor.options.compactTools;return null==e?window.innerWidth<this.editor.options.compactToolsWidth:e.valueOf()},enumerable:!0,configurable:!0}),e.prototype.setTools=function(){var e=this;this.$tools=o.$dom.el('<div class="bre bre-tools" data-bricky-tools></div>'),this.$toolsTemplates=o.$dom.el('<div class="bre-tools-templates"></div>'),this.$toolsLoader=o.$dom.el('<div class="bre-tools-loader"><b>Loading...</b></div>'),this.$toolsHideBtn=o.$dom.el('<button type="button" class="bre-tools-toggle"><div>►</div></button>'),this.$tools.appendChild(this.$toolsHideBtn),this.$tools.appendChild(this.$toolsLoader),this.$tools.appendChild(this.$toolsTemplates),this.$toolsHideBtn.onclick=function(t){return e.toggleTools()},this.editor.$editor.appendChild(this.$tools),this.isCompactTools&&(o.$dom.addClass(this.$tools,"bre-tools-templates-compact"),this.toggleTools())},e.prototype.toggleTools=function(){o.$dom.toggleClass(this.$tools,"bre-tools-collapsed",!o.$dom.hasClass(this.$toolsHideBtn,"bre-tools-toggle-collapsed")),o.$dom.toggleClass(this.$toolsHideBtn,"bre-tools-toggle-collapsed")},e.prototype.setModal=function(){var e=o.$dom.el('<div class="bre bre-modal"><div class="bre-modal-placeholder"></div></div>'),t=o.$dom.el('<div class="bre-modal-close"><a href="#">'+i.EditorStrings.buttonClose+" ✖</a></div>"),n=o.$dom.el('<div class="bre-modal-content"></div>'),r=o.$dom.el("<form></form>"),s=o.$dom.el('<div class="bre-btns"></div>'),a=o.$dom.el('<button type="button" class="bre-btn bre-btn-primary">'+i.EditorStrings.buttonOk+"</button>"),c=o.$dom.el('<button type="button" class="bre-btn">'+i.EditorStrings.buttonCancel+"</button>");s.appendChild(a),s.appendChild(c),r.appendChild(s),n.appendChild(r);var d=o.$dom.first(e,".bre-modal-placeholder");d.appendChild(t),d.appendChild(n),this.modal=new l.Modal(e,t,r,s,a,c),this.editor.$editor.appendChild(e)},e.prototype.toggleToolsLoader=function(e){o.$dom.toggle(this.$toolsLoader,e)},e.prototype.setTemplates=function(e){var t=this,i=this.editor;e.forEach(function(e){if(0!==e.templates.length){var r=o.$dom.el("<div class='"+n.Selectors.classTemplateGroup+"'>"+e.name+"</div>");t.$toolsTemplates.appendChild(r);var l=o.$dom.el("<div></div>");e.templates.forEach(function(e){var t=e.getPreview();t.setAttribute("title",e.name),t.onclick=function(t){return i.addBlock(e),t.stopPropagation(),!1},l.appendChild(t)}),o.$dom.on(r,"click",function(){o.$dom.toggle(l)}),t.$toolsTemplates.appendChild(l)}})},e.initBtnDeck=function(t){var n=o.$dom.select(t,".bre-btn"),i=n[0];o.$dom.on(i,"click",function(o){return e.toggleBtnDeck(t),o.stopPropagation(),!1})},e.toggleBtnDeck=function(e,t){var n=o.$dom.select(e,".bre-btn");if(n&&0!=n.length){var i=n[0];t=t||e.dataset.isOn||!1,t?(e.style.height="0",e.style.width="0",n.forEach(function(e,t){0!==t&&(e.style.opacity="0",e.style.top="0",e.style.left="0")})):(n.forEach(function(e,t){0!==t&&(e.style.opacity="1",e.style.left=(t+1)*(32+32/6)+"px")}),e.style.height="32px",e.style.width=(32+32/6)*n.length-32/6+"px"),o.$dom.toggleClass(i,"bre-btn-active",!t),e.dataset.isOn=String(!t)}},e}();t.UI=s}),define("EditorOptions",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.templatesUrl="templates/bootstrap4.html",this.onError=function(e){console.log(e.message)},this.compactTools=null,this.compactToolsWidth=768,this.ignoreHtml=null,this.htmlToolsButtons=null,this.templatesUrl=e.templatesUrl||this.templatesUrl,this.onLoad=e.onLoad||e.onload,this.onChange=e.onChange,this.onBlockAdd=e.onBlockAdd,this.onBlockDelete=e.onBlockDelete,this.onBlockMove=e.onBlockMove,this.onBlockSelect=e.onBlockSelect,this.onBlockDeselect=e.onBlockDeselect,this.onBlockUpdate=e.onBlockUpdate,this.onError=e.onError||this.onError,this.onUpload=e.onUpload||null,this.blocksUrl=e.blocksUrl||null,this.blocks=e.blocks||null,this.compactTools=e.compactTools,this.ignoreHtml=e.ignoreHtml||!1,this.htmlToolsButtons=e.htmlToolsButtons||null,
this.formSelector=e.formSelector||null,this.inputSelector=e.inputSelector||null}return e}();t.EditorOptions=o}),define("Editor",["require","exports","Common/DOMHelpers","Common/AJAXHelper","BlocksContainer","EditorStrings","Services/Services","Events","Fields/Fields","UI/Selectors","UI/UI","Common/Common","EditorOptions"],function(e,t,o,n,i,r,l,s,a,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(t,o){var n=this;this.onError=function(e,t){return void 0===t&&(t=0),n.options.onError({message:e,code:t})},a.BaseField.registerCommonFields(),this.$editor=t,this.$editor.classList.add(c.Selectors.classEditor),this.options=new p.EditorOptions(o),this.container=this.createContainer(),e.UI=new d.UI(this),this.tryBindFormSubmit()}return e.prototype.createContainer=function(){var e=this,t=function(t,o){e.isLoaded&&(e.trigger(s.Events.onBlockAdd,{block:t,idx:o}),e.trigger(s.Events.onChange,{blocks:e.getData(),html:e.getHtml()}))},o=function(t,o){e.trigger(s.Events.onBlockDelete,{block:t,idx:o}),e.trigger(s.Events.onChange,{blocks:e.getData(),html:e.getHtml()})},n=function(t,o,n,i){e.trigger(s.Events.onBlockUpdate,{block:t,property:o,oldValue:n,newValue:i}),e.trigger(s.Events.onChange,{blocks:e.getData(),html:e.getHtml()})};return new i.BlocksContainer(this.$editor,t,o,function(t){e.trigger(s.Events.onBlockSelect,{block:t})},function(t){e.trigger(s.Events.onBlockDeselect,{block:t})},function(t,o,n){e.trigger(s.Events.onBlockMove,{block:t,from:o,to:n}),e.trigger(s.Events.onChange,{blocks:e.getData(),html:e.getHtml()})},n,this.options.onUpload)},e.prototype.initAsync=function(){return __awaiter(this,void 0,void 0,function(){var t,o,n;return __generator(this,function(i){switch(i.label){case 0:return t=this,e.UI.toggleToolsLoader(!0),[4,l.TemplateService.loadTemplatesAsync(t.options.templatesUrl,t.$editor,t.onError)];case 1:return o=i.sent(),e.UI.toggleToolsLoader(!1),e.UI.setTemplates(o),[4,this.tryLoadInitialBlocksAsync()];case 2:return n=i.sent(),this.loadBlocks(n),this.isLoaded=!0,this.trigger(s.Events.onLoad,this),[2]}})})},e.prototype.tryLoadInitialBlocksAsync=function(){return __awaiter(this,void 0,void 0,function(){var e,t,o=this;return __generator(this,function(i){return e=this.options.blocksUrl,t=this,[2,new Promise(function(i,l){return __awaiter(o,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:if(!e)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n.$ajax.get(e)];case 2:return o=a.sent(),i(o),[3,4];case 3:return s=a.sent(),t.onError(r.EditorStrings.errorBlocksFileNotFound(e)),l(s),[3,4];case 4:return[3,6];case 5:i(this.options.blocks?this.options.blocks:null),a.label=6;case 6:return[2]}})})})]})})},e.prototype.tryBindFormSubmit=function(){var e=this,t=this.options.formSelector?o.$dom.find(this.options.formSelector):null,n=this.options.inputSelector?o.$dom.find(this.options.inputSelector):null;t&&n&&n instanceof HTMLInputElement&&o.$dom.on(t,"submit",function(){return n.value=JSON.stringify(e.getData()),!0})},e.prototype.getData=function(){return this.container.getData(this.options.ignoreHtml)},e.prototype.getHtml=function(){return this.container.getHtml()},e.prototype.loadBlocks=function(e){var t=this;e&&e.length&&e.forEach(function(e){var o=l.TemplateService.getTemplate(e.template);if(o)t.container.addBlock(o,e.fields,null,!1);else{var n=r.EditorStrings.errorBlockTemplateNotFound(e.template);t.onError(n)}})},e.prototype.addBlock=function(e){this.getContainer(this.container).addBlock(e,null,null,!0)},e.prototype.getContainer=function(e){if(e.selectedBlock&&e.selectedBlock.isContainer()){var t=e.selectedBlock.selectedField;if(t)return this.getContainer(t.container)}return e},e.prototype.trigger=function(e,t){var n=this;o.$dom.trigger(this.$editor,"bre."+e,t),u.Common.propsEach(n.options,function(o,n){o.breEqualsInvariant(e)&&n&&n(t)})},e}();t.Editor=h}),define("Fields/EmbedField",["require","exports","Common/DOMHelpers","Fields/BaseField","Editor","EditorStrings","Common/AJAXHelper","Prompt/Prompt","Services/Services"],function(e,t,o,n,i,r,l,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getSettingsEl=function(){var e=o.$dom.el('<div style="position: absolute;width: 100%; height: 100px;;text-align: center;font-weight: bold;vertical-align: middle;background: #333;opacity: 0.2;">Change embed element link</div>');return o.$dom.before(this.$field,e),e},Object.defineProperty(t.prototype,"settings",{get:function(){var e=this;return function(t){e.showEmbedLoaderAsync(t)}},enumerable:!0,configurable:!0}),t.prototype.bind=function(){var e=this,t=this,n=this.$field;o.$dom.on(n,"click",function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return this.showEmbedLoaderAsync(t),[2]})})}),t.loadMedia(!1)},t.prototype.showEmbedLoaderAsync=function(e){return __awaiter(this,void 0,void 0,function(){var t,o;return __generator(this,function(n){switch(n.label){case 0:return[4,i.Editor.UI.modal.promptAsync(e.getPromptParams())];case 1:return null==(t=n.sent())?[3,3]:(o=t.getValue("url"))?(e.setUrl(o),[4,e.loadMedia(!0)]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.getPromptParams=function(){return[new s.PromptParameter("url",r.EditorStrings.embedFieldLinkTitle,this.data.url||"http://instagr.am/p/BO9VX2Vj4fF/",r.EditorStrings.embedFieldLinkPlaceholder)]},t.prototype.loadMedia=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,r,s;return __generator(this,function(c){switch(c.label){case 0:return t=this,t.data&&t.data.url?[4,a.EmbedService.getEmbedAsync(t.data.url)]:[2];case 1:return n=c.sent(),t.setEmbed(n,e),i=o.$dom.el(n.html),r=o.$dom.first(i,"script"),r&&(r.remove(),s=r.src,s.breStartsWith("//")&&(s="https:"+s,l.$ajax.getScript(s).then(function(){a.EmbedService.processEmbed(n.provider_name)}))),t.$field.innerHTML="",t.$field.removeAttribute("class"),t.$field.removeAttribute("style"),t.$field.appendChild(i),t.select(),[2]}})})},t.prototype.setEmbed=function(e,t){void 0===t&&(t=!0),this.updateProperty("embed",e,t)},t.prototype.setUrl=function(e){this.updateProperty("url",e)},t}(n.BaseField);t.EmbedField=c}),define("UI/SelectionUtils",["require","exports","Common/DOMHelpers"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.bindTextSelection=function(e,t){var n=this;o.$dom.matches(e,"[contenteditable]")&&(o.$dom.on(e,"mouseup",function(){setTimeout(function(){var e=n.getSelectionRect();t(e)},0)}),o.$dom.on(e,"keyup",function(e){var o=n.getSelectionRect();t(o)}))},e.getSelectionRect=function(){var e=window.getSelection(),t=e.getRangeAt(0);if(t){var o=t.getBoundingClientRect();if(o)return o}return null},e}();t.SelectionUtils=n}),define("Fields/HtmlField",["require","exports","Common/DOMHelpers","UI/Selectors","Fields/BaseField","Editor","UI/SelectionUtils"],function(e,t,o,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.bind=function(){var e=this,t=this,i=this.$field;o.$dom.matches(i,n.Selectors.selectorContentEditable)||i.setAttribute(n.Selectors.attrContentEditable,"true");var s=this.data.html||this.$field.innerHTML;this.setHtml(s,!1),i.innerHTML=this.data.html,l.SelectionUtils.bindTextSelection(i,function(e){r.Editor.UI.htmlTools.show(e)}),o.$dom.ons(i,"blur keyup paste input",function(t){e.setHtml(i.innerHTML)}),o.$dom.on(i,"paste",function(e){e.preventDefault();var t=e.originalEvent,o=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,o)}),o.$dom.on(i,"click",function(e){return t.select(),e.stopPropagation(),!1})},t.prototype.setHtml=function(e,t){void 0===t&&(t=!0),e=e.trim(),this.$field.innerHTML!==e&&(this.$field.innerHTML=e),this.updateProperty("html",e,t)},t.prototype.getEl=function(){var t=e.prototype.getEl.call(this);return t.removeAttribute(n.Selectors.attrContentEditable),t},t}(i.BaseField);t.HtmlField=s}),define("Fields/ImageField",["require","exports","Fields/BaseField","Editor","Common/DOMHelpers","Prompt/Prompt","HtmlLinkParams","EditorStrings"],function(e,t,o,n,i,r,l,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.bind=function(){var e=this,t=this;this.data;this.setSrc(this.data.src,!1),i.$dom.on(this.$field,"click",function(){return __awaiter(e,void 0,void 0,function(){var e,o,i,r,s;return __generator(this,function(a){switch(a.label){case 0:return[4,n.Editor.UI.modal.promptAsync(t.getPromptParams())];case 1:return e=a.sent(),null!=e&&(o=e.getValue("file"),i=e.getValue("src"),o?t.onUpload?t.onUpload(o,function(e){t.setSrc(e),t.setFile(null)}):(t.setFile(o),t.setSrc(null)):i&&(t.setSrc(i),t.setFile(null)),r=e.getValue("alt"),t.setAlt(r),s=l.HtmlLinkParams.getLinkFromParams(e),this.setLink(s)),t.select(),[2]}})})})},t.prototype.getPromptParams=function(){var e=[new r.PromptParameter("src",s.EditorStrings.imageFieldLinkTitle,this.data.url,s.EditorStrings.imageFieldLinkPlaceholder),new r.PromptParameterImage("file",s.EditorStrings.imageFieldUploadTitle,this.data.file,s.EditorStrings.imageFieldUploadButton),new r.PromptParameter("alt",s.EditorStrings.imageFieldAltTitle,this.data.alt,s.EditorStrings.imageFieldAltPlaceholder),new r.PromptParameter(null,s.EditorStrings.imageFieldUrlSubtitle,null,null)],t=this.data.link?this.data.link:new l.HtmlLinkParams,o=t.getLinkPromptParams();return e.concat(o)},t.prototype.setSrc=function(e,t){void 0===t&&(t=!0),e&&(this.isImg?this.$field.setAttribute("src",e):this.$field.style.backgroundImage="url("+e),this.updateProperty("src",e,t)},t.prototype.setAlt=function(e){this.$field.setAttribute(this.isImg?"alt":"title",e),this.updateProperty("alt",e)},t.prototype.setFile=function(e){e&&(this.isImg?this.$field.setAttribute("src",e.fileContent):this.$field.style.backgroundImage="url("+e.fileContent+")"),this.updateProperty("file",e)},t.prototype.setLink=function(e){e&&e.href?this.$link?this.$link.href=e.href:(this.$link=i.$dom.el("<a href='"+e.href+"' title='"+e.title+"' target='"+e.target+"'></a>"),i.$dom.on(this.$link,"click",function(e){return e.stopPropagation(),!1}),i.$dom.wrap(this.$field,this.$link)):this.$link&&(i.$dom.unwrap(this.$field),this.$link=null,delete this.$link),this.updateProperty("link",e)},Object.defineProperty(t.prototype,"isImg",{get:function(){return this._isImg=this._isImg||"img"===this.$field.tagName.toLowerCase()},enumerable:!0,configurable:!0}),t.prototype.getEl=function(){var t=e.prototype.getEl.call(this),o=this.data.link;if(o&&o.href){var n=i.$dom.el("<a href='"+o.href+"' title='"+o.title+"' target='"+o.target+"'></a>");return n.appendChild(t),n}return t},t}(o.BaseField);t.ImageField=a}),define("Fields/Fields",["require","exports","Fields/BaseField","Fields/ContainerField","Fields/EmbedField","Fields/HtmlField","Fields/ImageField"],function(e,t,o,n,i,r,l){"use strict";function s(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),s(o),s(n),s(i),s(r),s(l)}),define("Block/BlockUI",["require","exports","Common/DOMHelpers","UI/UI"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,o,n){this.$block=e,this.onSelect=n,t||this.buildEditorUI(o)}return e.prototype.delete=function(){this.$editor.remove()},e.prototype.toggleSelection=function(e){this.$editor.classList.toggle("bre-selected",e)},e.prototype.buildEditorUI=function(e){var t=this;this.$tools=o.$dom.el('<div class="bre-block-tools bre-btn-deck"></div>'),e.forEach(function(e){var o=t.buildButton(e);t.$tools.appendChild(o)}),n.UI.initBtnDeck(this.$tools),this.$editor=o.$dom.el('<div class="bre-block-wrapper"></div>'),this.$editor.appendChild(this.$tools),this.$editor.appendChild(this.$block),o.$dom.on(this.$editor,"mouseover",function(){t.$editor.classList.add("bre-active")}),o.$dom.on(this.$editor,"mouseout",function(){t.$editor.classList.remove("bre-active")}),o.$dom.on(this.$editor,"click",function(){t.onSelect()})},e.prototype.buildButton=function(e){var t=o.$dom.el('<button type="button" class="bre-btn"><i class="fa fa-'+e.icon+'"></i></button>');return e.action&&(t.onclick=function(t){return e.action(),t.stopPropagation(),!1}),t},e}();t.BlockUI=i}),define("Block/Block",["require","exports","Common/DOMHelpers","UI/Selectors","Block/BlockUIAction","Fields/Fields","Block/BlockUI"],function(e,t,o,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,n,i,r,s,a,c,d,u){var p=this;this.template=e,this.onDelete=i,this.onSelect=r,this.onDeselect=s,this.onCopy=a,this.onMove=c,this.onUpdate=d,this.onUpload=u,this.fields=[];var h=o.$dom.el(e.$html.innerHTML);this.bindFields(h,n);var m=this.getActions();this.ui=new l.BlockUI(h,t,m,function(){return p.select()})}return e.prototype.isContainer=function(){return!!this.selectedField&&this.selectedField instanceof r.ContainerField},e.prototype.bindFields=function(e,t){var i=this;o.$dom.select(e,n.Selectors.selectorField,!0).forEach(function(e){var o=function(e,t,o){i.onUpdate&&i.onUpdate(i,e,t,o)},n=function(e){i.select(e)},l=r.BaseField.createField(e,t,n,o,i.onUpload);i.fields.push(l)})},e.prototype.getActions=function(){var e=this;return[new i.BlockUIAction("ellipsis-h"),new i.BlockUIAction("trash-o",function(){return e.delete()}),new i.BlockUIAction("copy",function(){return e.clone()}),new i.BlockUIAction("angle-up",function(){return e.move(-1)}),new i.BlockUIAction("angle-down",function(){return e.move(1)})]},e.prototype.delete=function(){this.ui.delete(),this.onDelete(this)},e.prototype.move=function(e){this.onMove(this,e)},e.prototype.clone=function(){this.onCopy(this)},e.prototype.select=function(e){e!==this.selectedField&&(null===e&&(e=this.fields[0]),this.selectedField&&this.selectedField.deselect(),this.selectedField=e,this.ui.toggleSelection(!0),this.onSelect(this))},e.prototype.deselect=function(){this.selectedField=null,this.fields.forEach(function(e){e.deselect()}),this.ui.toggleSelection(!1),this.onDeselect(this)},e.prototype.scrollTo=function(){var e=o.$dom.offset(this.ui.$editor).top-100;e=e>0?e:0},e.prototype.getData=function(e){var t=[];this.fields.forEach(function(e){t.push(e.data)});var o={template:this.template.name,fields:t};return e||(o.html=this.getHtml(!0)),o},e.prototype.getHtml=function(e){var t=o.$dom.el(this.template.$html.innerHTML),i={};this.fields.forEach(function(e){var t=e.name||e.data.name;i[t]=e.getEl()}),o.$dom.select(t,n.Selectors.selectorField,!0).forEach(function(e){var t=o.$dom.data(e,"breField"),n=t.name,r=i[n];o.$dom.replaceWith(e,r)});var r=t.outerHTML;return r?e?r.breTotalTrim():r:null},e}();t.Block=s}),define("BlocksContainer",["require","exports","Block/Block","Common/DOMHelpers"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,o,n,i,r,l,s,a){void 0===a&&(a=!1),this.$element=e,this.onAddBlock=t,this.onDeleteBlock=o,this.onSelectBlock=n,this.onDeselectBlock=i,this.onMoveBlock=r,this.onUpdateBlock=l,this.onUpload=s,this.usePlaceholder=a,this.blocks=[],this.isContainer=!0,this.togglePlaceholderIfNeed()}return e.prototype.getData=function(e){var t=[];return this.blocks.forEach(function(o){t.push(o.getData(e))}),t},e.prototype.getHtml=function(){var e=[];this.blocks.forEach(function(t){e.push(t.getHtml(!0))});var t=n.$dom.clone(this.$element);return t.innerHTML=e.join("\n"),t.outerHTML},e.prototype.addBlock=function(e,t,n,i){var r=this;void 0===i&&(i=!0);var l=new o.Block(e,!1,t,function(e){return r.deleteBlock(e)},function(e){return r.selectBlock(e)},function(e){return r.deselectBlock(e)},function(e){return r.copyBlock(e)},function(e,t){return r.moveBlock(e,t)},this.onUpdateBlock,this.onUpload);this.insertBlock(l,n),i&&(l.select(),l.scrollTo())},e.prototype.insertBlock=function(e,t){t=t||this.blocks.length,this.selectedBlock&&(t=this.blocks.indexOf(this.selectedBlock)+1),this.blocks.splice(t,0,e),0==t?this.$element.appendChild(e.ui.$editor):n.$dom.after(this.blocks[t-1].ui.$editor,e.ui.$editor),this.onAddBlock(e,t),e.select(null),this.togglePlaceholderIfNeed()},e.prototype.deleteBlock=function(e){var t=this.blocks.indexOf(e);this.blocks.splice(t,1),e=null,t<this.blocks.length?this.blocks[t].select():this.blocks.length>0?this.blocks[t-1].select():this.selectedBlock=null,this.onDeleteBlock(e,t),this.togglePlaceholderIfNeed()},e.prototype.moveBlock=function(e,t){var o=this.blocks.indexOf(e),i=o+t;if(!(i>=this.blocks.length||i<0)){var r=this.blocks[i].ui.$editor;t>0?n.$dom.after(r,e.ui.$editor):t<0&&n.$dom.before(r,e.ui.$editor),this.blocks.splice(o,1),this.blocks.splice(i,0,e),this.onMoveBlock(e,o,i),e.scrollTo()}},e.prototype.copyBlock=function(e){var t=this.blocks.indexOf(e)+1;this.addBlock(e.template,e.getData().fields,t,!0)},e.prototype.selectBlock=function(e){this.selectedBlock!==e&&(this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=e,this.onSelectBlock(e))},e.prototype.deselectBlock=function(e){this.selectedBlock=null,this.onDeselectBlock(e)},e.prototype.togglePlaceholderIfNeed=function(){this.usePlaceholder&&(0===this.blocks.length?this.$placeholder||(this.$placeholder=n.$dom.el('<i data-bre-placeholder="true">Click here to select this container...</i>'),this.$element.appendChild(this.$placeholder)):this.$placeholder&&(this.$placeholder.remove(),this.$placeholder=null))},e}();t.BlocksContainer=i}),define("JQueryPlugin",["require","exports","Editor"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.fn.brickyeditor=function(t){var n=new o.Editor(e(this)[0],t);return n.initAsync(),n}}(jQuery)});var BrickyEditor;!function(e){var t=function(){function e(e,t,o){this.icon=e,this.action=t,this.title=o}return e}();e.BlockAction=t}(BrickyEditor||(BrickyEditor={})),define("UI/SelectionHelper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},e.replaceSelectedText=function(e){var t,o;window.getSelection&&(t=window.getSelection(),t.rangeCount&&(o=t.getRangeAt(0),o.deleteContents(),o.insertNode(document.createTextNode(e))))},e}();t.SelectionHelper=o});