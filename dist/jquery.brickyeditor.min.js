var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),BrickyEditor;!function(t){var e=function(){function e(e,o,r){this.fields=[];this.editor=e,this.template=o;var n=t.TemplateService.getTemplate(o);this.$block=$(n.html),this.$editor=this.getBlockTools(this.$block),this.bindBlockFields(r)}return e.prototype.getBlockTools=function(t){var e=this,r=$("<div class='brickyeditor-block-wrapper'>\n                    <div  class='brickyeditor-block-tools'>\n                        <a class='fa fa-trash-o' data-brickyeditor-block-action='"+o.Delete+"'></a>\n                        <a class='fa fa-copy' data-brickyeditor-block-action='"+o.Copy+"'></a>\n                        <a class='fa fa-angle-up' data-brickyeditor-block-action='"+o.Up+"'></a>\n                        <a class='fa fa-angle-down' data-brickyeditor-block-action='"+o.Down+"'></a>\n                    </div>\n                </div>");return $("[data-brickyeditor-block-action]",r).on("click",function(){var t=$(this).attr("data-brickyeditor-block-action");e.action(parseInt(t))}),r.append(t),r},e.prototype.action=function(t){switch(t){case o.Delete:this.editor.deleteBlock(this);break;case o.Up:this.editor.moveBlock(this,-1);break;case o.Down:this.editor.moveBlock(this,1);break;case o.Copy:this.editor.copyBlock(this)}},e.prototype.bindBlockFields=function(e){var o=this;this.$block.find(t.Constants.selectorField).addBack(t.Constants.selectorField).each(function(){var r,n=$(this),i=t.TemplateService.getFieldValue(n,"name");e&&e.forEach(function(t){t.name===i&&(r=t.data)});var a=t.Fields.BaseField.getField(o,n,r);a&&o.fields.push(a)})},e.prototype.getData=function(){var t=[];return this.fields.forEach(function(e){t.push(e.getData())}),{template:this.template,html:this.getHtml(!0),fields:t}},e.prototype.getHtml=function(e){var o=this.$block.clone();o.find(t.Constants.selectorField).addBack(t.Constants.selectorField).each(function(e,o){var r=t.Common.propsFilterKeys(o.attributes,function(e,o){return o.name.breStartsWith(t.Constants.field)}).map(function(t){return o.attributes[t].name});r.push("contenteditable"),r.forEach(function(t){o.removeAttribute(t)})});var r=o[0].outerHTML;return e?r.breTotalTrim():r},e}();t.Block=e;var o;!function(t){t[t.Delete=0]="Delete",t[t.Settings=1]="Settings",t[t.Copy=2]="Copy",t[t.Up=3]="Up",t[t.Down=4]="Down"}(o||(o={}))}(BrickyEditor||(BrickyEditor={})),String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.first=function(t){for(var e=0;e<this.length;e++){var o=this[e];if(t(this[e]))return o}return null};var BrickyEditor;!function(t){var e=function(){function t(){}return t.propsEach=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];e(o,r)}},t.propsFilterKeys=function(e,o,r){var n=[];return t.propsEach(e,function(t,e){o(t,e)&&n.push(t)}),r&&n.push(r),n},t.arrayFilter=function(e,o,r){var n=[];return t.arrayEach(e,function(t){o(t)&&n.push(t)}),r&&n.push(r),n},t.arrayFind=function(e,o){return t.arrayEach(e,function(t){if(o(t))return t}),null},t.arrayFindByField=function(e,o,r){return t.arrayEach(e,function(t){if(t.hasOwnProperty(o)&&t[o]===r)return t}),null},t.arrayMap=function(e,o){var r=[];return t.arrayEach(e,function(t){r.push(o(t))}),r},t.arrayAny=function(t,e){for(var o=!1,r=0;r<t.length;r++){if(e(t[r])){o=!0;break}}return o},t.arrayEach=function(t,e){for(var o=0;o<t.length;o++){e(t[o])}},t}();t.Common=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t}();e.templatesFolder="templates/bootstrap4",e.field="data-bricky-field",e.templateModalKey="modal",e.templateToolsKey="tools",e.templateHtmlToolsKey="htmlTools",e.selectorModalContent=".brickyeditor-modal-content",e.selectorModalClose=".brickyeditor-modal-close",e.selectorTemplates=".templates",e.selectorTemplate=".template",e.selectorCancel=".brickyeditor-cancel",e.selectorSave=".brickyeditor-save",e.selectorLoader="#brickyeditorLoader",e.selectorFilter="#brickyeditorFilter",e.selectorField="["+e.field+"]",e.selectorHtmlToolsCommand="[data-brickyeditor-doc-command]",e.selectorHtmlToolsCommandRange="[data-brickyeditor-doc-command-range]",e.selectorBlockWrapper=".brickyeditor-block-wrapper",e.dummyText="On the other hand, we denounce with righteous indignation and dislike men who are so beguiled and demoralized by the charms of pleasure of the moment, so blinded by desire, that they cannot foresee the pain and trouble that are bound to ensue.",t.Constants=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,o){this.blocks=[];var r=this;this.options=o||new t.EditorOptions,$.extend(this.options,new t.EditorOptions),this.$el=e,this.loadTemplatesAsync().done(function(){r.options.blocks.length&&r.options.blocks.forEach(function(t){r.addBlock(t.template,t.fields)}),r.options.onload&&r.options.onload(r)})}return e.prototype.loadTemplatesAsync=function(){var e=$.Deferred(),o=this,r=[];return r.push(t.TemplateService.loadTemplatesAsync(o.options.templatesFolder).done(function(){}).fail(function(t){console.log("Templates loading error"),e.reject()})),r.push(t.TemplateService.loadTemplateAsync(o.options.templatesBaseFolder,t.Constants.templateModalKey).done(function(e){var r=new t.Modal(e);o.modal=r,o.$el.append(r.$control)}).fail(function(t){console.log("Modal loading error"),e.reject()})),t.TemplateService.loadTemplateAsync(o.options.templatesBaseFolder,t.Constants.templateToolsKey).done(function(t){o.$tools=$(t)}).fail(function(t){console.log("Tools loading error"),e.reject()}),t.TemplateService.loadTemplateAsync(o.options.templatesBaseFolder,t.Constants.templateHtmlToolsKey).done(function(e){var r=new t.HtmlTools(e,o);o.htmlTools=r,o.$el.append(r.$control)}).fail(function(t){console.log("Html Tools loading error"),e.reject()}),$.when.apply($,r).then(function(){o.addTools(),e.resolve()}),e},e.prototype.addTools=function(){var e=this,o=new Array,r=$(t.Constants.selectorTemplates,e.$tools);r.hide(),e.$el.append(e.$tools);for(var n in t.TemplateService.templates){var i=new t.Block(null,n),a=t.TemplateService.templates[n],l=$("<div class='template m-r-1 m-b-1 m-l-1 p-1' data-bricky-template=\""+n+'">'+i.getHtml(!0)+"</div>");r.append(l),t.Common.arrayEach(a.category,function(e){t.Common.arrayAny(o,function(t){return t.breEqualsInvariant(e)})||o.push(e)})}$(t.Constants.selectorTemplate,r).on("click",function(){var t=$(this).data().brickyTemplate;e.addBlock(t)}),$(t.Constants.selectorLoader,e.$tools).fadeOut("slow",function(){r.fadeIn("fast")});var c=$("[data-brickyeditor-hide-tools]",e.$tools);c.on("click",function(){c.attr("data-brickyeditor-hide-tools")?(e.$tools.animate({right:"-204px"},"fast"),c.removeAttr("data-brickyeditor-hide-tools")):(e.$tools.animate({right:"0px"},"fast"),c.attr("data-brickyeditor-hide-tools","true")),c.toggleClass("fa-arrow-left").toggleClass("fa-arrow-right")})},e.prototype.addBlock=function(e,o,r){var n=new t.Block(this,e,o);null!=r?(this.$el.children(t.Constants.selectorBlockWrapper).eq(r).after(n.$editor),this.blocks.splice(r,0,n)):(this.$el.append(n.$editor),this.blocks.push(n))},e.prototype.deleteBlock=function(t){var e=this.blocks.indexOf(t);this.blocks.splice(e,1),t.$editor.remove(),t=null},e.prototype.moveBlock=function(t,e){var o=this.blocks.indexOf(t),r=o+e;if(r<this.blocks.length&&r>=0){var n=this.blocks[r].$editor;e>0?n.after(t.$editor):e<0&&n.before(t.$editor),this.blocks.splice(o,1),this.blocks.splice(r,0,t)}},e.prototype.copyBlock=function(t){var e=this.blocks.indexOf(t);this.addBlock(t.template,t.getData().fields,e)},e.prototype.getData=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getData())}),t},e.prototype.getHtml=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getHtml(!0))}),t.join("\n")},e}();t.Editor=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){this.templatesBaseFolder="templates",this.templatesFolder="templates/bootstrap4"}return t}();t.EditorOptions=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getEmbedAsync=function(t){var e=$.Deferred(),t="https://noembed.com/embed?url="+t;return $.ajax({url:t,type:"get",dataType:"jsonp"}).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e},t}();t.EmbedService=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,o){var r=this;r.$control=$(e),$(t.Constants.selectorHtmlToolsCommand,this.$control).on("click",function(){var e=$(this),n=window.getSelection(),i=n.rangeCount>0?n.getRangeAt(0):null;if(!e.is(t.Constants.selectorHtmlToolsCommandRange)||i){var a=e.data().brickyeditorDocCommand;return"CreateLink"==a?o.modal.promptAsync(r.getLinkPromptParams(n)).done(function(t){n=window.getSelection(),n.addRange(i);var e=t.first(function(t){return"href"===t.key}).value;if(e){document.execCommand(a,!1,e);var o=t.first(function(t){return"target"===t.key}).value;o&&n.anchorNode.parentElement.setAttribute("target",o);var r=t.first(function(t){return"title"===t.key}).value;r&&n.anchorNode.parentElement.setAttribute("title",r)}}).fail(function(){n=window.getSelection(),n.addRange(i)}):document.execCommand(a),!1}})}return e.prototype.getLinkPromptParams=function(e){var o="",r="",n="";if(e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var i=$(e.anchorNode.parentNode);o=i.attr("href"),r=i.attr("title"),n=i.attr("target")}return[new t.Prompt.PromptParameter("href","Url",o,"Url"),new t.Prompt.PromptParameter("title","Title",r,"Title"),new t.Prompt.PromptParameterOptions("target","Target",[["",""],["Blank","_blank"],["Self","_self"],["Parent","_parent"],["Top","_top"]],n)]},e}();t.HtmlTools=e}(BrickyEditor||(BrickyEditor={})),function(t){t.fn.brickyeditor=function(e){return new BrickyEditor.Editor(t(this),e)}}(jQuery);var BrickyEditor;!function(t){var e=function(){function e(e){var o=this;this.$control=$(e),this.$content=$(t.Constants.selectorModalContent,this.$control),$(t.Constants.selectorModalClose,this.$control).on("click",function(){o.hideModal()})}return e.prototype.hideModal=function(){var t=this.$content;this.$control.fadeOut(function(){t.html("")})},e.prototype.showModal=function(t){this.$content.append(t),this.$control.fadeIn()},e.prototype.promptAsync=function(t){var e=$.Deferred(),o=this,r=$("<form></form>");t.forEach(function(t){r.append(t.$control)});var n=$('<button type="button" class="btn btn-ok m-r-1">Ok</button>');n.on("click",function(){t.forEach(function(t){return t.parseValue()}),o.hideModal(),e.resolve(t)});var i=$('<button type="button" class="btn btn-cancel">Cancel</button>');return i.on("click",function(){o.hideModal(),e.reject(t)}),r.append(n),r.append(i),o.showModal(r),e},e}();t.Modal=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,o;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(o=e.getRangeAt(0),o.deleteContents(),o.insertNode(document.createTextNode(t))))},t}();t.SelectionHelper=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(){}return e.loadTemplateAsync=function(t,o){var r=$.Deferred();return $.get(e.getTemplateUrl(t,o)).done(function(t){r.resolve(t)}).fail(function(t){r.reject(t)}),r},e.loadTemplateConfigAsync=function(t){var o=$.Deferred();return $.getJSON(e.getTemplatesConfigUrl(t)).done(function(t){o.resolve(t)}).fail(function(t){o.reject(t)}),o},e.filteredTemplates=function(o){return t.Common.arrayMap(e.templates,function(e){return t.Common.arrayAny(e.category,function(t){t.toLowerCase(),o.toLowerCase()})})},e.loadTemplatesAsync=function(t){var o,r=$.Deferred();return e.loadTemplateConfigAsync(t).done(function(t){o=t}).then(function(){var n=[];o.forEach(function(o){var r=e.loadTemplateAsync(t,o.file).done(function(t){o.html=t,e.templates[o.file]=o}).fail(function(t){console.log(t)});n.push(r)}),$.when.apply($,n).then(function(){r.resolve()})}),r},e.getTemplateUrl=function(t,e){return t+"/"+e+".html"},e.getTemplatesConfigUrl=function(t){return t+"/templates.json"},e.getTemplate=function(t){return e.templates[t]},e.removeTemplate=function(t){delete e.templates[t]},e.getFieldValue=function(t,e){return t.attr("data-bricky-field-"+e)},e}();e.templates={},t.TemplateService=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(){function o(e,o,r){this.block=e,this.$field=o,this.name=t.TemplateService.getFieldValue(o,"name"),this.type=t.TemplateService.getFieldValue(o,"type"),this.data=r||{},this.bind()}return o.getField=function(o,r,n){var i=t.TemplateService.getFieldValue(r,"type");switch(i){case"html":return new e.HtmlField(o,r,n);case"image":return new e.ImageField(o,r,n);case"embed":return new e.EmbedField(o,r,n);default:throw i+" field not found"}},o.prototype.bind=function(){},o.prototype.getData=function(){return{type:this.type,name:this.name,data:this.data}},o}();e.BaseField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this.$field;this.data;o.on("click",function(){var r=prompt("Link to embed","http://instagr.am/p/fA9uwTtkSN/");t.EmbedService.getEmbedAsync(r).done(function(t){e.data.url=r,e.data.embed=t;var n=$(t.html),i=n.filter("script");if(i.length>0){i.remove();var a=i.attr("src");a.breStartsWith("//")&&(a="http:"+a,$.getScript(a).done(function(t){a.breContains("instgram")&&instgrm&&instgrm.Embeds.process()}).fail(function(t){}))}o.replaceWith(n)})})},o}(e.BaseField);e.EmbedField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this.$field,o=this.data;e.is("[contenteditable]")||e.attr("contenteditable","true"),this.data.html=this.data.html||t.TemplateService.getFieldValue(e,"html")||t.Constants.dummyText,e.html(this.data.html),this.$field.on("blur keyup paste input",function(){o.html=$(this).html().trim()})},o}(e.BaseField);e.HtmlField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.bind=function(){var e=this,o=this.$field;this.data;this.data.src||(this.data.src=t.TemplateService.getFieldValue(o,"src")),o.attr("src",this.data.src),o.on("click",function(){e.block.editor.modal.promptAsync(e.getPromptParams()).done(function(t){var o=t.first(function(t){return"file"===t.key}).value,r=t.first(function(t){return"src"===t.key}).value;o?(e.setFile(o),e.setSrc(null)):r&&(e.setSrc(r),e.setFile(null));var n=t.first(function(t){return"alt"===t.key}).value;e.setAlt(n)})})},o.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("src","Image Link",this.data.url,"image url"),new t.Prompt.PromptParameterImage("file","or Upload file",this.data.file,"select file"),new t.Prompt.PromptParameter("alt","Alt",this.data.alt,"alt attribute value ")]},o.prototype.setSrc=function(t){this.data.src=t,t&&this.$field.attr("src",this.data.src)},o.prototype.setAlt=function(t){this.data.alt=t,this.$field.attr("alt",this.data.alt)},o.prototype.setFile=function(t){this.data.file=t,t&&this.$field.attr("src",this.data.file.fileContent)},o}(e.BaseField);e.ImageField=o}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o,r){this.key=t,this.title=e,this.placeholder=r||"",this.value=o}return t.prototype.parseValue=function(){this.value=this.$input.val(),this.$control=null,delete this._$control},Object.defineProperty(t.prototype,"$control",{get:function(){return this._$control||(this._$control=$('<div class="brickyeditor-prompt-field">\n                        <label for="'+this.key+'">'+(this.title?this.title:"")+"</label>\n                        </div>"),this.$input=this.getEditor(),this._$control.append(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),t.prototype.getEditor=function(){this.value;return $('<input type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'" value="'+(this.value?this.value:"")+'">')},t}();t.PromptParameter=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function o(t,o,r,n){var i=e.call(this,t,o,r,n)||this;return r&&(i._value=r),i}return __extends(o,e),o.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},o.prototype.getEditor=function(){var e=this,o=this.value&&this.value.fileContent?this.value.fileContent:"",r=$("\n                <div class='brickyeditor-image-input'>\n                    <label for=\""+this.key+'">\n                        <img src="'+o+'"/>\n                    </label>                        \n                    <input type="file" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='brickyeditor-image-input-filename'></small>"),n=$("input",r),i=$("img",r),a=$(".brickyeditor-image-input-filename",r),l=this.value;return l&&(i.attr("src",l.fileContent),a.text(l.fileInfo.name)),n.change(function(){var o=this;if(o.files&&o.files[0]){var r=new FileReader;r.onload=function(r){var n=r.target;e._value=new t.PromptParameterImageResult,e._value.fileContent=n.result,e._value.fileInfo=new t.PromptParameterImageResultFile(o.files[0]),i.attr("src",e._value.fileContent),a.text(e._value.fileInfo.name)},r.readAsDataURL(o.files[0])}}),r},o}(t.PromptParameter);t.PromptParameterImage=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t}();t.PromptParameterImageResult=e;var o=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}();t.PromptParameterImageResultFile=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,o){void 0===o&&(o=!1),this.title=t,this.value=e,this.selected=o}return t}();t.PromptParameterOption=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var o=function(o){function r(t,r,n,i,a){var l=o.call(this,t,r,i,a)||this;return l.options=[],n.forEach(function(t){l.options.push(new e.PromptParameterOption(t[0],t[1],t[1]==i))}),l}return __extends(r,o),r.prototype.getEditor=function(){var e=t.Common.arrayMap(this.options,function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return $('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+e+"</select>")},r}(e.PromptParameter);e.PromptParameterOptions=o}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));