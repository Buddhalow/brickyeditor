var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),BrickyEditor;!function(t){var e=function(){function e(e,r,o){this.fields=[];this.editor=e,this.template=r;var n=t.TemplateService.getTemplate(r),i=$(n.html);this.$editor=i,this.bindEditorFields(o)}return e.prototype.showControls=function(t){},e.prototype.bindEditorFields=function(e){var r=this;this.$editor.find(t.Constants.selectorField).addBack(t.Constants.selectorField).each(function(){var o,n=$(this),i=t.TemplateService.getFieldValue(n,"name");e&&e.forEach(function(t){t.name===i&&(o=t.data)});var a=t.Fields.BaseField.getField(r,n,o);a&&r.fields.push(a)})},e.prototype.getData=function(){var t=[];return this.fields.forEach(function(e){t.push(e.getData())}),{template:this.template,html:this.getHtml(!0),fields:t}},e.prototype.getHtml=function(e){var r=this.$editor.clone();r.find(t.Constants.selectorField).addBack(t.Constants.selectorField).each(function(e,r){var o=t.Common.propsFilterKeys(r.attributes,function(e,r){return r.name.breStartsWith(t.Constants.field)}).map(function(t){return r.attributes[t].name});o.push("contenteditable"),o.forEach(function(t){r.removeAttribute(t)})});var o=r[0].outerHTML;return e?o.breTotalTrim():o},e}();t.Block=e}(BrickyEditor||(BrickyEditor={})),String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.first=function(t){for(var e=0;e<this.length;e++){var r=this[e];if(t(this[e]))return r}return null};var BrickyEditor;!function(t){var e=function(){function t(){}return t.propsEach=function(t,e){for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];e(r,o)}},t.propsFilterKeys=function(e,r,o){var n=[];return t.propsEach(e,function(t,e){r(t,e)&&n.push(t)}),o&&n.push(o),n},t.arrayFilter=function(e,r,o){var n=[];return t.arrayEach(e,function(t){r(t)&&n.push(t)}),o&&n.push(o),n},t.arrayFind=function(e,r){return t.arrayEach(e,function(t){if(r(t))return t}),null},t.arrayFindByField=function(e,r,o){return t.arrayEach(e,function(t){if(t.hasOwnProperty(r)&&t[r]===o)return t}),null},t.arrayMap=function(e,r){var o=[];return t.arrayEach(e,function(t){o.push(r(t))}),o},t.arrayAny=function(t,e){for(var r=!1,o=0;o<t.length;o++){if(e(t[o])){r=!0;break}}return r},t.arrayEach=function(t,e){for(var r=0;r<t.length;r++){e(t[r])}},t}();t.Common=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t}();e.templatesFolder="templates/bootstrap4",e.field="data-bricky-field",e.templateModalKey="modal",e.templateToolsKey="tools",e.templateHtmlToolsKey="htmlTools",e.selectorModalContent=".brickyeditor-modal-content",e.selectorModalClose=".brickyeditor-modal-close",e.selectorTemplates=".templates",e.selectorTemplate=".template",e.selectorCancel=".brickyeditor-cancel",e.selectorSave=".brickyeditor-save",e.selectorLoader="#brickyeditorLoader",e.selectorFilter="#brickyeditorFilter",e.selectorField="["+e.field+"]",e.selectorHtmlToolsCommand="[data-brickyeditor-doc-command]",e.selectorHtmlToolsCommandRange="[data-brickyeditor-doc-command-range]",e.dummyText="On the other hand, we denounce with righteous indignation and dislike men who are so beguiled and demoralized by the charms of pleasure of the moment, so blinded by desire, that they cannot foresee the pain and trouble that are bound to ensue.",t.Constants=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,r){this.blocks=[];var o=this;this.options=r||new t.EditorOptions,$.extend(this.options,new t.EditorOptions),this.$el=e,this.loadTemplatesAsync().done(function(){o.options.blocks.length&&o.options.blocks.forEach(function(t){o.addBlock(t.template,t.fields)}),o.options.onload&&o.options.onload(o)})}return e.prototype.loadTemplatesAsync=function(){var e=$.Deferred(),r=this,o=[];return o.push(t.TemplateService.loadTemplatesAsync(r.options.templatesFolder).done(function(){}).fail(function(t){console.log("Templates loading error"),e.reject()})),o.push(t.TemplateService.loadTemplateAsync(r.options.templatesBaseFolder,t.Constants.templateModalKey).done(function(e){var o=new t.Modal(e);r.modal=o,r.$el.append(o.$control)}).fail(function(t){console.log("Modal loading error"),e.reject()})),t.TemplateService.loadTemplateAsync(r.options.templatesBaseFolder,t.Constants.templateToolsKey).done(function(t){r.$tools=$(t)}).fail(function(t){console.log("Tools loading error"),e.reject()}),t.TemplateService.loadTemplateAsync(r.options.templatesBaseFolder,t.Constants.templateHtmlToolsKey).done(function(e){var o=new t.HtmlTools(e,r);r.htmlTools=o,r.$el.append(o.$control)}).fail(function(t){console.log("Html Tools loading error"),e.reject()}),$.when.apply($,o).then(function(){r.addTools(),e.resolve()}),e},e.prototype.addTools=function(){var e=this,r=new Array,o=$(t.Constants.selectorTemplates,e.$tools);o.hide(),e.$el.append(e.$tools);for(var n in t.TemplateService.templates){var i=new t.Block(null,n),a=t.TemplateService.templates[n],l=$("<div class='template m-r-1 m-b-1 m-l-1 p-1' data-bricky-template=\""+n+'">'+i.getHtml(!0)+"</div>");o.append(l),t.Common.arrayEach(a.category,function(e){t.Common.arrayAny(r,function(t){return t.breEqualsInvariant(e)})||r.push(e)})}$(t.Constants.selectorTemplate,o).on("click",function(){var t=$(this).data().brickyTemplate;e.addBlock(t)}),$(t.Constants.selectorLoader,e.$tools).fadeOut("slow",function(){o.fadeIn("fast")});var c=$("[data-brickyeditor-hide-tools]",e.$tools);c.on("click",function(){c.attr("data-brickyeditor-hide-tools")?(e.$tools.animate({right:"-204px"},"fast"),c.removeAttr("data-brickyeditor-hide-tools")):(e.$tools.animate({right:"0px"},"fast"),c.attr("data-brickyeditor-hide-tools","true")),c.toggleClass("fa-arrow-left").toggleClass("fa-arrow-right")})},e.prototype.addBlock=function(e,r){var o=new t.Block(this,e,r);this.$el.append("<div class='brickyeditor-block-tools'>\n                <div class='brickyeditor-icon brickyeditor-icon-x'></div>\n                <div class='brickyeditor-icon brickyeditor-icon-cog'></div>\n                <div class='brickyeditor-icon brickyeditor-icon-up'></div>\n                <div class='brickyeditor-icon brickyeditor-icon-down'></div>\n            </div>"),this.$el.append(o.$editor),this.blocks.push(o)},e.prototype.getData=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getData())}),t},e.prototype.getHtml=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getHtml(!0))}),t.join("\n")},e}();t.Editor=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){this.templatesBaseFolder="templates",this.templatesFolder="templates/bootstrap4"}return t}();t.EditorOptions=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getEmbedAsync=function(t){var e=$.Deferred(),t="https://noembed.com/embed?url="+t;return $.ajax({url:t,type:"get",dataType:"jsonp"}).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e},t}();t.EmbedService=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,r){var o=this;o.$control=$(e),$(t.Constants.selectorHtmlToolsCommand,this.$control).on("click",function(){var e=$(this),n=window.getSelection(),i=n.rangeCount>0?n.getRangeAt(0):null;if(!e.is(t.Constants.selectorHtmlToolsCommandRange)||i){var a=e.data().brickyeditorDocCommand;return"CreateLink"==a?r.modal.promptAsync(o.getLinkPromptParams(n)).done(function(t){n=window.getSelection(),n.addRange(i);var e=t.first(function(t){return"href"===t.key}).value;if(e){document.execCommand(a,!1,e);var r=t.first(function(t){return"target"===t.key}).value;r&&n.anchorNode.parentElement.setAttribute("target",r);var o=t.first(function(t){return"title"===t.key}).value;o&&n.anchorNode.parentElement.setAttribute("title",o)}}).fail(function(){n=window.getSelection(),n.addRange(i)}):document.execCommand(a),!1}})}return e.prototype.getLinkPromptParams=function(e){var r="",o="",n="";if(e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var i=$(e.anchorNode.parentNode);r=i.attr("href"),o=i.attr("title"),n=i.attr("target")}return[new t.Prompt.PromptParameter("href","Url",r,"Url"),new t.Prompt.PromptParameter("title","Title",o,"Title"),new t.Prompt.PromptParameterOptions("target","Target",[["",""],["Blank","_blank"],["Self","_self"],["Parent","_parent"],["Top","_top"]],n)]},e}();t.HtmlTools=e}(BrickyEditor||(BrickyEditor={})),function(t){t.fn.brickyeditor=function(e){return new BrickyEditor.Editor(t(this),e)}}(jQuery);var BrickyEditor;!function(t){var e=function(){function e(e){var r=this;this.$control=$(e),this.$content=$(t.Constants.selectorModalContent,this.$control),$(t.Constants.selectorModalClose,this.$control).on("click",function(){r.hideModal()})}return e.prototype.hideModal=function(){var t=this.$content;this.$control.fadeOut(function(){t.html("")})},e.prototype.showModal=function(t){this.$content.append(t),this.$control.fadeIn()},e.prototype.promptAsync=function(t){var e=$.Deferred(),r=this,o=$("<form></form>");t.forEach(function(t){o.append(t.$control)});var n=$('<button type="button" class="btn btn-ok m-r-1">Ok</button>');n.on("click",function(){t.forEach(function(t){return t.parseValue()}),r.hideModal(),e.resolve(t)});var i=$('<button type="button" class="btn btn-cancel">Cancel</button>');return i.on("click",function(){r.hideModal(),e.reject(t)}),o.append(n),o.append(i),r.showModal(o),e},e}();t.Modal=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,r;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(r=e.getRangeAt(0),r.deleteContents(),r.insertNode(document.createTextNode(t))))},t}();t.SelectionHelper=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(){}return e.loadTemplateAsync=function(t,r){var o=$.Deferred();return $.get(e.getTemplateUrl(t,r)).done(function(t){o.resolve(t)}).fail(function(t){o.reject(t)}),o},e.loadTemplateConfigAsync=function(t){var r=$.Deferred();return $.getJSON(e.getTemplatesConfigUrl(t)).done(function(t){r.resolve(t)}).fail(function(t){r.reject(t)}),r},e.filteredTemplates=function(r){return t.Common.arrayMap(e.templates,function(e){return t.Common.arrayAny(e.category,function(t){t.toLowerCase(),r.toLowerCase()})})},e.loadTemplatesAsync=function(t){var r,o=$.Deferred();return e.loadTemplateConfigAsync(t).done(function(t){r=t}).then(function(){var n=[];r.forEach(function(r){var o=e.loadTemplateAsync(t,r.file).done(function(t){r.html=t,e.templates[r.file]=r}).fail(function(t){console.log(t)});n.push(o)}),$.when.apply($,n).then(function(){o.resolve()})}),o},e.getTemplateUrl=function(t,e){return t+"/"+e+".html"},e.getTemplatesConfigUrl=function(t){return t+"/templates.json"},e.getTemplate=function(t){return e.templates[t]},e.removeTemplate=function(t){delete e.templates[t]},e.getFieldValue=function(t,e){return t.attr("data-bricky-field-"+e)},e}();e.templates={},t.TemplateService=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var r=function(){function r(e,r,o){this.block=e,this.$field=r,this.name=t.TemplateService.getFieldValue(r,"name"),this.type=t.TemplateService.getFieldValue(r,"type"),this.data=o||{},this.bind()}return r.getField=function(r,o,n){var i=t.TemplateService.getFieldValue(o,"type");switch(i){case"html":return new e.HtmlField(r,o,n);case"image":return new e.ImageField(r,o,n);case"embed":return new e.EmbedField(r,o,n);default:throw i+" field not found"}},r.prototype.bind=function(){},r.prototype.getData=function(){return{type:this.type,name:this.name,data:this.data}},r}();e.BaseField=r}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.bind=function(){var e=this,r=this.$field;this.data;r.on("click",function(){var o=prompt("Link to embed","http://instagr.am/p/fA9uwTtkSN/");t.EmbedService.getEmbedAsync(o).done(function(t){e.data.url=o,e.data.embed=t;var n=$(t.html),i=n.filter("script");if(i.length>0){i.remove();var a=i.attr("src");a.breStartsWith("//")&&(a="http:"+a,$.getScript(a).done(function(t){a.breContains("instgram")&&instgrm&&instgrm.Embeds.process()}).fail(function(t){}))}r.replaceWith(n)})})},r}(e.BaseField);e.EmbedField=r}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.bind=function(){var e=this.$field,r=this.data;e.is("[contenteditable]")||e.attr("contenteditable","true"),this.data.html=this.data.html||t.TemplateService.getFieldValue(e,"html")||t.Constants.dummyText,e.html(this.data.html),this.$field.on("blur keyup paste input",function(){r.html=$(this).html().trim()})},r}(e.BaseField);e.HtmlField=r}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.bind=function(){var e=this,r=this.$field;this.data;this.data.src||(this.data.src=t.TemplateService.getFieldValue(r,"src")),r.attr("src",this.data.src),r.on("click",function(){e.block.editor.modal.promptAsync(e.getPromptParams()).done(function(t){var r=t.first(function(t){return"file"===t.key}).value,o=t.first(function(t){return"src"===t.key}).value;r?(e.setFile(r),e.setSrc(null)):o&&(e.setSrc(o),e.setFile(null));var n=t.first(function(t){return"alt"===t.key}).value;e.setAlt(n)})})},r.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("src","Image Link",this.data.url,"image url"),new t.Prompt.PromptParameterImage("file","or Upload file",this.data.file,"select file"),new t.Prompt.PromptParameter("alt","Alt",this.data.alt,"alt attribute value ")]},r.prototype.setSrc=function(t){this.data.src=t,t&&this.$field.attr("src",this.data.src)},r.prototype.setAlt=function(t){this.data.alt=t,this.$field.attr("alt",this.data.alt)},r.prototype.setFile=function(t){this.data.file=t,t&&this.$field.attr("src",this.data.file.fileContent)},r}(e.BaseField);e.ImageField=r}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,r,o){this.key=t,this.title=e,this.placeholder=o||"",this.value=r}return t.prototype.parseValue=function(){this.value=this.$input.val(),this.$control=null,delete this._$control},Object.defineProperty(t.prototype,"$control",{get:function(){return this._$control||(this._$control=$('<div class="brickyeditor-prompt-field">\n                        <label for="'+this.key+'">'+(this.title?this.title:"")+"</label>\n                        </div>"),this.$input=this.getEditor(),this._$control.append(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),t.prototype.getEditor=function(){this.value;return $('<input type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'" value="'+(this.value?this.value:"")+'">')},t}();t.PromptParameter=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function r(t,r,o,n){var i=e.call(this,t,r,o,n)||this;return o&&(i._value=o),i}return __extends(r,e),r.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},r.prototype.getEditor=function(){var e=this,r=this.value&&this.value.fileContent?this.value.fileContent:"",o=$("\n                <div class='brickyeditor-image-input'>\n                    <label for=\""+this.key+'">\n                        <img src="'+r+'"/>\n                    </label>                        \n                    <input type="file" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='brickyeditor-image-input-filename'></small>"),n=$("input",o),i=$("img",o),a=$(".brickyeditor-image-input-filename",o),l=this.value;return l&&(i.attr("src",l.fileContent),a.text(l.fileInfo.name)),n.change(function(){var r=this;if(r.files&&r.files[0]){var o=new FileReader;o.onload=function(o){var n=o.target;e._value=new t.PromptParameterImageResult,e._value.fileContent=n.result,e._value.fileInfo=new t.PromptParameterImageResultFile(r.files[0]),i.attr("src",e._value.fileContent),a.text(e._value.fileInfo.name)},o.readAsDataURL(r.files[0])}}),o},r}(t.PromptParameter);t.PromptParameterImage=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t}();t.PromptParameterImageResult=e;var r=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}();t.PromptParameterImageResultFile=r}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,r){void 0===r&&(r=!1),this.title=t,this.value=e,this.selected=r}return t}();t.PromptParameterOption=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var r=function(r){function o(t,o,n,i,a){var l=r.call(this,t,o,i,a)||this;return l.options=[],n.forEach(function(t){l.options.push(new e.PromptParameterOption(t[0],t[1],t[1]==i))}),l}return __extends(o,r),o.prototype.getEditor=function(){var e=t.Common.arrayMap(this.options,function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return $('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+e+"</select>")},o}(e.PromptParameter);e.PromptParameterOptions=r}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));