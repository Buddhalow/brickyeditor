var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function l(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,l)}c((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return o([t,e])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(t){n=[6,t],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,s,l,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l};System.register("Common/DOMHelpers",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t.el=function(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstElementChild;return e.innerHTML=null,n},t.ons=function(t,e,n){var o=this;e.split(" ").forEach(function(e){o.on(t,e,n)})},t.on=function(t,e,n){return t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n,!1)},t.offset=function(t){var e=t.getBoundingClientRect(),n=document.body;return{top:e.top+n.scrollTop,left:e.left+n.scrollLeft}},t.wrap=function(t,e){t.parentElement.insertBefore(e,t),e.appendChild(t)},t.unwrap=function(t){if(t.parentElement){var e=t.parentElement.parentElement;e?e.replaceChild(t,t.parentElement):t.parentElement.innerHTML=t.innerHTML}},t.hide=function(t){t.style.display="none"},t.show=function(t){t.style.display="block"},t.isHidden=function(t){return"none"===window.getComputedStyle(t).display},t.toggle=function(t,e){(e?e.valueOf():this.isHidden(t))?this.show(t):this.hide(t)},t.before=function(t,e){var n=this;e instanceof HTMLElement?t.parentNode.insertBefore(e,t):e.forEach(function(e){return n.before(t,e)})},t.after=function(t,e){t.nextSibling?t.parentNode.insertBefore(e,t):t.parentNode.appendChild(e)},t.hasClass=function(t,e){t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},t.addClass=function(t,e){this.hasClass(t,e)||(t.classList?t.classList.add(e):t.className+=" "+e)},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},t.toggleClass=function(t,e,n){if(n)return void(n.valueOf()?this.addClass(t,e):this.removeClass(t,e));if(t.classList)t.classList.toggle(e);else{for(var o=t.className.split(" "),i=-1,r=o.length;r--;)o[r]===e&&(i=r);i>=0?o.splice(i,1):o.push(e),t.className=o.join(" ")}},t.windowScrollTop=function(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop},t.replaceWith=function(t,e){var n=t.parentElement;n&&n.replaceChild(e,t)},t.select=function(e,n,o){void 0===o&&(o=!1);var i=e.querySelectorAll(n),r=Array.prototype.slice.call(i);return o&&o.valueOf()&&t.matches(e,n)&&r.push(e),r},t.find=function(t){return document.querySelector(t)},t.first=function(t,e){return t.querySelector(e)},t.clone=function(t){return t.cloneNode(!0)},t.trigger=function(t,e,n){if(window.CustomEvent)var o=new CustomEvent(e,{detail:n});else{var o=document.createEvent("CustomEvent");o.initCustomEvent(e,!0,!0,n)}t.dispatchEvent(o)},t.matches=function(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)},t.data=function(t,e){var n=t.dataset[e],o=null;try{o=JSON.parse(n)}catch(t){if(t instanceof SyntaxError){n=n.replace(/'/g,'"');try{o=JSON.parse(n)}catch(t){}}}return o},t}(),t("$dom",n)}}}),System.register("UI/Selectors",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t.attr=function(t){return"["+t+"]"},t.attrContentEditable="contenteditable",t.selectorContentEditable="contenteditable",t.attrField="data-bre-field",t.selectorField="["+t.attrField+"]",t.classEditor="bre-editor",t.classTemplate="bre-template",t.selectorTemplate="."+t.classTemplate,t.classTemplateGroup="bre-template-group",t.selectorTemplateGroup="."+t.classTemplateGroup,t.selectorTemplatePreview=".bre-template-preview",t.classMobile="brickyeditor-tools-mobile",t.htmlToolsCommand="data-bre-doc-command",t.htmlToolsCommandRange="data-bre-doc-command-range",t.selectorFieldSelected="bre-field-selected",t.selectorFieldContainer="bre-field-container",t.selectorHtmlToolsCommand=t.attr(t.htmlToolsCommand),t.selectorHtmlToolsCommandRange=t.attr(t.htmlToolsCommandRange),t}(),t("Selectors",n)}}}),System.register("Templates/Template",["Common/DOMHelpers","UI/Selectors","Block/Block"],function(t,e){"use strict";var n,o,i,r;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t}],execute:function(){r=function(){function t(t){if(this.loaded=!0,this.name=t.dataset.name,this.$preview=n.$dom.first(t,o.Selectors.selectorTemplatePreview),this.$preview&&t.removeChild(this.$preview),this.$html=t,!this.$preview){var e=new i.Block(this,!0),r=e.getHtml(!0);null===r?this.loaded=!1:this.$preview=n.$dom.el(r)}}return t.prototype.getPreview=function(){var t=n.$dom.el("<div class='"+o.Selectors.classTemplate+"'></div>");return t.appendChild(this.$preview),t},t}(),t("Template",r)}}}),System.register("Block/BlockUIAction",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(t,e,n){this.icon=t,this.action=e,this.title=n}return t}(),t("BlockUIAction",n)}}}),System.register("Common/Common",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),o=n.length>>>0,i=arguments[1],r=0;r<o;r++)if(e=n[r],t.call(i,e,r,n))return e}),n=function(){function t(){}return t.extend=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=t||{};for(var o=1;o<e.length;o++)if(e[o])for(var i in e[o])e[o].hasOwnProperty(i)&&(t[i]=e[o][i]);return t},t.getSelectedText=function(){var t="",e=document;return window.getSelection?t=window.getSelection().toString():e.selection&&"Control"!=e.selection.type&&(t=e.selection.createRange().text),t},t.propsEach=function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];e(n,o)}},t.propsFilterKeys=function(e,n,o){var i=[];return t.propsEach(e,function(t,e){n(t,e)&&i.push(t)}),o&&i.push(o),i},t}(),t("Common",n)}}}),System.register("Fields/BaseField",["Common/DOMHelpers","Fields/Fields","Common/Common","UI/Selectors"],function(t,e){"use strict";var n,o,i,r,s;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t}],execute:function(){s=function(){function t(t,e,n,o,i){this.$field=t,this.data=e,this.onSelect=n,this.onUpdate=o,this.onUpload=i,this.bind()}return Object.defineProperty(t,"type",{get:function(){var t=this.name;return t=t.replace("Field",""),t=t.substring(0,1).toLowerCase()+t.substring(1)},enumerable:!0,configurable:!0}),t.prototype.getSettingsEl=function(){return null},t.registerCommonFields=function(){this.commonFieldsRegistered||(o.HtmlField.registerField(),o.ImageField.registerField(),o.EmbedField.registerField(),o.ContainerField.registerField()),this.commonFieldsRegistered=!0},t.registerField=function(){this._fields.hasOwnProperty(this.type)&&delete this._fields[this.type],this._fields[this.type]=this},t.createField=function(e,o,r,s,l){var c=n.$dom.data(e,"breField");if(!c||!c.name)throw"There is no data or data doesn't contains 'name' in field "+e.innerHTML;if(o){for(var a={},u=0;u<o.length;u++){var d=o[u];if(d.name.toLowerCase()===c.name.toLowerCase()){a=d;break}}a&&(c=i.Common.extend(c,a))}var p=c.type;if(null!=p){if(t.commonFieldsRegistered||t.registerCommonFields(),this._fields.hasOwnProperty(p)){var d=this._fields[p];return new d(e,c,r,s,l)}throw p+" field not found"}throw"Field type not defined in data-bre-field attribute"},t.prototype.bind=function(){},t.prototype.select=function(){this.$field.classList.add(r.Selectors.selectorFieldSelected),this.onSelect(this)},t.prototype.deselect=function(){this.$field.classList.remove(r.Selectors.selectorFieldSelected)},t.prototype.getEl=function(){var t=this.$field.cloneNode(!0);return t.attributes.removeNamedItem(r.Selectors.attrField),t},t.prototype.updateProperty=function(t,e,n){void 0===n&&(n=!0);var o=this.data[t];o!==e&&(this.data[t]=e,n&&this.onUpdate(t,o,e))},t._fields={},t.commonFieldsRegistered=!1,t}(),t("BaseField",s)}}}),System.register("Fields/ContainerField",["Common/DOMHelpers","UI/Selectors","BlocksContainer","Fields/BaseField"],function(t,e){"use strict";var n,o,i,r,s;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t}],execute:function(){s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.bind=function(){var t=this,e=this,r=this.$field;this.container=new i.BlocksContainer(r,function(t){e.updateBlocks()},function(t){e.updateBlocks()},function(e){t.select()},function(t){},function(t){e.updateBlocks()},function(t){e.updateBlocks()},e.onUpload,!0),n.$dom.addClass(r,o.Selectors.selectorFieldContainer),n.$dom.on(r,"click",function(t){return e.select(),t.stopPropagation(),!1})},e.prototype.updateBlocks=function(){this.updateProperty("blocks",this.container.getData(!0),!0),this.updateProperty("html",this.container.getHtml(),!0)},e.prototype.deselect=function(){this.container.blocks.forEach(function(t){return t.deselect()}),this.$field.classList.remove(o.Selectors.selectorFieldSelected)},e.prototype.getEl=function(){var t=this.container.getHtml();return n.$dom.el(t)},e}(r.BaseField),t("ContainerField",s)}}}),System.register("Common/AJAXHelper",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t.get=function(t){return new Promise(function(e,n){var o=new XMLHttpRequest;o.open("GET",t,!0),o.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var t=null;try{t=JSON.parse(this.responseText)}catch(e){t=this.responseText}try{e(t)}catch(t){n(t)}}else n()},o.send(),o=null})},t.getScript=function(t){return new Promise(function(e,n){var o=document.createElement("script"),i=!1,r=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState?n():(i=!0,e())};o.onload=r,o.onreadystatechange=r,o.src=t,document.getElementsByTagName("head")[0].appendChild(o)})},t.jsonp=function(t){return new Promise(function(e,n){var o="_"+Math.round(1e4*Math.random()),i="jsonp_callback_"+o;window[i]=function(t){delete window[i];var n=document.getElementById(o);n.parentNode.removeChild(n),e(t)};var r=t+"&callback="+i,s=document.createElement("script");s.src=r,s.id=o,s.addEventListener("error",n),(document.getElementsByTagName("head")[0]||document.body||document.documentElement).appendChild(s)})},t}(),t("$ajax",n)}}}),System.register("EditorStrings",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t.errorBlocksFileNotFound=function(t){return"Blocks file not found. Requested file: "+t+"."},t.errorTemplatesFileNotFound=function(t){return"Templates file not found. Requested file: "+t+"."},t.errorBlockTemplateNotFound=function(t){return'Template "'+t+'" not found.'},t.errorTemplateParsing=function(t){return"Template parsing error: "+t+"."},t.embedFieldLinkTitle="Link to embed media",t.embedFieldLinkPlaceholder="Link to instagram, youtube and etc.",t.imageFieldLinkTitle="Image link",t.imageFieldLinkPlaceholder="http://url-to-image.png",t.imageFieldUploadTitle="or Upload a file",t.imageFieldUploadButton="Select file",t.imageFieldAltTitle="Alt",t.imageFieldAltPlaceholder="Image 'alt' attribute value",t.imageFieldUrlSubtitle="Link to open on image click",t.htmlEditorLinkUrlTitle="Url",t.htmlEditorLinkUrlPlaceholder="http://put-your-link.here",t.htmlEditorLinkTitleTitle="Title",t.htmlEditorLinkTitlePlaceholder="Title attribute for link",t.htmlEditorLinkTargetTitle="Target",t.htmlEditorLinkTargetBlank="Blank",t.htmlEditorLinkTargetSelf="Self",t.htmlEditorLinkTargetParent="Parent",t.htmlEditorLinkTargetTop="Top",t.buttonClose="close",t.buttonOk="Ok",t.buttonCancel="Cancel",t.defaultTemplatesGroupName="Other templates",t}(),t("EditorStrings",n)}}}),System.register("Services/EmbedService",["Common/AJAXHelper"],function(t,e){"use strict";var n,o;e&&e.id;return{setters:[function(t){n=t}],execute:function(){o=function(){function t(){}return t.getEmbedAsync=function(t){var e=this,o="https://noembed.com/embed?url="+t;return new Promise(function(t,i){return __awaiter(e,void 0,void 0,function(){var e,r;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,n.$ajax.jsonp(o)];case 1:return e=s.sent(),t(e),[3,3];case 2:return r=s.sent(),i(r),[3,3];case 3:return[2]}})})})},t.processEmbed=function(e){switch(e){case t.Instagram:instgrm&&instgrm.Embeds.process()}},t.Instagram="Instagram",t}(),t("EmbedService",o)}}}),System.register("Templates/TemplateGroup",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(t,e){this.name=t,this.templates=e}return t}(),t("TemplateGroup",n)}}}),System.register("Services/TemplateService",["EditorStrings","Templates/Template","Common/DOMHelpers","Common/AJAXHelper","UI/Selectors","Templates/TemplateGroup"],function(t,e){"use strict";var n,o,i,r,s,l,c;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t},function(t){l=t}],execute:function(){c=function(){function t(){}return t.loadTemplatesAsync=function(t,e,o){return __awaiter(this,void 0,void 0,function(){var c,a=this;return __generator(this,function(u){return this.templates=[],c=this.templates,[2,new Promise(function(c,u){return __awaiter(a,void 0,void 0,function(){var a,d,p,m,h,f,g,v,b=this;return __generator(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),[4,r.$ajax.get(t)];case 1:return a=y.sent(),d=i.$dom.el("<div>"+a+"</div>"),p=i.$dom.select(d,"style",!1),p.length>0&&i.$dom.before(e,p),m=i.$dom.select(d,s.Selectors.selectorTemplateGroup),m.forEach(function(t){var e=t.getAttribute("title"),n=b.getTemplates(t,o);b.templates.push(new l.TemplateGroup(e,n)),t.remove()}),h=this.getTemplates(d,o),f=this.templates.length>0?n.EditorStrings.defaultTemplatesGroupName:"",g=new l.TemplateGroup(f,h),this.templates.push(g),c(this.templates),[3,3];case 2:return v=y.sent(),o(n.EditorStrings.errorTemplatesFileNotFound(t)),u(v),[3,3];case 3:return[2]}})})})]})})},t.getTemplates=function(t,e){var r=[];return i.$dom.select(t,s.Selectors.selectorTemplate).forEach(function(t){var i=new o.Template(t);i.loaded?r.push(i):e(n.EditorStrings.errorTemplateParsing(i.name))}),r},t.getTemplate=function(t){for(var e=0;e<this.templates.length;e++)for(var n=this.templates[e],o=0;o<n.templates.length;o++){var i=n.templates[o];if(i.name.breEqualsInvariant(t))return i}return null},t}(),t("TemplateService",c)}}}),System.register("Services/Services",["Services/EmbedService","Services/TemplateService"],function(t,e){"use strict";function n(e){var n={};for(var o in e)"default"!==o&&(n[o]=e[o]);t(n)}e&&e.id;return{setters:[function(t){n(t)},function(t){n(t)}],execute:function(){}}}),System.register("Events",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t.onLoad="onLoad",t.onChange="onChange",t.onBlockAdd="onBlockAdd",t.onBlockDelete="onBlockDelete",t.onBlockMove="onBlockMove",t.onBlockSelect="onBlockSelect",t.onBlockDeselect="onBlockDeselect",t.onBlockUpdate="onBlockUpdate",t}(),t("Events",n)}}}),System.register("Prompt/PromptParameter",["Common/DOMHelpers"],function(t,e){"use strict";var n,o;e&&e.id;return{setters:[function(t){n=t}],execute:function(){o=function(){function t(t,e,n,o){this.key=t,this.title=e,this.placeholder=o||"",this.value=n}return t.prototype.parseValue=function(){this.$input&&(this.value=this.$input.value),this.$control=null,delete this._$control},Object.defineProperty(t.prototype,"$control",{get:function(){return this._$control||(this._$control=n.$dom.el("<div class="+(this.key?"bre-prompt-field":"bre-prompt-subtitle")+'>\n                            <label class="bre-label" for="'+this.key+'">'+(this.title?this.title:"Select file...")+"</label>\n                        </div>"),this.$input=this.key?this.getEditor():null,null!=this.$input&&this._$control.appendChild(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),t.prototype.getEditor=function(){var t=document.createElement("input");return t.id=this.key,t.className="bre-input",t.setAttribute("type","text"),t.setAttribute("placeholder",this.placeholder),t.value=this.value||"",t},t}(),t("PromptParameter",o)}}}),System.register("Prompt/PromptParameterImage",["Prompt/Prompt","Common/DOMHelpers"],function(t,e){"use strict";var n,o,i;e&&e.id;return{setters:[function(t){n=t},function(t){o=t}],execute:function(){i=function(t){function e(e,n,o,i){var r=t.call(this,e,n,o,i)||this;return o&&(r._value=o),r}return __extends(e,t),e.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},e.prototype.getEditor=function(){var t=this,e=this.value&&this.value.fileContent?this.value.fileContent:"",i=o.$dom.el("\n                <div class='bre-image-input'>\n                    <label for=\""+this.key+'">\n                        '+this.placeholder+'\n                    </label>                        \n                    <img src="'+e+'"/>                    \n                    <input type="file" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='bre-image-input-filename'></small>"),r=i.querySelector("input"),s=i.querySelector("img"),l=i.querySelector(".bre-image-input-filename");this.value;return t.updatePreview(s,l,this.value),r.onchange=function(){if(r.files&&r.files[0]){var e=new FileReader;e.onload=function(e){var o=e.target;t._value=new n.PromptParameterImageResult,t._value.fileContent=o.result,t._value.fileInfo=new n.PromptParameterImageResultFile(r.files[0]),t.updatePreview(s,l,t._value)},e.readAsDataURL(r.files[0])}},i},e.prototype.updatePreview=function(t,e,n){n&&(t.src=n.fileContent,t.classList.add("bre-loaded"),e.innerText=n.fileInfo.name)},e}(n.PromptParameter),t("PromptParameterImage",i)}}}),System.register("Prompt/PromptParameterImageResult",[],function(t,e){"use strict";var n,o;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t}(),t("PromptParameterImageResult",n),o=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}(),t("PromptParameterImageResultFile",o)}}}),System.register("Prompt/PromptParameterList",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(t){this.params=t}return t.prototype.getValue=function(t){var e=this.params.find(function(e){return e.key===t});return e?e.value:null},t}(),t("PromptParameterList",n)}}}),System.register("Prompt/PromptParameterOption",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(t,e,n){void 0===n&&(n=!1),this.title=t,this.value=e,this.selected=n}return t}(),t("PromptParameterOption",n)}}}),System.register("Prompt/PromptParameterOptions",["Common/DOMHelpers","Prompt/Prompt"],function(t,e){"use strict";var n,o,i;e&&e.id;return{setters:[function(t){n=t},function(t){o=t}],execute:function(){i=function(t){function e(e,n,i,r,s){var l=t.call(this,e,n,r,s)||this;return l.options=[],i.forEach(function(t){l.options.push(new o.PromptParameterOption(t[0],t[1],t[1]==r))}),l}return __extends(e,t),e.prototype.getEditor=function(){var t=this.options.map(function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return n.$dom.el('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+t+"</select>")},e}(o.PromptParameter),t("PromptParameterOptions",i)}}}),System.register("Prompt/Prompt",["Prompt/PromptParameter","Prompt/PromptParameterImage","Prompt/PromptParameterImageResult","Prompt/PromptParameterList","Prompt/PromptParameterOption","Prompt/PromptParameterOptions"],function(t,e){"use strict";function n(e){var n={};for(var o in e)"default"!==o&&(n[o]=e[o]);t(n)}e&&e.id;return{setters:[function(t){n(t)},function(t){n(t)},function(t){n(t)},function(t){n(t)},function(t){n(t)},function(t){n(t)}],execute:function(){}}}),System.register("HtmlLinkParams",["Prompt/Prompt","EditorStrings"],function(t,e){"use strict";var n,o,i;e&&e.id;return{setters:[function(t){n=t},function(t){o=t}],execute:function(){i=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),this.href=t,this.title=e,this.target=n}return t.prototype.getLinkPromptParams=function(){return[new n.PromptParameter("href",o.EditorStrings.htmlEditorLinkUrlTitle,this.href,o.EditorStrings.htmlEditorLinkUrlPlaceholder),new n.PromptParameter("title",o.EditorStrings.htmlEditorLinkTitleTitle,this.title,o.EditorStrings.htmlEditorLinkTitlePlaceholder),new n.PromptParameterOptions("target",o.EditorStrings.htmlEditorLinkTargetTitle,[["",""],[o.EditorStrings.htmlEditorLinkTargetBlank,"_blank"],[o.EditorStrings.htmlEditorLinkTargetSelf,"_self"],[o.EditorStrings.htmlEditorLinkTargetParent,"_parent"],[o.EditorStrings.htmlEditorLinkTargetTop,"_top"]],this.target)]},t.getLinkFromParams=function(e){return new t(e.getValue("href"),e.getValue("title"),e.getValue("target"))},t}(),t("HtmlLinkParams",i)}}}),System.register("UI/HtmlTools",["Common/DOMHelpers","Editor","HtmlLinkParams","UI/Selectors"],function(t,e){"use strict";var n,o,i,r,s;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t}],execute:function(){s=function(){function t(t){this.editor=t,this.buttons=[{icon:"bold",command:"Bold",range:!0,aValueArgument:null},{icon:"italic",command:"Italic",range:!0,aValueArgument:null},{icon:"link",command:"CreateLink",range:!0,aValueArgument:null},{icon:"list-ul",command:"insertUnorderedList",range:!0,aValueArgument:null},{icon:"list-ol",command:"insertOrderedList",range:!0,aValueArgument:null},{icon:"undo",command:"Undo",range:!1,aValueArgument:null},{icon:"repeat",command:"Redo",range:!1,aValueArgument:null}],t.options.htmlToolsButtons&&(this.buttons=t.options.htmlToolsButtons),this.setControl()}return t.prototype.setControl=function(){var t=this,e=n.$dom.el('<div class="bre-html-tools-panel"></div>');this.buttons.forEach(function(n){var o=t.getButtonElement(n.icon,n.command,n.range,n.aValueArgument);e.appendChild(o)}),this.$control=n.$dom.el('<div class="bre-html-tools bre-btn-group"></div>'),this.$control.appendChild(e),n.$dom.hide(this.$control),this.editor.$editor.appendChild(this.$control)},t.prototype.getButtonElement=function(t,e,r,s){var l=this;void 0===r&&(r=!0),void 0===s&&(s=null);var c=n.$dom.el('<button type="button" class="bre-btn"><i class="fa fa-'+t+'"></i></button>');return c.onclick=function(){return __awaiter(l,void 0,void 0,function(){var t,n,l,c,a,u;return __generator(this,function(d){switch(d.label){case 0:return t=window.getSelection(),(n=t.rangeCount>0?t.getRangeAt(0):null,r&&!n)?[2]:"CreateLink"!=e?[3,2]:(l=this.getLinkPromptParamsInternal(t),[4,o.Editor.UI.modal.promptAsync(l)]);case 1:return c=d.sent(),a=i.HtmlLinkParams.getLinkFromParams(c),a.href&&(document.execCommand(e,!1,a.href),a.target&&t.anchorNode.parentElement.setAttribute("target",a.target),a.title&&t.anchorNode.parentElement.setAttribute("title",a.title)),[3,3];case 2:"string"==typeof s&&(u=s.replace("%%SELECTION%%",t.toString()));try{document.execCommand(e,!1,u)}catch(n){this.wrapSelectionToContainer(t),document.execCommand(e,!1,u)}d.label=3;case 3:return[2,!1]}})})},c},t.prototype.wrapSelectionToContainer=function(t){var e=t.anchorNode.parentElement,o=n.$dom.el('<div class="bre-temp-container" contenteditable="true">'+e.innerHTML+"</div>");e.innerHTML="",e.removeAttribute(r.Selectors.attrContentEditable),e.appendChild(o);var i=document.createRange();i.selectNodeContents(o),t.removeAllRanges(),t.addRange(i)},t.prototype.show=function(t){if(t&&t.width>1){var e=this.editor.$editor,o=n.$dom.offset(e),i=e.clientWidth,r=t.top-o.top+n.$dom.windowScrollTop()+t.height,s=this.$control.clientWidth,l=t.left-o.left+t.width/2-s/2;l<0?l=0:l+s>i&&(l=i-s),this.$control.style.top=r+"px",this.$control.style.left=l+"px",n.$dom.show(this.$control)}else n.$dom.hide(this.$control)},t.prototype.getLinkPromptParamsInternal=function(t){var e;if(t&&t.anchorNode&&t.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var n=t.anchorNode.parentNode;e=new i.HtmlLinkParams(n.getAttribute("href"),n.getAttribute("title"),n.getAttribute("target"))}else e=new i.HtmlLinkParams;return e.getLinkPromptParams()},t}(),t("HtmlTools",s)}}}),System.register("UI/Modal",["Common/DOMHelpers","Prompt/Prompt"],function(t,e){"use strict";var n,o,i;e&&e.id;return{setters:[function(t){n=t},function(t){o=t}],execute:function(){i=function(){function t(t,e,o,i,r,s){this.$control=t,this.$closeBtn=e,this.$form=o,this.$btns=i,this.$okBtn=r,this.$cancelBtn=s;var l=this;n.$dom.on(e,"click",function(){l.hideModal()})}return t.prototype.hideModal=function(){this.restoreSelection(),n.$dom.hide(this.$control)},t.prototype.showModal=function(t,e){void 0===e&&(e=!0),this.saveSelection(),n.$dom.toggle(this.$btns,e),t&&(this.$form.appendChild(t),n.$dom.isHidden(t)&&n.$dom.show(t)),n.$dom.show(this.$control)},t.prototype.promptAsync=function(t){var e=this,i=this;return new Promise(function(r,s){for(var l=0;l<i.$form.children.length;l++){var c=i.$form.children[l];c!=e.$btns&&i.$form.removeChild(c)}t.forEach(function(t){n.$dom.before(e.$btns,t.$control)}),n.$dom.on(i.$okBtn,"click",function(){t.forEach(function(t){return t.parseValue()}),i.hideModal();var e=new o.PromptParameterList(t);r(e)}),n.$dom.on(i.$cancelBtn,"click",function(){i.hideModal(),r(null)}),i.showModal()})},t.prototype.saveSelection=function(){var t=window.getSelection();this.selectionRanges=[];for(var e=0;e<t.rangeCount;e++)this.selectionRanges.push(t.getRangeAt(e))},t.prototype.restoreSelection=function(){if(this.selectionRanges&&0!=this.selectionRanges.length){var t=window.getSelection();t.removeAllRanges(),this.selectionRanges.forEach(function(e){return t.addRange(e)})}},t}(),t("Modal",i)}}}),System.register("UI/UI",["Common/DOMHelpers","UI/Selectors","EditorStrings","UI/HtmlTools","UI/Modal"],function(t,e){"use strict";var n,o,i,r,s,l;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t}],execute:function(){l=function(){function t(t){this.editor=t,this.editor=t,this.setTools(),this.setModal(),this.htmlTools=new r.HtmlTools(this.editor)}return Object.defineProperty(t.prototype,"isCompactTools",{get:function(){var t=this.editor.options.compactTools;return null==t?window.innerWidth<this.editor.options.compactToolsWidth:t.valueOf()},enumerable:!0,configurable:!0}),t.prototype.setTools=function(){var t=this;this.$tools=n.$dom.el('<div class="bre bre-tools" data-bricky-tools></div>'),this.$toolsTemplates=n.$dom.el('<div class="bre-tools-templates"></div>'),this.$toolsLoader=n.$dom.el('<div class="bre-tools-loader"><b>Loading...</b></div>'),this.$toolsHideBtn=n.$dom.el('<button type="button" class="bre-tools-toggle"><div>►</div></button>'),this.$tools.appendChild(this.$toolsHideBtn),this.$tools.appendChild(this.$toolsLoader),this.$tools.appendChild(this.$toolsTemplates),this.$toolsHideBtn.onclick=function(e){return t.toggleTools()},this.editor.$editor.appendChild(this.$tools),this.isCompactTools&&(n.$dom.addClass(this.$tools,"bre-tools-templates-compact"),this.toggleTools())},t.prototype.toggleTools=function(){n.$dom.toggleClass(this.$tools,"bre-tools-collapsed",!n.$dom.hasClass(this.$toolsHideBtn,"bre-tools-toggle-collapsed")),n.$dom.toggleClass(this.$toolsHideBtn,"bre-tools-toggle-collapsed")},t.prototype.setModal=function(){var t=n.$dom.el('<div class="bre bre-modal"><div class="bre-modal-placeholder"></div></div>'),e=n.$dom.el('<div class="bre-modal-close"><a href="#">'+i.EditorStrings.buttonClose+" ✖</a></div>"),o=n.$dom.el('<div class="bre-modal-content"></div>'),r=n.$dom.el("<form></form>"),l=n.$dom.el('<div class="bre-btns"></div>'),c=n.$dom.el('<button type="button" class="bre-btn bre-btn-primary">'+i.EditorStrings.buttonOk+"</button>"),a=n.$dom.el('<button type="button" class="bre-btn">'+i.EditorStrings.buttonCancel+"</button>");l.appendChild(c),l.appendChild(a),r.appendChild(l),o.appendChild(r);var u=n.$dom.first(t,".bre-modal-placeholder");u.appendChild(e),u.appendChild(o),this.modal=new s.Modal(t,e,r,l,c,a),this.editor.$editor.appendChild(t)},t.prototype.toggleToolsLoader=function(t){n.$dom.toggle(this.$toolsLoader,t)},t.prototype.setTemplates=function(t){var e=this,i=this.editor;t.forEach(function(t){if(0!==t.templates.length){var r=n.$dom.el("<div class='"+o.Selectors.classTemplateGroup+"'>"+t.name+"</div>");e.$toolsTemplates.appendChild(r);var s=n.$dom.el("<div></div>");t.templates.forEach(function(t){var e=t.getPreview();e.setAttribute("title",t.name),e.onclick=function(e){return i.addBlock(t),e.stopPropagation(),!1},s.appendChild(e)}),n.$dom.on(r,"click",function(){n.$dom.toggle(s)}),e.$toolsTemplates.appendChild(s)}})},t.initBtnDeck=function(e){var o=n.$dom.select(e,".bre-btn"),i=o[0];n.$dom.on(i,"click",function(n){return t.toggleBtnDeck(e),n.stopPropagation(),!1})},t.toggleBtnDeck=function(t,e){var o=n.$dom.select(t,".bre-btn");if(o&&0!=o.length){var i=o[0];e=e||t.dataset.isOn||!1,e?(t.style.height="0",t.style.width="0",o.forEach(function(t,e){0!==e&&(t.style.opacity="0",t.style.top="0",t.style.left="0")})):(o.forEach(function(t,e){0!==e&&(t.style.opacity="1",t.style.left=(e+1)*(32+32/6)+"px")}),t.style.height="32px",t.style.width=(32+32/6)*o.length-32/6+"px"),n.$dom.toggleClass(i,"bre-btn-active",!e),t.dataset.isOn=String(!e)}},t}(),t("UI",l)}}}),System.register("EditorOptions",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(t){this.templatesUrl="templates/bootstrap4.html",this.onError=function(t){console.log(t.message)},
this.compactTools=null,this.compactToolsWidth=768,this.ignoreHtml=null,this.htmlToolsButtons=null,this.templatesUrl=t.templatesUrl||this.templatesUrl,this.onLoad=t.onLoad||t.onload,this.onChange=t.onChange,this.onBlockAdd=t.onBlockAdd,this.onBlockDelete=t.onBlockDelete,this.onBlockMove=t.onBlockMove,this.onBlockSelect=t.onBlockSelect,this.onBlockDeselect=t.onBlockDeselect,this.onBlockUpdate=t.onBlockUpdate,this.onError=t.onError||this.onError,this.onUpload=t.onUpload||null,this.blocksUrl=t.blocksUrl||null,this.blocks=t.blocks||null,this.compactTools=t.compactTools,this.ignoreHtml=t.ignoreHtml||!1,this.htmlToolsButtons=t.htmlToolsButtons||null,this.formSelector=t.formSelector||null,this.inputSelector=t.inputSelector||null}return t}(),t("EditorOptions",n)}}}),System.register("Editor",["Common/DOMHelpers","Common/AJAXHelper","BlocksContainer","EditorStrings","Services/Services","Events","Fields/Fields","UI/Selectors","UI/UI","Common/Common","EditorOptions"],function(t,e){"use strict";var n,o,i,r,s,l,c,a,u,d,p,m;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t},function(t){l=t},function(t){c=t},function(t){a=t},function(t){u=t},function(t){d=t},function(t){p=t}],execute:function(){m=function(){function t(e,n){var o=this;this.onError=function(t,e){return void 0===e&&(e=0),o.options.onError({message:t,code:e})},c.BaseField.registerCommonFields(),this.$editor=e,this.$editor.classList.add(a.Selectors.classEditor),this.options=new p.EditorOptions(n),this.container=this.createContainer(),t.UI=new u.UI(this),this.tryBindFormSubmit()}return t.prototype.createContainer=function(){var t=this,e=function(e,n){t.isLoaded&&(t.trigger(l.Events.onBlockAdd,{block:e,idx:n}),t.trigger(l.Events.onChange,{blocks:t.getData(),html:t.getHtml()}))},n=function(e,n){t.trigger(l.Events.onBlockDelete,{block:e,idx:n}),t.trigger(l.Events.onChange,{blocks:t.getData(),html:t.getHtml()})},o=function(e,n,o,i){t.trigger(l.Events.onBlockUpdate,{block:e,property:n,oldValue:o,newValue:i}),t.trigger(l.Events.onChange,{blocks:t.getData(),html:t.getHtml()})};return new i.BlocksContainer(this.$editor,e,n,function(e){t.trigger(l.Events.onBlockSelect,{block:e})},function(e){t.trigger(l.Events.onBlockDeselect,{block:e})},function(e,n,o){t.trigger(l.Events.onBlockMove,{block:e,from:n,to:o}),t.trigger(l.Events.onChange,{blocks:t.getData(),html:t.getHtml()})},o,this.options.onUpload)},t.prototype.initAsync=function(){return __awaiter(this,void 0,void 0,function(){var e,n,o;return __generator(this,function(i){switch(i.label){case 0:return e=this,t.UI.toggleToolsLoader(!0),[4,s.TemplateService.loadTemplatesAsync(e.options.templatesUrl,e.$editor,e.onError)];case 1:return n=i.sent(),t.UI.toggleToolsLoader(!1),t.UI.setTemplates(n),[4,this.tryLoadInitialBlocksAsync()];case 2:return o=i.sent(),this.loadBlocks(o),this.isLoaded=!0,this.trigger(l.Events.onLoad,this),[2]}})})},t.prototype.tryLoadInitialBlocksAsync=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n=this;return __generator(this,function(i){return t=this.options.blocksUrl,e=this,[2,new Promise(function(i,s){return __awaiter(n,void 0,void 0,function(){var n,l;return __generator(this,function(c){switch(c.label){case 0:if(!t)return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.$ajax.get(t)];case 2:return n=c.sent(),i(n),[3,4];case 3:return l=c.sent(),e.onError(r.EditorStrings.errorBlocksFileNotFound(t)),s(l),[3,4];case 4:return[3,6];case 5:i(this.options.blocks?this.options.blocks:null),c.label=6;case 6:return[2]}})})})]})})},t.prototype.tryBindFormSubmit=function(){var t=this,e=this.options.formSelector?n.$dom.find(this.options.formSelector):null,o=this.options.inputSelector?n.$dom.find(this.options.inputSelector):null;e&&o&&o instanceof HTMLInputElement&&n.$dom.on(e,"submit",function(){return o.value=JSON.stringify(t.getData()),!0})},t.prototype.getData=function(){return this.container.getData(this.options.ignoreHtml)},t.prototype.getHtml=function(){return this.container.getHtml()},t.prototype.loadBlocks=function(t){var e=this;t&&t.length&&t.forEach(function(t){var n=s.TemplateService.getTemplate(t.template);if(n)e.container.addBlock(n,t.fields,null,!1);else{var o=r.EditorStrings.errorBlockTemplateNotFound(t.template);e.onError(o)}})},t.prototype.addBlock=function(t){this.getContainer(this.container).addBlock(t,null,null,!0)},t.prototype.getContainer=function(t){if(t.selectedBlock&&t.selectedBlock.isContainer()){var e=t.selectedBlock.selectedField;if(e)return this.getContainer(e.container)}return t},t.prototype.trigger=function(t,e){var o=this;n.$dom.trigger(this.$editor,"bre."+t,e),d.Common.propsEach(o.options,function(n,o){n.breEqualsInvariant(t)&&o&&o(e)})},t}(),t("Editor",m)}}}),System.register("Fields/EmbedField",["Common/DOMHelpers","Fields/BaseField","Editor","EditorStrings","Common/AJAXHelper","Prompt/Prompt","Services/Services"],function(t,e){"use strict";var n,o,i,r,s,l,c,a;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t},function(t){l=t},function(t){c=t}],execute:function(){a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getSettingsEl=function(){var t=n.$dom.el('<div style="position: absolute;width: 100%; height: 100px;;text-align: center;font-weight: bold;vertical-align: middle;background: #333;opacity: 0.2;">Change embed element link</div>');return n.$dom.before(this.$field,t),t},Object.defineProperty(e.prototype,"settings",{get:function(){var t=this;return function(e){t.showEmbedLoaderAsync(e)}},enumerable:!0,configurable:!0}),e.prototype.bind=function(){var t=this,e=this,o=this.$field;n.$dom.on(o,"click",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return this.showEmbedLoaderAsync(e),[2]})})}),e.loadMedia(!1)},e.prototype.showEmbedLoaderAsync=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(o){switch(o.label){case 0:return[4,i.Editor.UI.modal.promptAsync(t.getPromptParams())];case 1:return null==(e=o.sent())?[3,3]:(n=e.getValue("url"))?(t.setUrl(n),[4,t.loadMedia(!0)]):[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})},e.prototype.getPromptParams=function(){return[new l.PromptParameter("url",r.EditorStrings.embedFieldLinkTitle,this.data.url||"http://instagr.am/p/BO9VX2Vj4fF/",r.EditorStrings.embedFieldLinkPlaceholder)]},e.prototype.loadMedia=function(t){return __awaiter(this,void 0,void 0,function(){var e,o,i,r,l;return __generator(this,function(a){switch(a.label){case 0:return e=this,e.data&&e.data.url?[4,c.EmbedService.getEmbedAsync(e.data.url)]:[2];case 1:return o=a.sent(),e.setEmbed(o,t),i=n.$dom.el(o.html),r=n.$dom.first(i,"script"),r&&(r.remove(),l=r.src,l.breStartsWith("//")&&(l="https:"+l,s.$ajax.getScript(l).then(function(){c.EmbedService.processEmbed(o.provider_name)}))),e.$field.innerHTML="",e.$field.removeAttribute("class"),e.$field.removeAttribute("style"),e.$field.appendChild(i),e.select(),[2]}})})},e.prototype.setEmbed=function(t,e){void 0===e&&(e=!0),this.updateProperty("embed",t,e)},e.prototype.setUrl=function(t){this.updateProperty("url",t)},e}(o.BaseField),t("EmbedField",a)}}}),System.register("UI/SelectionUtils",["Common/DOMHelpers"],function(t,e){"use strict";var n,o;e&&e.id;return{setters:[function(t){n=t}],execute:function(){o=function(){function t(){}return t.bindTextSelection=function(t,e){var o=this;n.$dom.matches(t,"[contenteditable]")&&(n.$dom.on(t,"mouseup",function(){setTimeout(function(){var t=o.getSelectionRect();e(t)},0)}),n.$dom.on(t,"keyup",function(t){var n=o.getSelectionRect();e(n)}))},t.getSelectionRect=function(){var t=window.getSelection(),e=t.getRangeAt(0);if(e){var n=e.getBoundingClientRect();if(n)return n}return null},t}(),t("SelectionUtils",o)}}}),System.register("Fields/HtmlField",["Common/DOMHelpers","UI/Selectors","Fields/BaseField","Editor","UI/SelectionUtils"],function(t,e){"use strict";var n,o,i,r,s,l;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t}],execute:function(){l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.bind=function(){var t=this,e=this,i=this.$field;n.$dom.matches(i,o.Selectors.selectorContentEditable)||i.setAttribute(o.Selectors.attrContentEditable,"true");var l=this.data.html||this.$field.innerHTML;this.setHtml(l,!1),i.innerHTML=this.data.html,s.SelectionUtils.bindTextSelection(i,function(t){r.Editor.UI.htmlTools.show(t)}),n.$dom.ons(i,"blur keyup paste input",function(e){t.setHtml(i.innerHTML)}),n.$dom.on(i,"paste",function(t){t.preventDefault();var e=t.originalEvent,n=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,n)}),n.$dom.on(i,"click",function(t){return e.select(),t.stopPropagation(),!1})},e.prototype.setHtml=function(t,e){void 0===e&&(e=!0),t=t.trim(),this.$field.innerHTML!==t&&(this.$field.innerHTML=t),this.updateProperty("html",t,e)},e.prototype.getEl=function(){var e=t.prototype.getEl.call(this);return e.removeAttribute(o.Selectors.attrContentEditable),e},e}(i.BaseField),t("HtmlField",l)}}}),System.register("Fields/ImageField",["Fields/BaseField","Editor","Common/DOMHelpers","Prompt/Prompt","HtmlLinkParams","EditorStrings"],function(t,e){"use strict";var n,o,i,r,s,l,c;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t},function(t){l=t}],execute:function(){c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.bind=function(){var t=this,e=this;this.data;this.setSrc(this.data.src,!1),i.$dom.on(this.$field,"click",function(){return __awaiter(t,void 0,void 0,function(){var t,n,i,r,l;return __generator(this,function(c){switch(c.label){case 0:return[4,o.Editor.UI.modal.promptAsync(e.getPromptParams())];case 1:return t=c.sent(),null!=t&&(n=t.getValue("file"),i=t.getValue("src"),n?e.onUpload?e.onUpload(n,function(t){e.setSrc(t),e.setFile(null)}):(e.setFile(n),e.setSrc(null)):i&&(e.setSrc(i),e.setFile(null)),r=t.getValue("alt"),e.setAlt(r),l=s.HtmlLinkParams.getLinkFromParams(t),this.setLink(l)),e.select(),[2]}})})})},e.prototype.getPromptParams=function(){var t=[new r.PromptParameter("src",l.EditorStrings.imageFieldLinkTitle,this.data.url,l.EditorStrings.imageFieldLinkPlaceholder),new r.PromptParameterImage("file",l.EditorStrings.imageFieldUploadTitle,this.data.file,l.EditorStrings.imageFieldUploadButton),new r.PromptParameter("alt",l.EditorStrings.imageFieldAltTitle,this.data.alt,l.EditorStrings.imageFieldAltPlaceholder),new r.PromptParameter(null,l.EditorStrings.imageFieldUrlSubtitle,null,null)],e=this.data.link?this.data.link:new s.HtmlLinkParams,n=e.getLinkPromptParams();return t.concat(n)},e.prototype.setSrc=function(t,e){void 0===e&&(e=!0),t&&(this.isImg?this.$field.setAttribute("src",t):this.$field.style.backgroundImage="url("+t),this.updateProperty("src",t,e)},e.prototype.setAlt=function(t){this.$field.setAttribute(this.isImg?"alt":"title",t),this.updateProperty("alt",t)},e.prototype.setFile=function(t){t&&(this.isImg?this.$field.setAttribute("src",t.fileContent):this.$field.style.backgroundImage="url("+t.fileContent+")"),this.updateProperty("file",t)},e.prototype.setLink=function(t){t&&t.href?this.$link?this.$link.href=t.href:(this.$link=i.$dom.el("<a href='"+t.href+"' title='"+t.title+"' target='"+t.target+"'></a>"),i.$dom.on(this.$link,"click",function(t){return t.stopPropagation(),!1}),i.$dom.wrap(this.$field,this.$link)):this.$link&&(i.$dom.unwrap(this.$field),this.$link=null,delete this.$link),this.updateProperty("link",t)},Object.defineProperty(e.prototype,"isImg",{get:function(){return this._isImg=this._isImg||"img"===this.$field.tagName.toLowerCase()},enumerable:!0,configurable:!0}),e.prototype.getEl=function(){var e=t.prototype.getEl.call(this),n=this.data.link;if(n&&n.href){var o=i.$dom.el("<a href='"+n.href+"' title='"+n.title+"' target='"+n.target+"'></a>");return o.appendChild(e),o}return e},e}(n.BaseField),t("ImageField",c)}}}),System.register("Fields/Fields",["Fields/BaseField","Fields/ContainerField","Fields/EmbedField","Fields/HtmlField","Fields/ImageField"],function(t,e){"use strict";function n(e){var n={};for(var o in e)"default"!==o&&(n[o]=e[o]);t(n)}e&&e.id;return{setters:[function(t){n(t)},function(t){n(t)},function(t){n(t)},function(t){n(t)},function(t){n(t)}],execute:function(){}}}),System.register("Block/BlockUI",["Common/DOMHelpers","UI/UI"],function(t,e){"use strict";var n,o,i;e&&e.id;return{setters:[function(t){n=t},function(t){o=t}],execute:function(){i=function(){function t(t,e,n,o){this.$block=t,this.onSelect=o,e||this.buildEditorUI(n)}return t.prototype.delete=function(){this.$editor.remove()},t.prototype.toggleSelection=function(t){this.$editor.classList.toggle("bre-selected",t)},t.prototype.buildEditorUI=function(t){var e=this;this.$tools=n.$dom.el('<div class="bre-block-tools bre-btn-deck"></div>'),t.forEach(function(t){var n=e.buildButton(t);e.$tools.appendChild(n)}),o.UI.initBtnDeck(this.$tools),this.$editor=n.$dom.el('<div class="bre-block-wrapper"></div>'),this.$editor.appendChild(this.$tools),this.$editor.appendChild(this.$block),n.$dom.on(this.$editor,"mouseover",function(){e.$editor.classList.add("bre-active")}),n.$dom.on(this.$editor,"mouseout",function(){e.$editor.classList.remove("bre-active")}),n.$dom.on(this.$editor,"click",function(){e.onSelect()})},t.prototype.buildButton=function(t){var e=n.$dom.el('<button type="button" class="bre-btn"><i class="fa fa-'+t.icon+'"></i></button>');return t.action&&(e.onclick=function(e){return t.action(),e.stopPropagation(),!1}),e},t}(),t("BlockUI",i)}}}),System.register("Block/Block",["Common/DOMHelpers","UI/Selectors","Block/BlockUIAction","Fields/Fields","Block/BlockUI"],function(t,e){"use strict";var n,o,i,r,s,l;e&&e.id;return{setters:[function(t){n=t},function(t){o=t},function(t){i=t},function(t){r=t},function(t){s=t}],execute:function(){l=function(){function t(t,e,o,i,r,l,c,a,u,d){var p=this;this.template=t,this.onDelete=i,this.onSelect=r,this.onDeselect=l,this.onCopy=c,this.onMove=a,this.onUpdate=u,this.onUpload=d,this.fields=[];var m=n.$dom.el(t.$html.innerHTML);this.bindFields(m,o);var h=this.getActions();this.ui=new s.BlockUI(m,e,h,function(){return p.select()})}return t.prototype.isContainer=function(){return!!this.selectedField&&this.selectedField instanceof r.ContainerField},t.prototype.bindFields=function(t,e){var i=this;n.$dom.select(t,o.Selectors.selectorField,!0).forEach(function(t){var n=function(t,e,n){i.onUpdate&&i.onUpdate(i,t,e,n)},o=function(t){i.select(t)},s=r.BaseField.createField(t,e,o,n,i.onUpload);i.fields.push(s)})},t.prototype.getActions=function(){var t=this;return[new i.BlockUIAction("ellipsis-h"),new i.BlockUIAction("trash-o",function(){return t.delete()}),new i.BlockUIAction("copy",function(){return t.clone()}),new i.BlockUIAction("angle-up",function(){return t.move(-1)}),new i.BlockUIAction("angle-down",function(){return t.move(1)})]},t.prototype.delete=function(){this.ui.delete(),this.onDelete(this)},t.prototype.move=function(t){this.onMove(this,t)},t.prototype.clone=function(){this.onCopy(this)},t.prototype.select=function(t){t!==this.selectedField&&(null===t&&(t=this.fields[0]),this.selectedField&&this.selectedField.deselect(),this.selectedField=t,this.ui.toggleSelection(!0),this.onSelect(this))},t.prototype.deselect=function(){this.selectedField=null,this.fields.forEach(function(t){t.deselect()}),this.ui.toggleSelection(!1),this.onDeselect(this)},t.prototype.scrollTo=function(){var t=n.$dom.offset(this.ui.$editor).top-100;t=t>0?t:0},t.prototype.getData=function(t){var e=[];this.fields.forEach(function(t){e.push(t.data)});var n={template:this.template.name,fields:e};return t||(n.html=this.getHtml(!0)),n},t.prototype.getHtml=function(t){var e=n.$dom.el(this.template.$html.innerHTML),i={};this.fields.forEach(function(t){var e=t.name||t.data.name;i[e]=t.getEl()}),n.$dom.select(e,o.Selectors.selectorField,!0).forEach(function(t){var e=n.$dom.data(t,"breField"),o=e.name,r=i[o];n.$dom.replaceWith(t,r)});var r=e.outerHTML;return r?t?r.breTotalTrim():r:null},t}(),t("Block",l)}}}),System.register("BlocksContainer",["Block/Block","Common/DOMHelpers"],function(t,e){"use strict";var n,o,i;e&&e.id;return{setters:[function(t){n=t},function(t){o=t}],execute:function(){i=function(){function t(t,e,n,o,i,r,s,l,c){void 0===c&&(c=!1),this.$element=t,this.onAddBlock=e,this.onDeleteBlock=n,this.onSelectBlock=o,this.onDeselectBlock=i,this.onMoveBlock=r,this.onUpdateBlock=s,this.onUpload=l,this.usePlaceholder=c,this.blocks=[],this.isContainer=!0,this.togglePlaceholderIfNeed()}return t.prototype.getData=function(t){var e=[];return this.blocks.forEach(function(n){e.push(n.getData(t))}),e},t.prototype.getHtml=function(){var t=[];this.blocks.forEach(function(e){t.push(e.getHtml(!0))});var e=o.$dom.clone(this.$element);return e.innerHTML=t.join("\n"),e.outerHTML},t.prototype.addBlock=function(t,e,o,i){var r=this;void 0===i&&(i=!0);var s=new n.Block(t,!1,e,function(t){return r.deleteBlock(t)},function(t){return r.selectBlock(t)},function(t){return r.deselectBlock(t)},function(t){return r.copyBlock(t)},function(t,e){return r.moveBlock(t,e)},this.onUpdateBlock,this.onUpload);this.insertBlock(s,o),i&&(s.select(),s.scrollTo())},t.prototype.insertBlock=function(t,e){e=e||this.blocks.length,this.selectedBlock&&(e=this.blocks.indexOf(this.selectedBlock)+1),this.blocks.splice(e,0,t),0==e?this.$element.appendChild(t.ui.$editor):o.$dom.after(this.blocks[e-1].ui.$editor,t.ui.$editor),this.onAddBlock(t,e),t.select(null),this.togglePlaceholderIfNeed()},t.prototype.deleteBlock=function(t){var e=this.blocks.indexOf(t);this.blocks.splice(e,1),t=null,e<this.blocks.length?this.blocks[e].select():this.blocks.length>0?this.blocks[e-1].select():this.selectedBlock=null,this.onDeleteBlock(t,e),this.togglePlaceholderIfNeed()},t.prototype.moveBlock=function(t,e){var n=this.blocks.indexOf(t),i=n+e;if(!(i>=this.blocks.length||i<0)){var r=this.blocks[i].ui.$editor;e>0?o.$dom.after(r,t.ui.$editor):e<0&&o.$dom.before(r,t.ui.$editor),this.blocks.splice(n,1),this.blocks.splice(i,0,t),this.onMoveBlock(t,n,i),t.scrollTo()}},t.prototype.copyBlock=function(t){var e=this.blocks.indexOf(t)+1;this.addBlock(t.template,t.getData().fields,e,!0)},t.prototype.selectBlock=function(t){this.selectedBlock!==t&&(this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=t,this.onSelectBlock(t))},t.prototype.deselectBlock=function(t){this.selectedBlock=null,this.onDeselectBlock(t)},t.prototype.togglePlaceholderIfNeed=function(){this.usePlaceholder&&(0===this.blocks.length?this.$placeholder||(this.$placeholder=o.$dom.el('<i data-bre-placeholder="true">Click here to select this container...</i>'),this.$element.appendChild(this.$placeholder)):this.$placeholder&&(this.$placeholder.remove(),this.$placeholder=null))},t}(),t("BlocksContainer",i)}}}),System.register("Block/BlockAction",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){!function(t){var e=function(){function t(t,e,n){this.icon=t,this.action=e,this.title=n}return t}();t.BlockAction=e}(n||(n={})),t("BrickyEditor",n)}}}),System.register("UI/SelectionHelper",[],function(t,e){"use strict";var n;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,n;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(n=e.getRangeAt(0),n.deleteContents(),n.insertNode(document.createTextNode(t))))},t}(),t("SelectionHelper",n)}}});