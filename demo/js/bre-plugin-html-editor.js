var brePluginHtmlEditor=function(e){"use strict";var p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(a,i,l,u){return new(l=l||Promise)(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(n,r)}o((u=u.apply(a,i||[])).next())})}function v(n,r){var o,a,i,e,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(i=2&t[0]?a.return:t[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,t[1])).done)return i;switch(a=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,a=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],a=0}finally{o=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function n(e){var t=e.tag,n=void 0===t?"div":t,r=e.className,o=e.innerHTML,a=e.props,i=document.createElement(n);return void 0!==r&&(Array.isArray(r)?r.forEach(function(e){return i.classList.add(e)}):i.className=r),void 0!==o&&(i.innerHTML=o),void 0!==a&&Object.assign(i,a),i}function h(e,t,n){var r=n.title;if(void 0!==r){var o=y({tag:"label",className:"bre-field-editor-label",innerHTML:r,props:{onclick:function(){return t.focus()}}});e.append(o)}}function g(o){var e=o.type,t=o.placeholder,n=b("bre-field-editor-prop"),a=y({tag:"input",className:"bre-field-editor-input",props:{type:e,placeholder:t||""}});if("text"===o.type){var r=function(){o.onUpdate(a.value)};a.value=o.value||"",a.onchange=r,a.onkeyup=r,a.onpaste=r}else o.type="file",a.onchange=function(){return i(void 0,void 0,void 0,function(){var t,n,r;return v(this,function(e){switch(e.label){case 0:return t=a.files,null===(n=null===t?null:t[0])?[3,2]:[4,l(n)];case 1:r=e.sent(),o.onUpdate(n,r),e.label=2;case 2:return[2]}})})};return h(n,a,o),n.append(a),n}function m(e){var t,n,r,o,a,i,l,u=e?p({},e):{},c=b("bre-field-editor-root"),d=g({title:w("link.url.title"),placeholder:w("link.url.placeholder"),value:u.href,type:"text",onUpdate:function(e){return u.href=e}}),s=g({title:w("link.title.title"),placeholder:w("link.title.placeholder"),value:u.title,type:"text",onUpdate:function(e){return u.title=e}}),f=(t={title:w("link.target.title"),value:u.target,options:[{value:""},{value:"_blank"},{value:"_self"},{value:"_parent"},{value:"_top"}],onUpdate:function(e){return u.target=e}},n=t.placeholder,r=t.value,o=t.options,a=t.onUpdate,i=b("bre-field-editor-prop"),(l=y({tag:"select",className:"bre-field-editor-input",props:{placeholder:n||""}})).onchange=function(){return a(l.value)},l.innerHTML=o.map(function(e){return'<option value="'+e.value+'" '+(e.value===r?"selected":"")+">"+(e.label||e.value)+"</option>"}).join("\n"),h(i,l,t),i.append(l),i);return c.append(d,s,f),{$element:c,data:u}}function a(c,d,e){var t=e.icon,s=e.command,f=e.range,p=e.aValueArgument,n=d.el({tag:"button",className:"bre-button",innerHTML:'<i class="fa fa-'+t+'"></i>'});return n.onclick=function(){return i(void 0,void 0,void 0,function(){var t,n,r,i,l,u;return v(this,function(e){switch(e.label){case 0:return null===(t=window.getSelection())?[2]:(n=0<t.rangeCount?t.getRangeAt(0):null,f&&!n?[2]:"CreateLink"!==s?[3,2]:(r=N(t),i=null!==r?{href:r.href,title:r.title,target:r.target}:{},[4,(o=c,a=i,new Promise(function(e){var t=m(a),n=t.$element,r=t.data;o(n,function(){e(r)},function(){e(null)})}))]));case 1:return null!==(l=e.sent())&&l.href&&(document.execCommand(s,!1,l.href),null!==t.anchorNode&&null!==t.anchorNode.parentElement&&(l.target&&t.anchorNode.parentElement.setAttribute("target",l.target),l.title&&t.anchorNode.parentElement.setAttribute("title",l.title))),[3,3];case 2:u=void 0,"string"==typeof p&&(u=p.replace("%%SELECTION%%",t.toString()));try{document.execCommand(s,!1,u)}catch(e){k(d,t),document.execCommand(s,!1,u)}e.label=3;case 3:return[2,!1]}var o,a})})},n}function r(e,t,n){if(void 0===n||0===n.length)return null;var r=function(t,n,e){var r=n.div("bre-plugin-html-editor-root");e.map(function(e){return a(t,n,e)}).forEach(function(e){return r.appendChild(e)});var o=n.div("bre-html-tools");return o.appendChild(r),n.toggleVisibility(o,!1),o}(e,t,n);return document.body.appendChild(r),r}var b=function(e,t){return n({className:e,innerHTML:t})},y=n,l=function(r){return i(void 0,void 0,void 0,function(){return v(this,function(e){return[2,new Promise(function(n,t){var e=new FileReader;e.onload=function(e){if(null!==e.target&&null!==e.target.result){var t=e.target.result.toString();n(t)}};try{e.readAsDataURL(r)}catch(e){t(e)}})]})})},w=function(e,t){var n=window.BrickyEditor.i18n.messages[window.BrickyEditor.i18n.locale][e];return void 0===n?"":(void 0!==t&&Object.keys(t).forEach(function(e){n.replace(/`{${p}}`/g,t[e])}),n)},N=function(e){return null!==e.anchorNode&&null!==e.anchorNode.parentNode&&"a"===e.anchorNode.parentNode.nodeName.toLowerCase()?e.anchorNode.parentNode:null},k=function(e,t){if(null!==t.anchorNode){var n=t.anchorNode.parentElement;if(null!==n){var r=e.createElement('<div class="bre-temp-container" contenteditable="true">'+n.innerHTML+"</div>");n.innerHTML="",n.removeAttribute("contenteditable"),n.appendChild(r);var o=document.createRange();o.selectNodeContents(r),t.removeAllRanges(),t.addRange(o)}}},u=function(){var e=window.getSelection();return null===e?null:e.getRangeAt(0).getBoundingClientRect()},t={init:function(t,e){var n=r(t.shared.messages,t.shared.modal,t.shared.helpers);if(null!==n){var o=function(e){!function(e,t,n){if(null!==t&&1<t.width){var r=t.top+t.height,o=t.left;e.style.top=r+"px",e.style.left=o+"px",n.toggleVisibility(e,!0)}else n.toggleVisibility(e,!1)}(n,e,t.shared.helpers)};t.on("fieldCreate",function(e){var t,n,r=e.sender;"html"===r.data.type&&(t=r.$element,n=o,t.contentEditable&&(t.addEventListener("mouseup",function(){setTimeout(function(){var e=u();n(e)},0)}),t.addEventListener("keyup",function(){var e=u();n(e)})))})}}};return e.plugin=t,e}({});
