var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();String.prototype.breContains=function(t){return this.indexOf(t)>=0},String.prototype.breStartsWith=function(t){return 0==this.indexOf(t)},String.prototype.breTotalTrim=function(){return this?this.replace(/\s\s+/g," ").trim():""},String.prototype.breEqualsInvariant=function(t){return this.toLowerCase()===t.toLowerCase()},Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,i=Object(this),o=i.length>>>0,n=arguments[1],r=0;r<o;r++)if(e=i[r],t.call(n,e,r,i))return e});var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){var t="",e=document;return window.getSelection?t=window.getSelection().toString():e.selection&&"Control"!=e.selection.type&&(t=e.selection.createRange().text),t},t.propsEach=function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];e(i,o)}},t.propsFilterKeys=function(e,i,o){var n=[];return t.propsEach(e,function(t,e){i(t,e)&&n.push(t)}),o&&n.push(o),n},t}();t.Common=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,i){var o=this;this.$editor=e,this.options=i,this.blocks=[],this.compactTools=null,e.addClass("bre-editor"),t.Fields.BaseField.registerCommonFields(),this.options=new t.EditorOptions(i),this.ui=new t.UI(this),this.ui.toggleToolsLoader(!0),t.Services.TemplateService.loadTemplatesAsync(this).done(function(t){o.ui.toggleToolsLoader(!1),o.ui.setTemplates(t),o.options.blocks&&o.options.blocks.length&&o.loadBlocks(o.options.blocks),o.options.onload&&o.options.onload(o)})}return Object.defineProperty(e.prototype,"selectedBlockIndex",{get:function(){return this.selectedBlock?this.blocks.indexOf(this.selectedBlock):-1},enumerable:!0,configurable:!0}),e.prototype.getData=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getData())}),t},e.prototype.getHtml=function(){var t=[];return this.blocks.forEach(function(e){t.push(e.getHtml(!0))}),t.join("\n")},e.prototype.loadBlocks=function(e){var i=this;e&&e.length&&e.forEach(function(e){var o=t.Services.TemplateService.getTemplate(e.template);o?i.addBlock(o,e.fields,null,!1):console.log("Template "+e.template+" not found.")})},e.prototype.selectBlock=function(t){this.selectedBlock!==t&&(this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=t)},e.prototype.deselectBlock=function(t){this.selectedBlock=null},e.prototype.addBlock=function(e,i,o,n){void 0===n&&(n=!0);var r=new t.Block(this,e,i);r.insert(o),n&&(r.select(),r.scrollTo())},e.prototype.deleteBlock=function(t){var e=this.blocks.indexOf(t);this.blocks.splice(e,1),t=null,e<this.blocks.length?this.blocks[e].select():this.blocks.length>0?this.blocks[e-1].select():this.selectedBlock=null},e.prototype.moveBlock=function(t,e){var i=this.blocks.indexOf(t),o=i+e;if(!(o>=this.blocks.length||o<0)){var n=this.blocks[o].ui.$editor;e>0?n.after(t.ui.$editor):e<0&&n.before(t.ui.$editor),this.blocks.splice(i,1),this.blocks.splice(o,0,t),t.scrollTo()}},e.prototype.copyBlock=function(t){var e=this.blocks.indexOf(t)+1;this.addBlock(t.template,t.getData().fields,e,!0)},e}();t.Editor=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t){this.templatesUrl="templates/bootstrap4.html",this.compactTools=null,this.ignoreHtml=null,this.templatesUrl=t.templatesUrl||this.templatesUrl,this.onload=t.onload,this.blocks=t.blocks,this.compactTools=t.compactTools,this.ignoreHtml=t.ignoreHtml||!1}return t}();t.EditorOptions=e}(BrickyEditor||(BrickyEditor={})),function(t){t.fn.brickyeditor=function(e){return new BrickyEditor.Editor(t(this),e)}}(jQuery);var BrickyEditor;!function(t){var e=function(){function e(e){var i=$(e),o=i.data();if(this.name=o.name,this.category=o.cactegory||[],this.$html=i.contents().not(".bre-template-preview"),this.$preview=$(".bre-template-preview",i).contents(),!this.$preview.length){var n=new t.Block(null,this),r=n.getHtml(!0);this.$preview=$(r)}}return e.prototype.getPreview=function(){var t=$("<div class='bre-template'></div>");return t.append(this.$preview),t},e}();t.Template=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e,i,o){this.editor=e,this.template=i,this.fields=[];var n=i.$html.clone();this.ui=new t.BlockUI(this,n,o)}return e.prototype.delete=function(){this.ui.delete(),this.editor.deleteBlock(this)},e.prototype.move=function(t){this.editor.moveBlock(this,t)},e.prototype.copy=function(){this.editor.copyBlock(this)},e.prototype.insert=function(t){var e=this.editor;t=t||e.blocks.length,e.selectedBlock&&(t=e.selectedBlockIndex+1),e.blocks.splice(t,0,this),0==t?e.$editor.append(this.ui.$editor):e.blocks[t-1].ui.$editor.after(this.ui.$editor)},e.prototype.getData=function(){var t=[];this.fields.forEach(function(e){t.push(e.data)});var e={template:this.template.name,fields:t};return this.editor.options.ignoreHtml||(e.html=this.getHtml(!0)),e},e.prototype.getHtml=function(t,e){void 0===e&&(e=!1);var i=this.ui.$block.clone(!1,!1).wrap("<div></div>").parent();return["contenteditable","data-bre-field"].forEach(function(t){$("["+t+"]",i).each(function(e,i){i.removeAttribute(t)})}),t?i.html().breTotalTrim():i.html()},e.prototype.select=function(){this.ui.$editor.addClass("bre-selected"),this.editor.selectBlock(this)},e.prototype.deselect=function(){this.ui.$editor.removeClass("bre-selected"),t.UI.toggleBtnDeck(this.ui.$tools,!0),this.editor.deselectBlock(this)},e.prototype.scrollTo=function(){var t=this.ui.$editor.offset().top-100;t=t>0?t:0,$("html, body").animate({scrollTop:t},"fast")},e}();t.Block=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(t,e,i){this.icon=t,this.action=e,this.title=i}return t}();t.BlockAction=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,i){this.block=t,this.$block=e,this.block.editor&&this.buildEditorUI(),this.bindFields(i)}return e.prototype.delete=function(){this.$editor.remove()},e.prototype.buildEditorUI=function(){var i=this;this.$tools=$('<div class="bre-block-tools bre-btn-deck"></div>'),e.actions.forEach(function(t){var e=i.buildButton(t);i.$tools.append(e)}),t.UI.initBtnDeck(this.$tools),this.$editor=$('<div class="bre-block-wrapper"></div>'),this.$editor.append(this.$tools),this.$editor.append(this.$block),this.$editor.hover(function(){i.$editor.addClass("bre-active")},function(){i.$editor.removeClass("bre-active")}),this.$block.on("click",function(){return i.block.select()})},e.prototype.buildButton=function(t){var e=this,i=$('<button class="bre-btn"><i class="fa fa-'+t.icon+'"></i></button>');return t.action&&i.on("click",function(){return t.action(e.block)}),i},e.prototype.bindFields=function(e){var i=this;this.$block.find(t.Selectors.selectorField).addBack(t.Selectors.selectorField).each(function(o,n){var r=$(n),l=t.Fields.BaseField.createField(i.block,r,e);i.block.fields.push(l)})},e.actions=[{icon:"ellipsis-h"},{icon:"trash-o",action:function(t){return t.delete()}},{icon:"copy",action:function(t){return t.copy()}},{icon:"angle-up",action:function(t){return t.move(-1)}},{icon:"angle-down",action:function(t){return t.move(1)}}],e}();t.BlockUI=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function e(t,e,i){this.$field=e,this.block=t,this.data=i,this.bind()}return Object.defineProperty(e,"type",{get:function(){var t=this.name;return t=t.replace("Field",""),t=t.substring(0,1).toLowerCase()+t.substring(1)},enumerable:!0,configurable:!0}),e.prototype.getSettingsEl=function(){return null},e.registerCommonFields=function(){t.HtmlField.registerField(),t.ImageField.registerField(),t.EmbedField.registerField()},e.registerField=function(){this._fields.hasOwnProperty(this.type)&&delete this._fields[this.type],this._fields[this.type]=this},e.createField=function(t,e,i){var o=e.data().breField;if(!o)throw"There is no any data in field "+e.html()+" of block "+t.name;if("string"==typeof o&&(o=JSON.parse(o.replace(/'/g,'"'))),!o.name)throw"There is no name in data of field "+e.html()+" of block "+t.name;if(i){for(var n={},r=0;r<i.length;r++){var l=i[r];if(l.name.toLowerCase()===o.name.toLowerCase()){n=l;break}}n&&(o=$.extend(o,n))}var s=o.type;if(null!=s){if(this._fields.hasOwnProperty(s)){return new(0,this._fields[s])(t,e,o)}throw s+" field not found"}throw"Field type not defined in data-bre-field attribute"},e.prototype.bind=function(){},e.prototype.selectBlock=function(){this.block.select()},e._fields={},e}();t.BaseField=e}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getSettingsEl=function(){var t=$('<div style="position: absolute;width: 100%; height: 100px;;text-align: center;font-weight: bold;vertical-align: middle;background: #333;opacity: 0.2;">Change embed element link</div>');return this.$field.before(t),t},Object.defineProperty(i.prototype,"settings",{get:function(){return function(t){t.data.url=prompt("Link to embed media","http://instagr.am/p/BO9VX2Vj4fF/"),t.loadMedia()}},enumerable:!0,configurable:!0}),i.prototype.bind=function(){var t=this;this.$field.on("click",function(){t.data.url=prompt("Link to embed media","http://instagr.am/p/BO9VX2Vj4fF/"),t.loadMedia()}),t.loadMedia()},i.prototype.loadMedia=function(){var e=this;e.data&&e.data.url&&t.Services.EmbedService.getEmbedAsync(e.data.url).done(function(i){e.data.embed=i;var o=$(i.html),n=o.filter("script");if(n.length>0){n.remove();var r=n.attr("src");r.breStartsWith("//")&&(r="https:"+r,$.getScript(r).done(function(e){t.Services.EmbedService.processEmbed(i.provider_name)}).fail(function(t){}))}e.$field.empty(),e.$field.removeAttr("class"),e.$field.removeAttr("style"),e.$field.append(o),e.selectBlock()})},i}(e.BaseField);e.EmbedField=i}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.bind=function(){var e=this,i=this,o=this.$field;o.is("[contenteditable]")||o.attr("contenteditable","true");var n=this.data.html||this.$field.html()||this.block.template.name;this.setHtml(n),o.html(this.data.html),t.SelectionUtils.bindTextSelection(o,function(t){e.block.editor.ui.htmlTools.show(t)}),o.on("blur keyup paste input",function(){e.setHtml(o.html())}).on("paste",function(t){t.preventDefault();var e=t.originalEvent,i=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)}).on("click",function(t){return i.selectBlock(),t.stopPropagation(),!1})},i.prototype.setHtml=function(t){this.data.html=t.trim(),this.$field.html()!==t&&this.$field.html(t)},i}(e.BaseField);e.HtmlField=i}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.bind=function(){var t=this,e=this.$field,i=(this.data,t.block.editor);this.setSrc(this.data.src),e.on("click",function(){i.ui.modal.promptAsync(t.getPromptParams()).done(function(e){var i=e.getValue("file"),o=e.getValue("src");i?(t.setFile(i),t.setSrc(null)):o&&(t.setSrc(o),t.setFile(null));var n=e.getValue("alt");t.setAlt(n)}),t.selectBlock()})},i.prototype.getPromptParams=function(){return[new t.Prompt.PromptParameter("src","Image Link",this.data.url,"image url"),new t.Prompt.PromptParameterImage("file","or Upload file",this.data.file,"select file"),new t.Prompt.PromptParameter("alt","Alt",this.data.alt,"alt attribute value ")]},i.prototype.setSrc=function(t){this.data.src=t,t&&(this.isImg?this.$field.attr("src",this.data.src):this.$field.css("background-image","url("+this.data.src))},i.prototype.setAlt=function(t){this.data.alt=t,this.$field.attr(this.isImg?"alt":"title",this.data.alt)},i.prototype.setFile=function(t){this.data.file=t,t&&(this.isImg?this.$field.attr("src",this.data.file.fileContent):this.$field.css("background-image","url("+this.data.file.fileContent+")"))},Object.defineProperty(i.prototype,"isImg",{get:function(){return this._isImg=this._isImg||"img"===this.$field.prop("tagName").toLowerCase()},enumerable:!0,configurable:!0}),i}(e.BaseField);e.ImageField=i}(t.Fields||(t.Fields={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t.getEmbedAsync=function(t){var e=$.Deferred(),t="https://noembed.com/embed?url="+t;return $.ajax({url:t,type:"get",dataType:"jsonp"}).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e},t.processEmbed=function(e){switch(e){case t.Instagram:instgrm&&instgrm.Embeds.process()}},t.Instagram="Instagram",t}();t.EmbedService=e}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(e){var i=function(){function e(){}return e.loadTemplatesAsync=function(e){var i=this,o=$.Deferred();return $.get(e.options.templatesUrl).done(function(n){i.templates=[];var r=$(n).filter("style");r&&r.length>0&&e.$editor.prepend(r),$(n).filter(".bre-template").each(function(e,o){var n=new t.Template(o);i.templates.push(n)}),o.resolve(i.templates)}).fail(function(t){console.log("Templates file not found."),o.fail(t)}),o},e.getTemplate=function(t){for(var e=0;e<this.templates.length;e++){var i=this.templates[e];if(i.name.toLowerCase()===t.toLowerCase())return i}return null},e}();e.TemplateService=i}(t.Services||(t.Services={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,i,o){this.key=t,this.title=e,this.placeholder=o||"",this.value=i}return t.prototype.parseValue=function(){this.value=this.$input.val(),this.$control=null,delete this._$control},Object.defineProperty(t.prototype,"$control",{get:function(){return this._$control||(this._$control=$('<div class="bre-prompt-field">\n                            <label class="bre-label" for="'+this.key+'">'+(this.title?this.title:"Select file...")+"</label>\n                        </div>"),this.$input=this.getEditor(),this._$control.append(this.$input)),this._$control},set:function(t){this._$control=t},enumerable:!0,configurable:!0}),t.prototype.getEditor=function(){this.value;return $('<input type="text" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+'" value="'+(this.value?this.value:"")+'">')},t}();t.PromptParameter=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function i(t,i,o,n){var r=e.call(this,t,i,o,n)||this;return o&&(r._value=o),r}return __extends(i,e),i.prototype.parseValue=function(){this.value=this._value,this.$control=null,delete this._$control,this._value=null,delete this._value},i.prototype.getEditor=function(){var e=this,i=this.value&&this.value.fileContent?this.value.fileContent:"",o=$("\n                <div class='bre-image-input'>\n                    <label for=\""+this.key+'">\n                        Select file...\n                    </label>                        \n                    <img src="'+i+'"/>                    \n                    <input type="file" id="'+this.key+'" class="bre-input" placeholder="'+this.placeholder+"\">\n                </div>\n                <small class='bre-image-input-filename'></small>"),n=$("input",o),r=$("img",o),l=$(".bre-image-input-filename",o),s=this.value;return s&&(r.attr("src",s.fileContent),r.addClass("bre-loaded"),l.text(s.fileInfo.name)),n.change(function(){var i=this;if(i.files&&i.files[0]){var o=new FileReader;o.onload=function(o){var n=o.target;e._value=new t.PromptParameterImageResult,e._value.fileContent=n.result,e._value.fileInfo=new t.PromptParameterImageResultFile(i.files[0]),r.attr("src",e._value.fileContent),r.addClass("bre-loaded"),l.text(e._value.fileInfo.name)},o.readAsDataURL(i.files[0])}}),o},i}(t.PromptParameter);t.PromptParameterImage=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(){}return t}();t.PromptParameterImageResult=e;var i=function(){function t(t){this.name=t.name,this.size=t.size,this.type=t.type,this.lastModified=t.lastModified,this.lastModifiedDate=t.lastModifiedDate}return t}();t.PromptParameterImageResultFile=i}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t){this.params=t}return t.prototype.getValue=function(t){var e=this.params.find(function(e){return e.key===t});return e?e.value:null},t}();t.PromptParameterList=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(){function t(t,e,i){void 0===i&&(i=!1),this.title=t,this.value=e,this.selected=i}return t}();t.PromptParameterOption=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){!function(t){var e=function(e){function i(i,o,n,r,l){var s=e.call(this,i,o,r,l)||this;return s.options=[],n.forEach(function(e){s.options.push(new t.PromptParameterOption(e[0],e[1],e[1]==r))}),s}return __extends(i,e),i.prototype.getEditor=function(){var t=this.options.map(function(t){return'<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+(t.title?t.title:t.value)+"</option>"});return $('<select type="text" id="'+this.key+'" class="brickyeditor-input" placeholder="'+this.placeholder+'">'+t+"</select>")},i}(t.PromptParameter);t.PromptParameterOptions=e}(t.Prompt||(t.Prompt={}))}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t){this.editor=t,this.buttons=[{icon:"bold",command:"Bold",range:!0},{icon:"italic",command:"Italic",range:!0},{icon:"link",command:"CreateLink",range:!0},{icon:"list-ul",command:"insertUnorderedList",range:!0},{icon:"list-ol",command:"insertOrderedList",range:!0},{icon:"undo",command:"Undo",range:!1},{icon:"repeat",command:"Redo",range:!1}],this.setControl()}return e.prototype.setControl=function(){var t=this,e=$('<div class="bre-html-tools-panel"></div>');this.buttons.forEach(function(i){var o=t.getButtonElement(i.icon,i.command,i.range);e.append(o)}),this.$control=$('<div class="bre-html-tools bre-btn-group"></div>'),this.$control.append(e).hide(),this.editor.$editor.append(this.$control)},e.prototype.getButtonElement=function(t,e,i){var o=this;void 0===i&&(i=!0);var n=$('<button class="bre-btn"><i class="fa fa-'+t+'"></i></button>');return n.on("click",function(){var t=window.getSelection(),n=t.rangeCount>0?t.getRangeAt(0):null;if(!i||n)return"CreateLink"==e?o.editor.ui.modal.promptAsync(o.getLinkPromptParams(t)).done(function(i){var o=i.getValue("href");if(o){document.execCommand(e,!1,o);var n=i.getValue("target");n&&t.anchorNode.parentElement.setAttribute("target",n);var r=i.getValue("title");r&&t.anchorNode.parentElement.setAttribute("title",r)}}):document.execCommand(e),!1}),n},e.prototype.show=function(t){if(t&&t.width>1){var e=this.editor.$editor.offset(),i=this.editor.$editor.width(),o=t.top-e.top+$(window).scrollTop()+t.height,n=this.$control.width(),r=t.left-e.left+t.width/2-n/2;r<0?r=0:r+n>i&&(r=i-n),this.$control.css({top:o+"px",left:r+"px"}),this.$control.show()}else this.$control.hide()},e.prototype.getLinkPromptParams=function(e){var i="",o="",n="";if(e.anchorNode&&e.anchorNode.parentNode.nodeName.breEqualsInvariant("a")){var r=$(e.anchorNode.parentNode);i=r.attr("href"),o=r.attr("title"),n=r.attr("target")}return[new t.Prompt.PromptParameter("href","Url",i,"Url"),new t.Prompt.PromptParameter("title","Title",o,"Title"),new t.Prompt.PromptParameterOptions("target","Target",[["",""],["Blank","_blank"],["Self","_self"],["Parent","_parent"],["Top","_top"]],n)]},e}();t.HtmlTools=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(t,e,i,o,n,r){this.$control=t,this.$closeBtn=e,this.$form=i,this.$btns=o,this.$okBtn=n,this.$cancelBtn=r;var l=this;e.on("click",function(){l.hideModal()})}return e.prototype.hideModal=function(){this.restoreSelection(),this.$control.fadeOut()},e.prototype.showModal=function(t,e){void 0===e&&(e=!0),this.saveSelection(),this.$btns.toggle(e),t&&(this.$form.append(t),t.is(":visible")||t.show()),this.$control.fadeIn()},e.prototype.promptAsync=function(e){var i=this,o=$.Deferred(),n=this;return this.$form.children().not(this.$btns).remove(),e.forEach(function(t){i.$btns.before(t.$control)}),this.$okBtn.on("click",function(){e.forEach(function(t){return t.parseValue()}),n.hideModal(),o.resolve(new t.Prompt.PromptParameterList(e))}),this.$cancelBtn.on("click",function(){n.hideModal(),o.reject(e)}),n.showModal(),o},e.prototype.saveSelection=function(){var t=window.getSelection();this.selectionRanges=[];for(var e=0;e<t.rangeCount;e++)this.selectionRanges.push(t.getRangeAt(e))},e.prototype.restoreSelection=function(){if(this.selectionRanges&&0!=this.selectionRanges.length){var t=window.getSelection();t.removeAllRanges(),this.selectionRanges.forEach(function(e){return t.addRange(e)})}},e}();t.Modal=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.getSelectedText=function(){return window.getSelection().getRangeAt(0).toString()},t.replaceSelectedText=function(t){var e,i;window.getSelection&&(e=window.getSelection(),e.rangeCount&&(i=e.getRangeAt(0),i.deleteContents(),i.insertNode(document.createTextNode(t))))},t}();t.SelectionHelper=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.bindTextSelection=function(t,e){var i=this;t.is("[contenteditable]")&&(t.on("mouseup",function(){setTimeout(function(){var t=i.getSelectionRect();e(t)},0)}),t.on("keyup",function(t){var o=i.getSelectionRect();e(o)}))},t.getSelectionRect=function(){var t=window.getSelection(),e=t.getRangeAt(0);if(e){var i=e.getBoundingClientRect();if(i)return i}return null},t}();t.SelectionUtils=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function t(){}return t.attr=function(t){return"["+t+"]"},t.field="data-bre-field",t.selectorField="["+t.field+"]",t.classMobile="brickyeditor-tools-mobile",t.htmlToolsCommand="data-bre-doc-command",t.htmlToolsCommandRange="data-bre-doc-command-range",t.selectorHtmlToolsCommand=t.attr(t.htmlToolsCommand),t.selectorHtmlToolsCommandRange=t.attr(t.htmlToolsCommandRange),t}();t.Selectors=e}(BrickyEditor||(BrickyEditor={}));var BrickyEditor;!function(t){var e=function(){function e(e){this.editor=e,this.setTools(),this.setModal(),this.htmlTools=new t.HtmlTools(this.editor)}return Object.defineProperty(e.prototype,"isMobile",{get:function(){return this._isMobile},set:function(e){this._isMobile!=e&&(this._isMobile=e,null!=this.$tools&&(this.$tools.toggle(!e),this.$toolsBtn.toggle(e),e?this.$tools.addClass(t.Selectors.classMobile):this.$tools.removeClass(t.Selectors.classMobile)))},enumerable:!0,configurable:!0}),e.prototype.checkIsCompactTools=function(t){if(null==this.compactTools){var e=(window.innerWidth-t.$editor.width())/2-this.$tools.width();this.isMobile=e<=0}else this.isMobile=this.compactTools},e.prototype.setTools=function(){var t=this;this.$toolsTemplates=$('<div class="bre-tools-templates"></div>'),this.$toolsLoader=$('<div class="bre-tools-loader"><b>Loading...</b></div>'),this.$toolsHideBtn=$('<button class="bre-tools-toggle"><div>></div></button>'),this.$tools=$('<div class="bre bre-tools" data-bricky-tools></div>'),this.$tools.append([this.$toolsHideBtn,this.$toolsLoader,this.$toolsTemplates]),this.$toolsHideBtn.on("click",function(){t.$tools.toggleClass("bre-tools-collapsed",!t.$toolsHideBtn.hasClass("bre-tools-toggle-collapsed")),t.$toolsHideBtn.toggleClass("bre-tools-toggle-collapsed")}),this.editor.$editor.append(this.$tools)},e.prototype.setModal=function(){var e=$('<div class="bre bre-modal"><div class="bre-modal-placeholder"></div></div>'),i=$('<div class="bre-modal-close"><a href="#">close ✖</a></div>'),o=$('<div class="bre-modal-content"></div>'),n=$("<form></form>"),r=$('<div class="bre-btns"></div>'),l=$('<button type="button" class="bre-btn bre-btn-primary">Ok</button>'),s=$('<button type="button" class="bre-btn">Cancel</button>');r.append(l),r.append(s),n.append(r),o.append(n);var a=$(".bre-modal-placeholder",e);a.append(i),a.append(o),this.modal=new t.Modal(e,i,n,r,l,s),this.editor.$editor.append(e)},e.prototype.toggleToolsLoader=function(t){this.$toolsLoader.toggle(t)},e.prototype.setTemplates=function(t){var e=this,i=this.editor;t.forEach(function(t){var o=t.getPreview();o.on("click",function(){i.addBlock(t)}),e.$toolsTemplates.append(o)})},e.initBtnDeck=function(t){$(".bre-btn",t).eq(0).on("click",function(){e.toggleBtnDeck(t)})},e.toggleBtnDeck=function(t,e){var i=$(".bre-btn",t);if(i&&0!=i.length){var o=i.eq(0);e=e||t.data().isOn||!1,e?(t.css({height:0,width:0}),i.not(":first").css({opacity:0,top:0,left:0})):(i.not(":first").each(function(t,e){$(e).css({opacity:1,left:(t+1)*(32+32/6)})}),t.css({height:32,width:(32+32/6)*i.length-32/6})),o.toggleClass("bre-btn-active",!e),t.data("isOn",!e)}},e}();t.UI=e}(BrickyEditor||(BrickyEditor={}));